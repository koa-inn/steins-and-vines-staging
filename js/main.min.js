var _eventQueue=[],_EVENT_FLUSH_THRESHOLD=5;function trackEvent(e,t,a){("undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.TRACK_EVENTS_URL?SHEETS_CONFIG.TRACK_EVENTS_URL:"")&&(_eventQueue.push({type:e,sku:t,name:a}),_eventQueue.length>=_EVENT_FLUSH_THRESHOLD&&flushEvents())}function flushEvents(){if(0!==_eventQueue.length){var e="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.TRACK_EVENTS_URL?SHEETS_CONFIG.TRACK_EVENTS_URL:"";if(e){var t=JSON.stringify({events:_eventQueue});_eventQueue=[],navigator.sendBeacon&&navigator.sendBeacon(e,new Blob([t],{type:"application/json"}))}}}function showToast(e,t){var a=document.querySelector(".toast-container");a||((a=document.createElement("div")).className="toast-container",document.body.appendChild(a));var n=document.createElement("div");n.className="toast"+(t?" toast--"+t:""),n.textContent=e,a.appendChild(n),n.offsetHeight,n.classList.add("show"),setTimeout(function(){n.classList.remove("show"),setTimeout(function(){n.remove()},300)},3500)}function escapeHTML(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""}document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&flushEvents()});var SV_LOGO_SVG='<svg xmlns="http://www.w3.org/2000/svg" data-name="Layer 2" viewBox="0 0 797.15 942.65"><g data-name="Layer 1"><path d="M67.88 876.85c71.18 35.21 208.97 46.04 324.73 44.8-5.81-11.76-6.6-24.49-2.6-36.02-10.83-1.36-19.04-9.7-23.55-14.29l-.24-.26c-13.72-14.95-15.42-38.83-4.01-55.68.16-.28.36-.55.55-.84-3.89 4.75-8.86 9.15-14.76 13.01-2.12 1.41-4.61 2.12-7.1 2.12-.29 0-.58 0-.88-.02-4.25 3.63-8.63 6.24-12.13 8.16l-.28.15c-5.16 2.79-11.22 5.64-16.96 5.64-4.57 0-8.68-1.77-11.55-4.96-1.51-1.69-2.6-3.67-3.21-5.84-2.32.5-4.74.75-7.23.75-6.36 0-12.11-1.57-17.69-3.08-4.8-1.31-9.36-2.55-13.66-2.55-.52 0-1.05.02-1.57.05-.32.03-.65.05-.96.05-4.27 0-8.27-2.09-10.7-5.63-2.61-3.81-3-8.71-1.04-12.89 1.61-3.39 2.42-7.93 3.28-12.72 1.49-8.24 3.28-18.13 9.99-26.52-.32-.28-.63-.57-.94-.89l-.13-.13c-4.14-4.44-5.14-10.82-2.61-16.62 3.6-8.3 16.57-16.93 27.77-21.52.96-2.29 2.71-4.8 5.87-6.91 7.54-5 16.32-7.61 25.41-7.61 7.04 0 13.82 1.62 19.71 4.61-.52-1.64-1.04-3.24-1.52-4.75-30.02-32.79-53.73-70.34-76.66-106.68-40.01-63.37-74.95-118.7-132.47-135.18-.44 3.54-.79 6.68-.84 8.21-.37 11.6-.16 20.66.67 27.77.11.73.81 3.55 1.22 5.24 1.18 4.88 1.9 7.8 1.48 10.7 14.31-7.74 32.63-8.17 47.03-.57 14.24 7.51 22.12 21.54 21.99 38.84 8.06-.16 15.62 1.48 22.24 4.96 18.52 9.78 31.85 37.24 21.07 64.57-3.58 9.07-10.22 17.66-20.05 22.82 1.77 3.36 2.48 7.01 3.02 9.67.15.7.26 1.36.41 1.95l.1.39.08.41c2.24 13.4-1.22 27.04-9.21 36.49l-.21.28c-4.12 4.88-9.11 8.71-14.58 11.48.36.42.7.88 1.02 1.35l.28.42.24.44c8.3 15.52 6.28 36.75-4.72 49.39l-.19.23c-9.72 11.42-25.35 17.58-40.85 16.2-5.63-.31-11.06-1.82-16.15-4.51-15.78-8.32-24.73-25.48-24-43.04-2.61.58-5.35.55-8.13-.16l-.23-.06c-3.42-.66-7.02-1.99-10.79-3.99a53 53 0 0 1-3.02-1.7 55 55 0 0 1-7.2-4.78c-4.65 7.74-8.13 15.94-5.73 25.95 1.04 4.35 5.89 7.56 6.03 11.34.15 4.88-7.06 12.41-8.17 17.92-1.99 9.81.21 17.97-3.8 28.92-10.72 28.97-52.01 40.35-1.83 65.18ZM597.37 808.86a431 431 0 0 1-27.3 2.16c9.16 8.09 14.99 19.15 15.84 30.41l.03.34c.52 6.58-.37 13.02-2.38 19.02.57.05 1.15.13 1.72.26l.52.1.49.15c16.38 5.09 29.7 20.6 32.05 36.83 27.6-6.16 54.17-13.85 70.13-22.8-3.1-.52-6.28-1.17-9.36-2-2.16 2.08-5.94 4.53-11.82 4.53l-.55-.02c-23.94-.6-46.17-14.56-56.68-35.57-5.53-11.06-7.22-22.85-5.16-34.32-2.48.32-5 .62-7.53.91"/><path d="M730.53 857.31c-.21-1.74-19.62-20.58-17.91-29.01 9.13.88 16.07 4.43 25.92 3.44 25.53-2.61 37.76-29.37 58.61-41.67-29.24-18.15-33-59.51-77.44-44.36 1.87-12.54 11.06-18.54 17.95-26.6s-15.2-10.41-19.61-10.93c-12.76-1.51-25.14-1.22-37.03 4.05l1.72-9.26c-10.1-.31-19.4.84-27.51 3.36-27.17 8.38-41.02 32.08-27.07 68.08l-7.1 1.75c-21.75 2.3-43.66 3.39-65.52 2.6 1.35 6.26 1.48 12.97-.15 19.71 13.53-.13 27.09-1.02 40.55-2.51 2.79-.31 5.56-.63 8.35-1.01 7.17-.92 14.32-2.03 21.42-3.29-23.84 33.52 5.3 72.3 41.34 73.21 7.9.19.37-9.73 4.22-9.31 3.47 4.12 17.32 7.33 30.75 8.34 14.87 1.12 29.24-.49 28.5-6.58ZM362.76 814.56c.88-1.05 1.7-2.12 2.47-3.21-.97 1.15-1.8 2.24-2.47 3.21M500.68 824.29l-.23-.39c-13.19-22.9-43.09-22.07-59.38-2.92-19.37 24.99 2.43 64.19 34.95 58.99 28.4-3.67 38.39-32.49 24.65-55.68ZM608.06 900.34c-1.48-12.73-12.16-25.07-24.86-29.01-3.78-.78-5.21 3.39-7.46 5.71-4.04 5.25-9.73 9.03-16.07 11.68-4.83 2.09-9.76 3.78-15.1 4.46-2.45.39-5.38.73-7.22 2.38-3.96 4.46-3.97 11.08-2.42 17.18.55 2.16 1.3 4.25 2.12 6.16 9.75 23.57 39.78 30.96 56.52 16.02 9.67-7.9 15.54-20.57 14.64-32.73l-.03-.49c-.03-.45-.06-.91-.13-1.36ZM471.03 893.02c-.75-1.1-2.22-1.51-3.57-1.93-9.02-2.56-18.33-3.34-25.36-9.67-4.51-3.68-7.12-7.49-10.72-11.5-1.82-1.96-3.91-3.88-6.68-3.91-6.99.6-13.82 6.55-18.54 11.94-11.03 13.48-9.84 29.83-2.5 42.09.29.49.6.96.91 1.43 15.55 23.37 50 18.89 62.64-2.42 4.12-6.93 5.92-15.63 4.02-25.74l-.19-.29Z"/><path d="M536.91 811.18c3.68-4.05 6.16-8.37 7.61-12.75 2.24-6.76 2.04-13.7.06-20.22-1.44-4.83-3.89-9.42-7.06-13.54-12.71-16.64-37.11-25.51-55.86-10.41-3.39 2.72-6.58 6.24-9.5 10.64-.15.21-.29.44-.44.67l-.24.41c-2.42 4.61-4.93 13.92-5.39 21.34-.21 3.76.08 7.04 1.2 8.97 2.47 2.9 7.15 2.29 10.64 3.13 6.73.96 11.76 4.17 17.32 7.59.02.02.03.02.05.03 2.72 1.74 5.37 3.75 7.64 6.11 7.98 9.05 9.2 15.16 19.95 8.9 5.87-3.29 10.49-6.97 14.01-10.87ZM560.07 816.4c-2.27-1.38-5.4-3.91-8.38-4.93-1.57-.55-3.1-.68-4.46-.03-.62.31-1.22.78-1.75 1.46-4.85 6.47-9.37 12.41-17.5 15.23-3.94 2.24-11.81 2.63-11.11 8.58.5 6.02 1.33 14.3-.28 20.81-3.94 13.22-10.54 12.85 5.04 21.28 26.03 14.87 56.1-8.19 53.86-36.15l-.03-.42c-.75-9.8-6.78-19.59-15.39-25.82ZM464.69 762.36c.21-.66.36-1.35.42-2.06l-.08-.41c-10.62-12.39-23.08-15.33-34.19-12.57-9 2.24-17.14 8.22-22.72 15.96-4.8 6.63-7.72 14.55-7.72 22.51 0 10.75 5.32 21.55 18.52 29.37 12 8.09 14.3-3.6 22.35-9.81 3.62-3.08 9.62-5.11 14.45-7.61.08-.03.15-.06.21-.1 3.28-1.44 2.95-4.91 2.64-8.03-.16-1.56-.29-3.11-.36-4.67-.19-4.17.1-8.3 1.69-12.34 1.02-3.84 3.73-6.84 4.78-10.25ZM423.58 830.22l-.15-.34c-1.18-1.87-3.89-2.24-5.81-3.18-10.19-3.55-14.55-12.62-22.2-19.74-5.63-6.33-21.31 8.82-24.38 14.11-8.94 12.94-7.64 31.43 2.89 42.91 4.77 4.85 11.11 10.88 18.26 11.32 1.39-.21 2.5-1.18 3.44-2.21 3.05-3.49 6.68-7.38 10.44-10.17 4.25-3.44 10.85-5.37 15.91-8.71 2.71-2.21 1.04-7.14.91-11.01-.99-4.56 1.15-8.87.68-12.99ZM493.77 939.21c1.07.37 2.09.71 3.05.94.92.13 2.12.19 3.52.15.13.02.26 0 .37 0 4.07.1 8.39-.57 12.47-1.7 4.2-.99 8.3-2.48 11.29-4.54.02-.02.03-.03.06-.05.15-.1.32-.18.47-.26 1.56-.91 2.61-2.12 3.16-3.52.1-.15.19-.31.28-.47v-.49c.28-1.28.16-2.68-.37-4.15-.02-.08-.05-.15-.06-.23-.65-3.57-1.93-7.28-2.9-10.9-.05-.18-.1-.36-.15-.53-.26-1.18-.5-2.35-.7-3.49-.39-1.93-.5-3.91-.42-5.92.02-.31.03-.63.06-.96.02-.21.05-.42.06-.63.08-.7.18-1.41.28-2.12.06-.41.15-.81.23-1.22.03-.1.05-.19.06-.31.29-1.31.68-2.6.86-3.73.02-.02.02-.05.02-.06.18-.91.26-1.8-.06-2.5l-.15-.29c-.06-.05-.15-.08-.19-.13l-.02-.02-.06-.06c-.84-.99-2.04-1.48-3.26-1.91-.08-.03-.18-.05-.24-.1-.11-.03-.23-.08-.34-.11-1.83-.76-3.8-1.4-5.66-2.19-1.15-.53-2.25-1.14-3.31-1.9-2.85-1.98-5.79-6.18-8.3-6.33-.06.02-.15.02-.19.03-.02 0-.05.02-.08.02-.39-.02-.8.02-1.22.15-.34.16-.73.32-1.15.52-.06.02-.13.03-.19.06-2.4.86-5.21 2.25-7.93 3.68-.08.03-.18.1-.28.15-2.58 1.27-5.16 2.63-7.23 3.93-.03.02-.08.05-.11.06-.05.03-.1.05-.15.08-.29.15-.6.29-.86.44-.21.16-.42.37-.58.55v.02c-.11.08-.24.16-.34.24-.11.18-.16.37-.26.55-.05.08-.11.15-.16.23 0 .03-.02.05-.02.1-.67 1.22-.91 2.69-.94 4.27-.02.32-.02.63-.02.94 0 .15.02.29.02.45 0 1.85.15 3.75.16 5.56-.02.45-.03.91-.1 1.33 0 .24.02.47.03.71-.02.13-.02.29-.03.42.03.83.02 1.61-.02 2.38-.02.15-.02.31-.02.47-.02.06-.02.13-.03.21-.32 3.92-1.41 7.56-2.77 11.22-.1.29-.21.58-.32.88-.39.99-.79 2.01-1.22 3.05-.15.34-.28.68-.42 1.02-.05.13-.1.29-.15.42-.11.28-.21.55-.29.81-.02.05-.03.11-.05.16 0 .02 0 .03-.02.05-.03.08-.06.16-.08.28-.58 1.77-.84 3.57.71 4.88.28.21.55.42.89.67.29.19.62.44.92.65.06.05.11.1.18.13.29.21.55.41.88.63 3.75 2.56 8.77 5.56 13.23 7.27.06.02.11.05.16.06M96.83 644.7c2.34 4.99 6 9.54 11.11 13.19 22.06 16.77 48.54 3.7 54.85-21.62l.11-.44c6.49-24.75-14.69-44.52-38.96-42.38-10.8 1.44-19.24 7.69-24.44 15.96v.02c-6.54 10.36-8 23.94-2.68 35.26v.02ZM151.61 775.68c12.03 1.12 24.68-3.62 32.36-12.6l.31-.36c8.4-9.67 9.72-26.18 3.42-37.94-2.08-3.1-5.89-1.2-9.02-1.14-6.36.88-12.86-.39-19.04-2.89-4.75-1.85-9.29-4.04-13.43-7.19-1.95-1.39-4.22-3.16-6.6-3.28-7.78.52-13.3 8.69-16.07 15.91-9.29 22.87 6.37 48.4 28.07 49.47ZM95.37 664.07c.06-.08.11-.18.18-.26l.08-.32c.08-.49.03-.97-.11-1.46V662c-.21-.76-.65-1.54-1.04-2.27-4.49-7.9-10.36-14.76-10.93-23.91-.58-5.6.19-10.01.44-15.23.08-2.58-.06-5.32-1.96-7.22-5.21-4.35-13.96-4.88-20.87-4.38-16.77 1.78-27.07 13.85-30.34 27.31-8.66 36.12 41.49 61.57 64.57 27.77Z"/><path d="m182.77 576.08-.45.13c-7.22 2.29-21.86 11.82-23.48 18.03-.28 3.68 3.37 6.44 5.19 9.39 4.01 5.25 5.29 10.87 6.8 17.01.7 3.07 1.15 6.28 1.12 9.47-.65 11.66-3.97 16.71 7.7 19.69 66.53 18.18 64.32-87.4 3.13-73.73ZM201.89 699.78l.26-.31c6.15-7.25 8.64-18.12 6.94-28.25-1.1-4.44-1.62-13.12-7.67-12.36-7.75 1.17-14.9 2.19-22.43-1.41-4.23-1.12-9.93-6.2-13.48-1.62-3.76 4.48-8.81 10.75-14.35 14.16-11.69 6.44-16.01 1.67-10.98 18.1 7.82 27.94 44.24 32.49 61.71 11.69M112.62 574.38c2.77 13.74 12.31 7.23 22.07 8.43 4.67.34 10.28 3.08 15.36 4.65 3.24 1.25 5.37-1.38 7.28-3.75 3.52-4.36 7.2-8.48 12.49-10.82 3.96-2.35 8.77-2.21 11.95-4.95l.21-.32c3.78-54.25-83.3-46.04-69.37 6.75ZM102 552.74c.26-5.01-7.54-7.04-14.95-7.51-4.69-.28-9.23.06-11.45.66-7.38 1.41-13.96 5.43-18.78 10.96h-.02c-4.96 5.68-8.11 12.94-8.38 20.58 0 6.58.26 15.05 4.9 20.22 1.1.79 2.53.88 3.86.83 4.49-.34 9.63-.55 14.13.08 5.25.52 11.13 3.68 16.9 4.82 3.36.32 5.55-4.22 8.11-6.97 1.18-1.88 2.84-3.2 4.53-4.41v-.02c1.74-1.28 3.5-2.47 4.77-4.07l.13-.34c.45-2.08-1.17-4.18-1.85-6.13-.88-1.78-1.46-3.55-1.87-5.34v-.02c-1.65-7.57.36-15.16-.02-23.35ZM94.75 679.73c-.18.16-.34.34-.52.5l-.34.31c-.05.05-.11.08-.16.13-3.11 2.68-6.62 4.51-10.36 6.23-.96.42-1.91.84-2.92 1.28-.32.15-.65.28-.97.42-.13.05-.26.13-.39.18-.26.13-.52.24-.76.37-.05.02-.08.05-.13.08-.02 0-.03 0-.05.02-.08.03-.16.06-.26.13-1.59.83-3 1.88-2.82 3.86.05.34.1.66.18 1.05.05.34.13.73.18 1.09.02.06.03.15.05.21.05.34.1.66.18 1.02.83 4.33 2.25 9.81 4.17 14.01.03.05.05.11.08.16.47.97.96 1.91 1.44 2.71.57.73 1.35 1.59 2.34 2.5.08.1.18.18.26.26.91.94 1.88 1.83 2.92 2.69 2.09 1.72 4.43 3.28 6.83 4.61 3.57 2.17 7.43 3.94 10.88 4.54.03.02.05.02.06.02.18.05.34.1.52.15 1.69.42 3.23.31 4.56-.28.18-.03.34-.08.5-.15l.26-.24s.05-.06.08-.08c1.05-.7 1.95-1.74 2.56-3.11.05-.08.08-.15.11-.21 2.08-3.05 3.78-6.67 5.68-9.96.62-.99 1.25-1.96 1.9-2.89 1.04-1.59 2.3-3.02 3.73-4.35l.68-.62c.16-.15.32-.26.49-.39.53-.44 1.07-.86 1.64-1.28.31-.24.65-.47.97-.68.1-.06.18-.11.26-.16 1.1-.71 2.24-1.35 3.13-1.99.02 0 .03-.03.05-.05.75-.49 1.41-1.05 1.66-1.75l.1-.31c-.02-.08-.03-.15-.05-.23v-.11c.1-1.25-.41-2.38-.94-3.52-.03-.08-.08-.16-.11-.24-.05-.1-.1-.19-.15-.31-.75-1.77-1.66-3.54-2.42-5.37-.42-1.14-.78-2.32-.99-3.55-.62-3.29.21-8.19-1.43-10.01-.05-.02-.1-.08-.15-.1-.02-.02-.05-.03-.06-.05-.26-.28-.57-.52-.96-.73-.32-.13-.71-.28-1.14-.42-.05-.03-.11-.06-.16-.1-2.25-1.02-5.14-2-7.98-2.84-.1-.05-.19-.06-.29-.1-2.64-.88-5.35-1.7-7.66-2.21-.03-.02-.08-.03-.13-.05-.05 0-.1-.02-.15-.02-.31-.11-.62-.23-.91-.31-.24-.02-.54-.03-.76 0h-.02c-.13-.02-.28-.05-.41-.06-.18.05-.36.15-.55.21-.08.02-.18.02-.26.03-.03.03-.05.03-.08.06-1.28.39-2.45 1.25-3.55 2.3-.23.21-.44.44-.65.63-.1.11-.19.23-.29.32-1.25 1.28-2.45 2.69-3.67 3.94-.32.32-.65.62-.97.86-.16.18-.32.34-.47.5-.1.1-.19.19-.31.28-.36.39-.73.78-1.1 1.12v.02Z"/><path d="M0 522.05c15.79 3.58 23.59 20.84 41.24 7.84 1.03 5.68-2.2 9.6-4.1 14.09-1.9 4.45 8.35 2.26 10.39 1.84 3.72-.75 7.26-1.78 10.49-3.44.04-.02.06-.04.08-.04 1.17-.59 2.3-1.27 3.4-2.04.69-.4 1.37-.75 2.1-1.07 3.09-1.48 6.37-2.59 9.76-3.28 1.46-.32 3.36-.63 5.54-.81 8.37-7.62 9.54-18.74-.89-30.93l12.66-7.72c-.08 4.77 1.23 9.87 2.16 14.52 1.17 5.84 2.37 11.83 4.39 17.45.3.83.67 2.37 1.39 2.97.36.28.26.26.79.04.83-.34 1.64-1.09 2.41-1.58 1.25-.83 2.53-1.7 3.82-2.49.4-.24.79-.49 1.19-.71.47-.26 3.54-1.39 3.54-2.06.24-.57-2.39-9.93-2.71-12.6-.18-1.74-.36-3.52-.49-5.36-.59-7.99-.51-16.64-.26-24.28.14-4.31 1.68-14.8 2.73-23.51 0-.04.02-.1.02-.14.34.06.69.12 1.01.2.02 0 .06 0 .08.02 108.5 19.53 144.29 157.95 230.57 250.77 4.87 14.98 10.01 30.81 8.9 33.38-1.88 4.27-8.07 10.13-11.46 13.61 1.48-25.13-26.85-33.94-45.29-21.73-3.94 2.63 3.13 4.73 1.09 5.82-6.55-1.54-34.47 14.6-29.82 19.59.71.75 16.68 2.95 18.72 7.52-4.81 2.73-9.44 3.42-13.93 7.28-11.73 10.01-8.63 26.87-14.76 39.83 20.64-1.52 36.57 16.7 53.33-5.74 3.34 6.55.87 12.55.22 18.72-.67 6.17 11.02-.32 13.36-1.58 6.81-3.7 12.82-8.09 16.9-14.68l2.3 4.95c22.1-14.47 27.45-36.65 2.57-52.44l12.59-14.17c1.78 6.29 19.59 39.58 23.41 40.07.87-3.98 11-11.77 11.12-13 .06-.79-6.61-11.24-7.99-14.37-2.93-6.75-5.62-14.41-7.92-21.98 7.7 6.11 15.79 11.85 24.34 17.12 5.09-7.38 12.07-13.5 20.08-17.41-20.03-12.37-38.19-27.64-54.14-45-5.34-5.82-10.53-11.99-15.63-18.52-1.11-1.39-2.18-2.85-3.28-4.31-5.42-6.91-10.57-14.03-15.59-21.27-16.56-23.88-31.23-48.98-46.17-73.91 2.89-4.08 8.98-8.79 12.49-11.73-4.23 26.65 24.2 39.81 44.66 29.19 4.39-2.28-2.75-5.46-.51-6.39 6.63 2.55 37.34-11.04 33.05-16.98-.65-.89-17-5.36-18.62-10.49 5.28-2.28 10.17-2.45 15.26-5.98 13.22-9.14 11.83-27.56 19.55-40.59-21.53-1.11-36.13-22.68-55.92-.91-2.79-7.46.44-13.52 1.78-20.03 1.35-6.51-11.48-1.11-14.05-.06-7.46 3.05-14.17 6.93-19.1 13.44l-1.86-5.62c-24.5 12.57-32.43 35.56-8.33 55.76l-13.32 12.27c-9.4-15.57-19.02-30.99-29.39-45.95-13.32-19.17-28.34-37.72-45.69-53.55-13.36-12.19-28.51-22.44-44.86-30.2-1.23-.59-2.47-1.15-3.7-1.7-8.75-3.9-17.79-6.55-26.87-9.54-12.05-3.98-24.26-4.91-31.19-14.45-3.66-4.59-5.88-10.61-5.88-17.2 0-12.64 5.8-19.12 11.85-22.48l3.82-52.77c-9.78 7.78-20.54 15.28-29.13 24.6-.02.02-.04.02-.04.02a75 75 0 0 0-5.84 7.1c-29.35 40.74-17.08 72.64.55 90.08 4.81 4.79 10.01 8.47 14.88 10.98.22 13.75 1.68 33.66.02 35.62-2.39 2.75-8.35 5.74-11.69 7.54 6.83-18.46-12.35-31.52-28.97-26.56-3.56 1.05 1.27 4.23-.51 4.61-4.57-2.67-29.15 3.05-26.81 7.86.34.73 11.83 6 12.31 9.89-4.23.95-7.86.44-12.11 2.3C9.03 500.4 7.5 513.72-.03 522.05Z"/><path d="M137.15 44.1c-.89 5.72 1.72 9.28 1.42 14.09-5.42 82-22.8 330.16-23.33 337.64-.65 9.02 5.26 17.22 14.03 19.41 31.03 7.72 59.58 23.01 83.76 45.08 16.36 14.94 31.9 33.18 47.61 55.74 1.78 2.61 3.56 5.18 5.3 7.78 2.79-13.59 13.26-25.84 29.17-34 1.86-.95 3.88-1.44 5.92-1.44.87 0 1.72.08 2.57.26 4.81-3.34 9.64-5.56 13.5-7.14l.16-.06c4.53-1.86 10.41-3.98 15.81-3.98 7.04 0 10.98 3.54 12.72 5.68 1.88 2.3 2.97 5.07 3.28 8.03 1.19-.14 2.43-.2 3.68-.2 8.39 0 15.87 3.13 22.46 5.9 5.46 2.28 10.61 4.45 15.65 4.71 6 .32 11.2 4.71 12.19 11.1.46 3.05-.36 6.13-1.88 8.81-1.98 3.5-3.28 8.13-4.67 13.02-2.47 8.77-5.44 19.37-13.79 27.45.63.59 1.23 1.27 1.8 2.06 3.42 4.73 3.8 10.78 1.05 16.17-4.45 8.67-19.47 16.27-31.36 19.71-1.17 2.24-3.23 4.73-6.77 6.57a46.4 46.4 0 0 1-21.23 5.16c-2.18 0-4.35-.16-6.45-.44 6.89 11.14 13.99 22.18 21.37 32.83 5.16 7.48 10.09 14.21 15.14 20.68.04.08.97 1.31.97 1.31.77.99 1.54 2.02 2.3 3.01 4.87 6.23 9.91 12.19 14.96 17.73 18.62 20.26 39.58 36.73 62.45 49.13 12.19-.47 23.94 4.53 33.56 14.45 5.82-5.96 12.57-10.23 19.95-12.47 19.57-5.9 47.17 3.15 60.18 27.7 6.27.32 12.68.49 19.17.49 13.38 0 27.09-.65 41.69-1.98-4.91-22.46.95-37.93 7.48-47.47 7.62-11.1 19.31-19 34-23.17-.08-2.83.16-5.76.79-8.81 5.72-27.56 84.14-75.29 103.83-107.73 23.21-38.23 18.01-102.05 15.65-145.68-3.13-58.37-9.36-118.31-18.03-176.07-3.54-23.61-10.43-77.17-18.56-96.96-3.86-9.3-9.68-14.64-18.9-18.19-28.3-11.14-87.32-1.25-107.86-20.86-29.56-28.22 16.09-74.7-31.84-96.9C524.6-2.5 376.41-1.13 314.69 1.16c-35.2 1.29-142.73 5.64-167.31 26.79-4.89 4.23-9.22 9.44-10.23 16.15m496.03 159.75c14.41-1.58 32.37 4.81 40.7 17.04 9.72 14.41 16.5 78.48 18.66 99.08 4.08 39.18 7.64 84.95 8.81 124.23 1.27 43.16 3.62 77.73-32.77 106.93-44.86 36.09-36.85-26.89-39.3-54.5-5.56-62.47-10.23-125.08-15.28-187.55-2-24.93-8.35-54.16-8.47-78.78-.08-14.19 14.56-25.07 27.66-26.44Zm-459.4 40.63c1.27-2.55-.08-5.8 2.35-9.4 2.45-1.9 4.93-3.8 7.4-5.68 35.8-27.33 72.13-55.62 73.57-58.71 2.71-5.92-1.05-16.86 7.18-25.39 8.23-8.51 19.81-10.71 24.12-17.26 4.27-6.53 12.51-25.74 17.91-26.89 4.83-.97 14.6 13.52 21.65 21.87q1.305 1.515 2.43 2.73c6.73 6.99 13.06-8.65 15.02-19.95.12-.61.22-1.19.3-1.78 1.58-11.3 13.61-30.2 14.17-37.76.53-7.58 2.69-16.56 8.71-15.36 6 1.19 16.42 25.55 22.97 29.84 6.55 4.27 6.19 8.81 15.57 5.7 9.36-3.13 10.49-8.39 12.68-6.71 2.14 1.7 50.97 42.56 57.21 50.62 6.27 8.05 15.67 25.49 20.56 31.19 4.91 5.68 10.17 6.81 11.89 14.58.93 4.21 5.26 8.67 10.53 12.8 4.08 3.28 8.75 6.35 12.88 8.94 8.11 10.96 23.45 20.01 23.45 27.15 0 5.58 7.64 108 11.69 161.25.2 2.79-3.82 3.38-4.43.67-8.05-35.56-21.03-90.06-26.79-97.99-8.69-11.93-70.43-53.11-75.85-58.53-5.42-5.4 2.14 5.42 0 13.04-2.18 7.58-9.74 14.09-5.42 20.58 4.33 6.47 18.42 11.91 11.91 21.65-6.49 9.76-21.65 23.84-28.16 30.37-6.51 6.49-15.16 11.91-20.58 20.56-5.42 8.67-13.02 10.84-23.84 14.09-10.84 3.26-33.6 3.26-43.36 3.26s-65.02 40.09-75.85 50.93c-10.82 10.84-13 15.18-14.07 34.67-1.09 19.51-19.51-10.82-18.42-21.65 1.05-10.86-5.44-20.6 1.05-30.35 6.55-9.74 8.69-17.33 14.11-23.84s-36.85 0-43.36 6.51c-6.47 6.49-28.16 35.76-35.76 35.76-6.09 0-12.94-4.97-15.36-6.87-.55-.46-.87-1.15-.81-1.88.81-13.71 8.69-148.59 10.78-152.74Z"/></g></svg>';function initKioskMode(){createKioskBottomNav(),initKioskAttractScreen(),simplifyKioskCheckout()}function createKioskBottomNav(){var e=document.createElement("nav");e.className="kiosk-nav",e.setAttribute("aria-label","Kiosk navigation");var t=document.createElement("button");t.type="button",t.className="kiosk-nav-btn",t.innerHTML='<svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg><span>Back</span>',t.addEventListener("click",function(){window.history.back()});var a=document.createElement("a");a.className="kiosk-nav-btn",a.href="products.html?kiosk=1",a.innerHTML='<svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>Home</span>';var n=document.createElement("a");n.className="kiosk-nav-btn",n.href="reservation.html?kiosk=1",n.innerHTML='<svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM7.17 14.75l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49A1 1 0 0 0 20 4H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7.42c-.14 0-.25-.11-.25-.25z"/></svg><span>Cart</span>';var r=document.createElement("span");function i(){var e=getReservation(),t=0;e.forEach(function(e){t+=e.qty||1}),r.textContent=t>0?String(t):""}r.className="kiosk-nav-badge",r.id="kiosk-cart-badge",n.appendChild(r),e.appendChild(t),e.appendChild(a),e.appendChild(n),document.body.appendChild(e),i(),window.addEventListener("storage",i),window.addEventListener("reservation-changed",i)}function initKioskAttractScreen(){var e=document.createElement("div");e.className="kiosk-attract",e.id="kiosk-attract",e.innerHTML='<img src="images/SV_Logo_PrimaryCircle_offwhite.svg" alt="" class="kiosk-attract-logo"><div class="kiosk-attract-title">Tap to Start</div><div class="kiosk-attract-tagline">Craft your own wine & beer — browse our selection and reserve your kit today.</div>',document.body.appendChild(e);var t=null;function a(){t&&clearTimeout(t),t=setTimeout(n,12e4)}function n(){localStorage.removeItem("sv-reservation"),e.classList.add("active")}function r(){e.classList.contains("active")&&(e.classList.remove("active"),a(),-1===window.location.pathname.indexOf("products.html")&&(window.location.href="products.html?kiosk=1"))}e.addEventListener("click",r),e.addEventListener("touchstart",r);["touchstart","click","scroll","keydown"].forEach(function(t){document.addEventListener(t,function(){e.classList.contains("active")||a()},{passive:!0})}),a()}function showTerminalOverlay(e,t){var a=document.getElementById("kiosk-terminal-overlay");a||((a=document.createElement("div")).className="kiosk-terminal-overlay",a.id="kiosk-terminal-overlay",a.innerHTML='<div class="kiosk-terminal-spinner"></div><div class="kiosk-terminal-msg" id="kiosk-terminal-msg"></div><div class="kiosk-terminal-sub" id="kiosk-terminal-sub"></div>',document.body.appendChild(a));var n=document.getElementById("kiosk-terminal-msg"),r=document.getElementById("kiosk-terminal-sub");n&&(n.textContent=e||"Processing..."),r&&(r.textContent=t||""),a.classList.add("active")}function hideTerminalOverlay(){var e=document.getElementById("kiosk-terminal-overlay");e&&e.classList.remove("active")}function simplifyKioskCheckout(){if("reservation"===document.body.getAttribute("data-page")){var e=document.getElementById("res-email"),t=document.getElementById("res-phone");e&&e.parentElement&&(e.parentElement.classList.add("kiosk-hide"),e.removeAttribute("required")),t&&t.parentElement&&(t.parentElement.classList.add("kiosk-hide"),t.removeAttribute("required"));var a=document.querySelectorAll(".stepper-step");if(a.length>=4){var n=a[2].querySelector(".stepper-label");n&&(n.textContent="Your Name")}}}function loadOpenHours(){var e=document.getElementById("open-hours");if(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL?SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL:null,n="content/timeslots.csv";(a?r(a):Promise.resolve(!1)).then(function(e){if(!e)return r(n)}).catch(function(){return r(n).catch(function(){})})}function r(a){return fetch(a).then(function(e){return e.text()}).then(function(a){return function(a){var n=a.trim().split("\n");if(n.length<2)return!1;for(var r=n[0].split(","),i=[],o=1;o<n.length;o++){var s=n[o].split(",");if(!(s.length<3)){for(var c={},l=0;l<r.length;l++)c[r[l].trim()]=s[l].trim();i.push(c)}}var d=new Date;if(d.setHours(0,0,0,0),0===(i=i.filter(function(e){return new Date(e.date+"T00:00:00")>=d})).length)return!1;var u={};function m(e){var t=Math.floor(e/60),a=e%60;return(t>12?t-12:0===t?12:t)+":"+(a<10?"0"+a:""+a)+" "+(t>=12?"PM":"AM")}i.forEach(function(e){var t=new Date(e.date+"T00:00:00").getDay(),a=e.time.match(/(\d+):(\d+)\s*(AM|PM)/i);if(a){var n=parseInt(a[1],10),r=parseInt(a[2],10),i=a[3].toUpperCase();"PM"===i&&12!==n&&(n+=12),"AM"===i&&12===n&&(n=0);var o=60*n+r;u[t]||(u[t]={min:o,max:o}),o<u[t].min&&(u[t].min=o),o>u[t].max&&(u[t].max=o)}});for(var p='<h2>Open Hours</h2><ul class="open-hours-list">',v=0;v<7;v++){var f=u[v];p+='<li class="open-hours-row'+(f?"":" closed")+'">',p+='<span class="open-hours-day">'+t[v]+"</span>",p+=f?'<span class="open-hours-time">'+m(f.min)+" &ndash; "+m(f.max+30)+"</span>":'<span class="open-hours-time">Closed</span>',p+="</li>"}return p+="</ul>",e.innerHTML=p,!0}(a)})}}function loadFAQ(){var e=document.getElementById("faq-list");e&&fetch("content/about.json").then(function(e){return e.ok?e.json():{}}).then(function(t){var a=t.faqs;if(a&&0!==a.length){var n="";a.forEach(function(e){n+='<div class="faq-item">',n+='<button type="button" class="faq-question">'+escapeHTML(e.question)+"</button>",n+='<div class="faq-answer"><p>'+escapeHTML(e.answer)+"</p></div>",n+="</div>"}),e.innerHTML=n,e.querySelectorAll(".faq-question").forEach(function(e){e.addEventListener("click",function(){this.parentElement.classList.toggle("open")})})}}).catch(function(e){console.error("[FAQ] Error loading:",e)})}function loadFooterHours(){var e=document.getElementById("footer-hours");if(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL?SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL:null,n="content/timeslots.csv";(a?r(a):Promise.resolve(!1)).then(function(e){if(!e)return r(n)}).catch(function(){return r(n).catch(function(){})})}function r(a){return fetch(a).then(function(e){return e.text()}).then(function(a){return function(a){var n=a.trim().split("\n");if(n.length<2)return!1;for(var r=n[0].split(","),i=[],o=1;o<n.length;o++){var s=n[o].split(",");if(!(s.length<3)){for(var c={},l=0;l<r.length;l++)c[r[l].trim()]=s[l].trim();i.push(c)}}var d=new Date;if(d.setHours(0,0,0,0),0===(i=i.filter(function(e){return new Date(e.date+"T00:00:00")>=d})).length)return!1;var u={};function m(e){var t=Math.floor(e/60),a=e%60;return(t>12?t-12:0===t?12:t)+(a>0?":"+(a<10?"0"+a:a):"")+(t>=12?"PM":"AM")}i.forEach(function(e){var t=new Date(e.date+"T00:00:00").getDay(),a=e.time.match(/(\d+):(\d+)\s*(AM|PM)/i);if(a){var n=parseInt(a[1],10),r=parseInt(a[2],10),i=a[3].toUpperCase();"PM"===i&&12!==n&&(n+=12),"AM"===i&&12===n&&(n=0);var o=60*n+r;u[t]||(u[t]={min:o,max:o}),o<u[t].min&&(u[t].min=o),o>u[t].max&&(u[t].max=o)}});for(var p="",v=0;v<7;v++){var f=u[v];p+='<span class="footer-hours-day'+(f?"":" closed")+'">',p+='<span class="footer-hours-abbr">'+t[v]+"</span> ",p+=f?m(f.min)+"–"+m(f.max+30):"Closed",p+="</span>"}return e.innerHTML=p,!0}(a)})}}function loadSocialLinks(){var e=document.querySelector(".footer-social");if(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL?SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL:null;t&&fetch(t).then(function(e){return e.ok?e.text():""}).then(function(t){if(t.trim()){for(var n=t.trim().split("\n"),r={},i=1;i<n.length;i++){var o=a(n[i]);if("social"===(o[0]||"").toLowerCase().trim()){var s=(o[2]||"").toLowerCase().trim(),c=(o[4]||"").trim();s&&c&&(r[s]=c)}}if(Object.keys(r).length>0){var l=e.querySelector('a[aria-label*="Instagram"]'),d=e.querySelector('a[aria-label*="Facebook"]');l&&r.instagram&&(l.href=r.instagram),d&&r.facebook&&(d.href=r.facebook)}}}).catch(function(){})}function a(e){for(var t=[],a="",n=!1,r=0;r<e.length;r++){var i=e[r];'"'===i?n=!n:","!==i||n?a+=i:(t.push(a),a="")}return t.push(a),t}}function getTintClass(e){if(e.tint)return"tint-"+e.tint.toLowerCase().replace(/\s+/g,"");if(!e.subcategory)return"";return{red:"tint-red",white:"tint-white",rose:"tint-rose",ros:"tint-rose",fruit:"tint-fruit",specialty:"tint-specialty",pilsner:"tint-pilsner",amber:"tint-amber",wheat:"tint-wheat",ipa:"tint-ipa",pale:"tint-pale",session:"tint-session",saison:"tint-saison",lager:"tint-lager",stout:"tint-stout",porter:"tint-porter",redale:"tint-redale",brown:"tint-brown"}[e.subcategory.toLowerCase().replace(/[^a-z]/g,"")]||""}function buildLabelNotesToggle(e){var t=document.createElement("div");t.className="notes-wrap";var a=document.createElement("button");a.type="button",a.className="notes-toggle",a.innerHTML='Tasting Notes <span class="chevron">&#9660;</span>';var n=document.createElement("div");if(n.className="notes-body",e.sku){var r=document.createElement("div");r.className="notes-image";var i=document.createElement("img");i.src="images/products/"+e.sku+".png",i.alt=e.name||"Product image",i.loading="lazy",i.onerror=function(){this.parentElement.remove()},r.appendChild(i),n.appendChild(r)}if(e.tasting_notes){var o=document.createElement("div");o.className="notes-text";var s=document.createElement("p");s.textContent=e.tasting_notes,o.appendChild(s),n.appendChild(o)}var c,l,d=(e.body||"").trim(),u=(e.oak||"").trim(),m=(e.sweetness||"").trim();if(d||u||m){var p=document.createElement("div");p.className="wine-traits";for(var v=[{label:"Body",value:d},{label:"Oak",value:u},{label:"Sweetness",value:m}],f=0;f<v.length;f++)if(v[f].value){var h=document.createElement("div");h.className="trait-col";var g=document.createElement("span");g.className="trait-label",g.textContent=v[f].label;var E=document.createElement("span");E.className="trait-value",E.textContent=v[f].value,h.appendChild(g),h.appendChild(E),p.appendChild(h)}n.appendChild(p)}return a.addEventListener("click",(c=t,l=e,function(){c.classList.toggle("open")&&trackEvent("detail",l.sku||"",l.name||"")})),t.appendChild(a),t.appendChild(n),t}function formatKitPrice(e){return e.replace(/\.00\b/g,"")}function buildLabelPriceFooter(e){var t=parseFloat(e.discount)||0,a="TRUE"===(e.pricing_from||"").trim().toUpperCase()?"+":"",n=(e.retail_instore||"").trim(),r=(e.retail_kit||"").trim(),i=document.createElement("div");if(i.className="price-footer",n){var o=document.createElement("div");o.className="price-col";var s=document.createElement("div");s.className="price-label",s.textContent="Ferment in store",o.appendChild(s);var c=document.createElement("div");if(c.className="price-value",t>0){var l=formatKitPrice((parseFloat(n.replace(/[^0-9.]/g,""))*(1-t/100)).toFixed(2));c.innerHTML='<s style="color:#999;font-size:0.8rem;">'+formatKitPrice(n)+"</s> $"+l+a}else c.textContent=formatKitPrice(n)+a;o.appendChild(c),i.appendChild(o)}if(r){var d=document.createElement("div");d.className="price-col";var u=document.createElement("div");u.className="price-label",u.textContent="Kit only",d.appendChild(u);var m=document.createElement("div");if(m.className="price-value",t>0){var p=formatKitPrice((parseFloat(r.replace(/[^0-9.]/g,""))*(1-t/100)).toFixed(2));m.innerHTML='<s style="color:#999;font-size:0.8rem;">'+formatKitPrice(r)+"</s> $"+p+a}else m.textContent=formatKitPrice(r)+a;d.appendChild(m),i.appendChild(d)}return i}function loadFeaturedProducts(){var e=document.getElementById("promo-section"),t=document.getElementById("promo-news-content"),a=document.getElementById("promo-featured-products");if(e){if(a){var n=document.createElement("div");n.className="promo-loading-skeleton",n.appendChild(createSkeletonCard()),a.innerHTML="",a.appendChild(n)}var r,i="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_CSV_URL?SHEETS_CONFIG.PUBLISHED_CSV_URL:null,o="content/products.csv",s="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL?SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL:null,c="sv-products-csv",l="sv-products-csv-ts",d="sv-homepage-csv",u="sv-homepage-csv-ts",m=b(c,l),p=b(d,u);p?(r=Promise.resolve(p.data),!p.fresh&&s&&fetch(s).then(function(e){return e.ok?e.text():""}).then(function(e){e&&C(d,u,e)})):r=s?fetch(s).then(function(e){return e.ok?e.text():""}).then(function(e){return e&&C(d,u,e),e}):fetch("content/home.json").then(function(e){return e.ok?e.json():{}}).then(function(e){return{isJson:!0,data:e}});var v,f="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.MIDDLEWARE_URL?SHEETS_CONFIG.MIDDLEWARE_URL:"",h="sv-products-mw",g="sv-products-mw-ts",E=f?(v=function(){try{var e=localStorage.getItem(h),t=parseInt(localStorage.getItem(g),10)||0;if(e)return{data:JSON.parse(e),fresh:Date.now()-t<6e5}}catch(e){}return null}(),v?(v.fresh||L().then(y).catch(function(){}),Promise.resolve(v.data)):L().then(function(e){return y(e),e})).catch(function(){return S()}):S();Promise.all([r,E]).then(function(n){var r,i,o=n[0],s=n[1],c={"promo-news":[],"promo-featured-skus":[],"instafeed-url":""};if(o&&o.isJson)c=o.data;else if("string"==typeof o&&o.trim()){var l=o.trim().split("\n");if(l.length>1)for(var d=1;d<l.length;d++){var u=k(l[d]),m=(u[0]||"").toLowerCase().trim();if("news"===m)c["promo-news"].push({type:"news",date:(u[1]||"").trim(),title:(u[2]||"").trim(),text:(u[3]||"").trim()});else if("instafeed"===m)c["instafeed-url"]=(u[3]||"").trim();else if("featured"===m){var p=(u[4]||"").trim(),v=(u[3]||"").trim();p&&c["promo-featured-skus"].push({sku:p,description:v})}}}if(c["promo-news"].sort(function(e,t){return new Date(t.date)-new Date(e.date)}),t&&c["promo-news"]&&c["promo-news"].length>0&&(r=c["promo-news"],i="",r.forEach(function(e){i+='<div class="promo-news-item">',i+='<span class="promo-news-date">'+x(e.date||"")+"</span>",i+="<h3>"+x(e.title||"")+"</h3>",i+="<p>"+x(e.text||"")+"</p>",i+="</div>"}),t.innerHTML=i),t&&c["instafeed-url"]){var f='<div class="promo-instagram-feed">';f+="<h3>Follow Us on Instagram</h3>",f+='<iframe src="'+x(c["instafeed-url"])+'" frameborder="0" scrolling="no" allowtransparency="true" loading="lazy" class="promo-instagram-feed-iframe"></iframe>',f+="</div>",t.innerHTML+=f}!function(t,n){var r=[];n&&n.length>0&&n.forEach(function(e){var a="object"==typeof e?e.sku:e,n=t.find(function(e){return e.sku===a});n&&(n._featuredDescription=("object"==typeof e?e.description:"")||"",r.push(n))});0===r.length&&(r=t.filter(function(e){return"TRUE"===(e.featured||"").trim().toUpperCase()||"TRUE"===(e.favorite||"").trim().toUpperCase()}));0===r.length&&(r=t.filter(function(e){return parseFloat(e.discount)>0}).slice(0,3));0===r.length&&(r=t.slice(0,3));if(0===r.length)return void e.classList.add("hidden");a.innerHTML="";var i=document.getElementById("promo-featured-descriptions");i&&(i.innerHTML="");var o=0,s=!1;if(r.forEach(function(e,t){var n=function(e){var t,a=(e.type||"").toLowerCase();t=-1!==a.indexOf("wine")?function(e){var t=getTintClass(e),a=document.createElement("div");a.className="label-wine"+(t?" "+t:""),e.sku&&a.setAttribute("data-sku",e.sku);var n=parseFloat(e.discount)||0;if(n>0){var r=document.createElement("span");r.className="discount-badge",r.textContent=Math.round(n)+"% OFF",a.appendChild(r)}var i=document.createElement("div");i.className="label-body";var o=document.createElement("div");o.className="brand",o.textContent=e.brand||"",i.appendChild(o);var s=document.createElement("div");s.className="ornament",i.appendChild(s);var c=document.createElement("div");if(c.className="wine-name",c.textContent=e.name||"",i.appendChild(c),e.subcategory){var l=document.createElement("div");l.className="subcategory",l.textContent=e.subcategory,i.appendChild(l)}var d=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(e.time||d){var u=document.createElement("div");u.className="time";var m=[];e.time&&m.push(e.time),d&&m.push(d+"L"),u.textContent=m.join(" · "),i.appendChild(u)}if(e.abv){var p=document.createElement("div");p.className="abv",p.textContent=e.abv+(-1===e.abv.toLowerCase().indexOf("abv")?" ABV":""),i.appendChild(p)}a.appendChild(i);var v=(e.retail_instore||"").trim(),f=(e.retail_kit||"").trim();(v||f)&&a.appendChild(buildLabelPriceFooter(e));var h=document.createElement("div");h.className="reserve-link";var g=e.name+"|"+e.brand;return N(h,e,g),a.appendChild(h),a}(e):-1!==a.indexOf("beer")?function(e){var t=getTintClass(e),a=document.createElement("div");a.className="label-beer"+(t?" "+t:""),e.sku&&a.setAttribute("data-sku",e.sku);var n=parseFloat(e.discount)||0;if(n>0){var r=document.createElement("span");r.className="discount-badge",r.textContent=Math.round(n)+"% OFF",a.appendChild(r)}var i=document.createElement("div");i.className="label-body";var o=document.createElement("div");o.className="sv-logo",o.innerHTML=SV_LOGO_SVG,i.appendChild(o);var s=document.createElement("div");s.className="brand",s.textContent=e.brand||"",i.appendChild(s);var c=document.createElement("div");c.className="gold-rule",i.appendChild(c);var l=document.createElement("div");if(l.className="beer-name",l.textContent=e.name||"",i.appendChild(l),e.subcategory){var d=document.createElement("div");d.className="subcategory",d.textContent=e.subcategory,i.appendChild(d)}var u=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(e.time||u){var m=document.createElement("div");m.className="time";var p=[];e.time&&p.push(e.time),u&&p.push(u+"L"),m.textContent=p.join(" · "),i.appendChild(m)}if(e.abv){var v=document.createElement("div");v.className="abv",v.textContent=e.abv+(-1===e.abv.toLowerCase().indexOf("abv")?" ABV":""),i.appendChild(v)}a.appendChild(i);var f=(e.retail_instore||"").trim(),h=(e.retail_kit||"").trim();(f||h)&&a.appendChild(buildLabelPriceFooter(e));var g=document.createElement("div");g.className="reserve-link";var E=e.name+"|"+e.brand;return N(g,e,E),a.appendChild(g),a}(e):function(e){var t=document.createElement("div");t.className="product-card",e.sku&&t.setAttribute("data-sku",e.sku);var a=document.createElement("div");a.className="product-card-header";var n=document.createElement("p");n.className="product-brand",n.textContent=e.brand||"",a.appendChild(n);var r=document.createElement("h4");r.textContent=e.name||"",a.appendChild(r),t.appendChild(a);var i=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(e.subcategory||e.time||i){var o=document.createElement("div");o.className="product-detail-row";var s=[];e.subcategory&&s.push(e.subcategory),e.time&&s.push(e.time),i&&s.push(i+"L");for(var c=0;c<s.length;c++){if(c>0){var l=document.createElement("span");l.className="detail-sep",l.textContent="·",o.appendChild(l)}var d=document.createElement("span");d.textContent=s[c],o.appendChild(d)}t.appendChild(o)}if(e.tasting_notes){var u=document.createElement("div");u.className="product-notes";var m=document.createElement("button");m.type="button",m.className="product-notes-toggle",m.setAttribute("aria-expanded","false"),m.innerHTML='More Information <span class="product-notes-chevron">&#9660;</span>';var p=document.createElement("div");if(p.className="product-notes-body",e.sku){var v=document.createElement("div");v.className="product-notes-image";var f=document.createElement("img");f.src="images/products/"+e.sku+".png",f.alt=e.name||"Product image",f.loading="lazy",f.onerror=function(){this.parentElement.remove()},v.appendChild(f),p.appendChild(v)}var h=document.createElement("div");h.className="product-notes-text";var g=document.createElement("p");g.textContent=e.tasting_notes,h.appendChild(g),p.appendChild(h),m.addEventListener("click",(E=u,b=m,function(){var e=E.classList.toggle("open");b.setAttribute("aria-expanded",e?"true":"false")})),u.appendChild(m),u.appendChild(p),t.appendChild(u)}var E,b;var C=parseFloat(e.discount)||0;if(C>0){var y=document.createElement("span");y.className="product-discount-badge",y.textContent=Math.round(C)+"% OFF",t.appendChild(y)}var L="TRUE"===(e.pricing_from||"").trim().toUpperCase(),S=L?"+":"",k=(e.retail_instore||"").trim(),x=(e.retail_kit||"").trim();if(k||x){var _=document.createElement("div");if(_.className="product-prices",k){var w=document.createElement("div");if(w.className="product-price-box",C>0){var I=formatKitPrice((parseFloat(k.replace(/[^0-9.]/g,""))*(1-C/100)).toFixed(2));w.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-original">'+formatKitPrice(k)+'</span><span class="product-price-value">$'+I+S+"</span>"}else w.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-value">'+formatKitPrice(k)+S+"</span>";_.appendChild(w)}if(x){var F=document.createElement("div");if(F.className="product-price-box",C>0){var T=formatKitPrice((parseFloat(x.replace(/[^0-9.]/g,""))*(1-C/100)).toFixed(2));F.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-original">'+formatKitPrice(x)+'</span><span class="product-price-value">$'+T+S+"</span>"}else F.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-value">'+formatKitPrice(x)+S+"</span>";_.appendChild(F)}t.appendChild(_)}var A=document.createElement("div");A.className="product-reserve-wrap";var M=e.name+"|"+e.brand;return N(A,e,M),t.appendChild(A),t}(e);return t}(e);if(n.dataset.carouselIndex=t,0===t&&n.classList.add("promo-slide-active"),a.appendChild(n),i){var r=document.createElement("div");r.className="promo-featured-desc",0===t&&r.classList.add("promo-slide-active"),e._featuredDescription?r.innerHTML="<p>"+x(e._featuredDescription)+"</p>":r.classList.add("promo-featured-desc-empty"),i.appendChild(r)}}),function(){var e,t=a.querySelectorAll(".product-card, .label-wine, .label-beer"),n=i?i.querySelectorAll(".promo-featured-desc"):[];for(e=0;e<t.length;e++)t[e].style.position="relative",t[e].style.opacity="1",t[e].style.transform="none";var r=a.offsetHeight;for(r>0&&(a.style.minHeight=r+"px"),e=0;e<t.length;e++)t[e].style.position="",t[e].style.opacity="",t[e].style.transform="";if(i&&n.length>0){var o=0;for(e=0;e<n.length;e++)if(!n[e].classList.contains("promo-featured-desc-empty")){n[e].style.position="relative",n[e].style.opacity="1",n[e].style.transform="none";var s=n[e].offsetHeight;s>o&&(o=s),n[e].style.position="",n[e].style.opacity="",n[e].style.transform=""}o>0&&(i.style.minHeight=o+"px")}}(),r.length>1){var c=document.getElementById("promo-carousel-nav"),l=document.getElementById("promo-carousel-dots");if(c&&(c.style.display="flex"),l){l.innerHTML="";for(var d=0;d<r.length;d++){var u=document.createElement("button");u.type="button",u.className="promo-carousel-dot"+(0===d?" active":""),u.dataset.index=d,u.setAttribute("aria-label","Go to product "+(d+1)),l.appendChild(u)}}function m(e){if(!s&&e!==o){s=!0;var t=a.querySelectorAll(".product-card, .label-wine, .label-beer"),n=l?l.querySelectorAll(".promo-carousel-dot"):[],r=t[o],c=t[e];r.classList.remove("promo-slide-active"),r.classList.add("promo-slide-exit"),c.classList.add("promo-slide-active");var d=i?i.querySelectorAll(".promo-featured-desc"):[];d.length>0&&(d[o]&&(d[o].classList.remove("promo-slide-active"),d[o].classList.add("promo-slide-exit")),d[e]&&d[e].classList.add("promo-slide-active")),n.forEach(function(t,a){t.classList.toggle("active",a===e)}),setTimeout(function(){r.classList.remove("promo-slide-exit"),d.length>0&&d[o]&&d[o].classList.remove("promo-slide-exit"),o=e,s=!1},500)}}var p=document.querySelector(".promo-carousel-prev"),v=document.querySelector(".promo-carousel-next");p&&p.addEventListener("click",function(){m((o-1+r.length)%r.length)}),v&&v.addEventListener("click",function(){m((o+1)%r.length)}),l&&l.addEventListener("click",function(e){e.target.classList.contains("promo-carousel-dot")&&m(parseInt(e.target.dataset.index,10))});var f=window.matchMedia("(prefers-reduced-motion: reduce)");setInterval(function(){f.matches||(a.querySelector(".product-notes.open, .notes-wrap.open")||m((o+1)%r.length))},12e3)}}(s,c["promo-featured-skus"]||[])}).catch(function(){e&&e.classList.add("hidden")})}function b(e,t){try{var a=localStorage.getItem(e),n=parseInt(localStorage.getItem(t),10)||0;if(a)return{data:a,fresh:Date.now()-n<36e5}}catch(e){}return null}function C(e,t,a){try{localStorage.setItem(e,a),localStorage.setItem(t,String(Date.now()))}catch(e){}}function y(e){try{localStorage.setItem(h,JSON.stringify(e)),localStorage.setItem(g,String(Date.now()))}catch(e){}}function L(){return fetch(f+"/api/products").then(function(e){if(!e.ok)throw new Error("Middleware "+e.status);return e.json()}).then(function(e){return(e.items||[]).map(function(e){var t={name:e.name||"",sku:e.sku||"",brand:e.brand||"",stock:null!=e.stock_on_hand?String(e.stock_on_hand):"0",description:e.description||"",discount:null!=e.discount?String(e.discount):"0"};return e.custom_fields&&e.custom_fields.length&&e.custom_fields.forEach(function(e){var a=(e.label||"").toLowerCase().replace(/\s+/g,"_");a&&void 0!==e.value&&null!==e.value&&(t[a]=String(e.value))}),t.retail_instore||null==e.rate||(t.retail_instore="$"+parseFloat(e.rate).toFixed(2)),t})})}function S(){var e;m?(e=Promise.resolve(m.data),m.fresh||fetch(i||o).then(function(e){return e.ok?e.text():""}).then(function(e){e&&C(c,l,e)})):(e=i?fetch(i).then(function(e){return e.ok?e.text():""}).catch(function(){return fetch(o).then(function(e){return e.text()})}):fetch(o).then(function(e){return e.text()})).then(function(e){e&&C(c,l,e)});return e.then(function(e){return e?function(e){var t=e.trim().split("\n");if(t.length<2)return[];for(var a=t[0].split(",").map(function(e){return e.trim().toLowerCase().replace(/\s+/g,"_")}),n=[],r=1;r<t.length;r++){var i=_(t[r]);if(!(i.length<2)){for(var o={},s=0;s<a.length;s++)o[a[s]]=(i[s]||"").trim();n.push(o)}}return n}(e):[]})}function k(e){for(var t=[],a="",n=!1,r=0;r<e.length;r++){var i=e[r];'"'===i?n=!n:","!==i||n?a+=i:(t.push(a),a="")}return t.push(a),t}function x(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function _(e){for(var t=[],a="",n=!1,r=0;r<e.length;r++){var i=e[r];'"'===i?n=!n:","!==i||n?a+=i:(t.push(a),a="")}return t.push(a),t}function N(e,t,a){var n=document.createElement("button");n.type="button",n.className="product-reserve-btn",n.textContent="Reserve",n.addEventListener("click",function(){isReserved(a)||setReservationQty(t,1),window.location.href="products.html?sku="+encodeURIComponent(t.sku)}),e.appendChild(n)}}function fetchCSV(e){return fetch(e).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status);return e.text()})}function createSkeletonCard(){var e=document.createElement("div");return e.className="skeleton-card",e.innerHTML='<div class="skeleton-element skeleton-brand"></div><div class="skeleton-element skeleton-title"></div><div class="skeleton-element skeleton-detail"></div><div class="skeleton-badges"><div class="skeleton-element skeleton-badge"></div><div class="skeleton-element skeleton-badge"></div></div><div class="skeleton-prices"><div class="skeleton-element skeleton-price-box"></div><div class="skeleton-element skeleton-price-box"></div></div><div class="skeleton-element skeleton-notes"></div>',e}function showCatalogSkeletons(e,t){if(e){var a=document.createElement("div");a.className="catalog-skeleton-grid";for(var n=0;n<t;n++)a.appendChild(createSkeletonCard());e.appendChild(a)}}document.addEventListener("DOMContentLoaded",function(){-1===window.location.search.indexOf("kiosk=1")&&!0!==window.navigator.standalone||(document.body.classList.add("kiosk-mode"),document.querySelectorAll("a[href]").forEach(function(e){var t=e.getAttribute("href");t&&0!==t.indexOf("http")&&0!==t.indexOf("mailto:")&&0!==t.indexOf("tel:")&&e.setAttribute("href",t+(-1!==t.indexOf("?")?"&":"?")+"kiosk=1")}),initKioskMode());var e=document.querySelector(".nav-toggle"),t=document.querySelector(".nav-list"),a=document.createElement("div");a.className="nav-backdrop";var n=document.querySelector(".main-nav");if(n)n.appendChild(a);else{var r=document.querySelector("header");r&&r.parentNode&&r.parentNode.insertBefore(a,r.nextSibling)}function i(){t&&t.classList.remove("open"),a.classList.remove("open"),document.body.classList.remove("nav-open")}e&&t&&(e.addEventListener("click",function(){t.classList.toggle("open"),a.classList.toggle("open"),document.body.classList.toggle("nav-open")}),a.addEventListener("click",function(){i()}),t.querySelectorAll("a").forEach(function(e){e.addEventListener("click",function(){i()})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&t.classList.contains("open")&&i()}));document.addEventListener("click",function(e){e.target.closest&&e.target.closest(".product-notes-btn")||document.querySelectorAll(".product-notes-tooltip.show").forEach(function(e){e.classList.remove("show")})});var o=document.body.getAttribute("data-page");if(o){var s=fetch("content/shared.json").then(function(e){return e.ok?e.json():{}}).catch(function(){return{}}),c=fetch("content/"+o+".json").then(function(e){return e.ok?e.json():{}}).catch(function(){return{}});Promise.all([s,c]).then(function(e){var t,a=e[0],n=e[1],r={};for(t in a)a.hasOwnProperty(t)&&(r[t]=a[t]);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);document.querySelectorAll("[data-content]").forEach(function(e){var t=e.getAttribute("data-content");void 0!==r[t]&&(e.innerHTML=r[t])})}).catch(function(){})}var l=document.querySelector(".site-header");if(l){var d=function(){document.documentElement.style.setProperty("--header-height",l.offsetHeight+"px")};d(),window.addEventListener("resize",d)}"products"===o&&(loadProducts(),initReservationBar(),initProductTabs(),initCatalogViewToggle()),"reservation"===o&&initReservationPage(),"about"!==o&&"contact"!==o||loadOpenHours(),"contact"===o&&setupContactValidation(),"about"===o&&loadFAQ(),"home"===o&&(loadFeaturedProducts(),initReservationBar(),setupBeerWaitlistForm()),loadFooterHours(),loadSocialLinks()});var _eqResizeTimer,applyKitsFilters=null,catalogViewDefaults={kits:"cards",ingredients:"table",services:"table"},catalogViewMode="cards";function getCatalogViewMode(e){return localStorage.getItem("catalogViewMode-"+e)||catalogViewDefaults[e]||"cards"}function syncToggleButtons(e){document.querySelectorAll(".view-toggle-btn").forEach(function(t){t.classList.toggle("active",t.getAttribute("data-view")===e)})}function initCatalogViewToggle(){var e=document.querySelectorAll(".view-toggle-btn"),t=document.querySelector(".product-tab-btn.active"),a=t?t.getAttribute("data-product-tab"):"kits";syncToggleButtons(catalogViewMode=getCatalogViewMode(a)),e.forEach(function(e){e.addEventListener("click",function(){var t=e.getAttribute("data-view");if(t!==catalogViewMode){catalogViewMode=t;var a=document.querySelector(".product-tab-btn.active"),n=a?a.getAttribute("data-product-tab"):"kits";localStorage.setItem("catalogViewMode-"+n,t),syncToggleButtons(t),"kits"===n?applyKitsFilters&&applyKitsFilters():"ingredients"===n?renderIngredients():"services"===n&&renderServices()}})})}function equalizeCardHeights(){document.querySelectorAll(".product-grid").forEach(function(e){for(var t=e.children,a=0;a<t.length;a++)t[a].style.minHeight="";for(var n={},r=0;r<t.length;r++){var i=t[r].offsetTop;n[i]||(n[i]=[]),n[i].push(t[r])}for(var o=Object.keys(n),s=0;s<o.length;s++){var c=n[o[s]];if(!(c.length<2)){for(var l=0,d=0;d<c.length;d++)c[d].offsetHeight>l&&(l=c[d].offsetHeight);for(var u=0;u<c.length;u++)c[u].style.minHeight=l+"px"}}})}function loadProducts(){var e=[],t=!1,a={type:[],brand:[],subcategory:[],time:[],body:[],oak:[],sweetness:[]},n=!1,r="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.MIDDLEWARE_URL?SHEETS_CONFIG.MIDDLEWARE_URL:"";function i(){var e="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_CSV_URL?SHEETS_CONFIG.PUBLISHED_CSV_URL:null,t="sv-products-csv",a="sv-products-csv-ts";function n(e){try{localStorage.setItem(t,e),localStorage.setItem(a,String(Date.now()))}catch(e){}}var r,i=function(){try{var e=localStorage.getItem(t),n=parseInt(localStorage.getItem(a),10)||0;if(e)return{csv:e,fresh:Date.now()-n<36e5}}catch(e){}return null}();i?(r=Promise.resolve(i.csv),i.fresh||fetchCSV(e||"content/products.csv").then(n).catch(function(){})):(r=e?fetchCSV(e).catch(function(){return fetchCSV("content/products.csv")}):fetchCSV("content/products.csv")).then(n);return r.then(function(e){for(var t=e.trim().split("\n"),a=t[0].split(","),n=[],r=1;r<t.length;r++){var i=parseCSVLine(t[r]);if(!(i.length<a.length)){for(var o={},s=0;s<a.length;s++)o[a[s].trim()]=i[s].trim();(o.name||o.sku)&&(o.hide&&"true"===o.hide.toLowerCase()||n.push(o))}}return n})}var o="sv-products-mw",s="sv-products-mw-ts";function c(e){try{localStorage.setItem(o,JSON.stringify(e)),localStorage.setItem(s,String(Date.now()))}catch(e){}}function l(){return fetch(r+"/api/products").then(function(e){if(!e.ok)throw new Error("Middleware returned "+e.status);return e.json()}).then(function(e){return(e.items||[]).map(function(e){var t={name:e.name||"",sku:e.sku||"",brand:e.brand||"",stock:null!=e.stock_on_hand?String(e.stock_on_hand):"0",description:e.description||"",discount:null!=e.discount?String(e.discount):"0"};if(e.custom_fields&&e.custom_fields.length&&e.custom_fields.forEach(function(e){var a=(e.label||"").toLowerCase().replace(/\s+/g,"_");a&&void 0!==e.value&&null!==e.value&&(t[a]=String(e.value))}),null!=e.rate){var a=parseFloat(e.rate);t.retail_kit||(t.retail_kit="$"+a.toFixed(2)),t.retail_instore||(t.retail_instore="$"+(a+50).toFixed(2))}return t})})}var d=document.getElementById("product-catalog");function u(t,a,n){var r=document.getElementById(t);if(r){var i=document.createElement("span");i.className="catalog-filter-label",i.textContent=n,r.appendChild(i);var o=[];if(e.forEach(function(e){var t=e[a]||"";t&&-1===o.indexOf(t)&&o.push(t)}),"time"===a)o.sort(function(e,t){return(parseFloat(e)||0)-(parseFloat(t)||0)});else if("subcategory"===a){var s=["red","white","rosé","rose","fruit","specialty"];o.sort(function(e,t){var a=s.indexOf(e.toLowerCase()),n=s.indexOf(t.toLowerCase());return-1===a&&(a=s.length),-1===n&&(n=s.length),a-n})}else if("body"===a){var c=["light","light-medium","medium","medium-full","full"];o.sort(function(e,t){var a=c.indexOf(e.toLowerCase()),n=c.indexOf(t.toLowerCase());return-1===a&&(a=c.length),-1===n&&(n=c.length),a-n})}else if("sweetness"===a){var l=["dry","off-dry","semi-sweet","sweet"];o.sort(function(e,t){var a=l.indexOf(e.toLowerCase()),n=l.indexOf(t.toLowerCase());return-1===a&&(a=l.length),-1===n&&(n=l.length),a-n})}else o.sort();if(0!==o.length){var d=m("All",t,a);d.classList.add("active"),r.appendChild(d),o.forEach(function(e){r.appendChild(m(e,t,a))})}else r.classList.add("hidden")}}function m(e,t,n){var r=document.createElement("button");return r.className="catalog-filter-btn",r.type="button",r.textContent=e,r.setAttribute("data-field",n),r.setAttribute("data-value",e),r.addEventListener("click",function(){if("All"===e)a[n]=[];else{var r=a[n].indexOf(e);-1!==r?a[n].splice(r,1):a[n].push(e)}var i=document.getElementById(t),o=i.querySelectorAll(".catalog-filter-btn");o.forEach(function(e){e.classList.remove("active")}),0===a[n].length?i.querySelector('[data-value="All"]').classList.add("active"):o.forEach(function(e){-1!==a[n].indexOf(e.getAttribute("data-value"))&&e.classList.add("active")}),h(),p()}),r}function p(){["type","brand","subcategory","time","body","oak","sweetness"].forEach(function(t){var n="filter-"+("subcategory"===t?"subcategory":t),r=document.getElementById(n);r&&r.querySelectorAll(".catalog-filter-btn").forEach(function(n){var r=n.getAttribute("data-value");if("All"!==r){var i=e.some(function(e){return e[t]===r&&function(e,t){for(var n=["type","brand","subcategory","time","body","oak","sweetness"],r=0;r<n.length;r++){var i=n[r];if(i!==t&&a[i].length>0&&-1===a[i].indexOf(e[i]))return!1}return!0}(e,t)});if(i)n.classList.remove("disabled"),n.disabled=!1;else{n.classList.add("disabled"),n.disabled=!0,n.classList.remove("active");var o=a[t].indexOf(r);-1!==o&&a[t].splice(o,1)}}})})}function v(e){var t=e.retail_instore||e.retail_kit||"0";return parseFloat(t.replace("$",""))||0}function f(e){var t=(e||"").match(/(\d+)/);return t?parseInt(t[1],10):0}function h(){var r=document.getElementById("catalog-search"),i=r?r.value.toLowerCase():"",o=e.filter(function(e){if(a.type.length>0&&-1===a.type.indexOf(e.type))return!1;if(a.brand.length>0&&-1===a.brand.indexOf(e.brand))return!1;if(a.subcategory.length>0&&-1===a.subcategory.indexOf(e.subcategory))return!1;if(a.time.length>0&&-1===a.time.indexOf(e.time))return!1;if(a.body.length>0&&-1===a.body.indexOf(e.body))return!1;if(a.oak.length>0&&-1===a.oak.indexOf(e.oak))return!1;if(a.sweetness.length>0&&-1===a.sweetness.indexOf(e.sweetness))return!1;if(n&&!(parseFloat(e.discount)>0))return!1;if(!i)return!0;var t=(e.name||"").toLowerCase(),r=(e.subcategory||"").toLowerCase(),o=(e.tasting_notes||"").toLowerCase(),s=(e.brand||"").toLowerCase();return-1!==t.indexOf(i)||-1!==r.indexOf(i)||-1!==o.indexOf(i)||-1!==s.indexOf(i)}),s=document.getElementById("catalog-sort"),c=s?s.value:"name-asc";o.sort(function(e,a){if(!t){var n="true"===(e.favorite||"").toLowerCase()?0:1,r="true"===(a.favorite||"").toLowerCase()?0:1;if(n!==r)return n-r;if(0===n&&0===r)return(e._favRand||0)-(a._favRand||0)}switch(c){case"name-asc":return(e.name||"").localeCompare(a.name||"");case"name-desc":return(a.name||"").localeCompare(e.name||"");case"brand-asc":return(e.brand||"").localeCompare(a.brand||"");case"brand-desc":return(a.brand||"").localeCompare(e.brand||"");case"style-asc":return(e.subcategory||"").localeCompare(a.subcategory||"");case"style-desc":return(a.subcategory||"").localeCompare(e.subcategory||"");case"price-asc":return v(e)-v(a);case"price-desc":return v(a)-v(e);case"time-asc":return f(e.time)-f(a.time);case"time-desc":return f(a.time)-f(e.time);case"reserved-desc":return getReservedQty(a.name+"|"+a.brand)-getReservedQty(e.name+"|"+e.brand);case"reserved-asc":return getReservedQty(e.name+"|"+e.brand)-getReservedQty(a.name+"|"+a.brand);default:return 0}}),function(e){var t=document.getElementById("product-catalog");if(!t)return;var a=t.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid");if(a.forEach(function(e){e.parentNode.removeChild(e)}),0===e.length){var n=document.createElement("p");return n.className="catalog-no-results",n.textContent="No products found.",void t.appendChild(n)}function r(e){return void 0!==e.available&&""!==e.available?parseInt(e.available,10)||0:parseInt(e.stock,10)||0}var i=e.filter(function(e){return r(e)>0}),o=e.filter(function(e){return r(e)<=0});if(E(t,"Currently available",i),i.length>0&&o.length>0){var s=document.createElement("div");s.className="section-icon catalog-divider";var c=document.createElement("img");c.src="images/Icon_green.svg",c.alt="",c.setAttribute("aria-hidden","true"),s.appendChild(c),t.appendChild(s)}E(t,"Available to order",o,"catalog-section--order"),equalizeCardHeights()}(o),function(){var e=document.getElementById("filter-summary");if(!e)return;e.innerHTML="";var t=!1;if(Object.keys(a).forEach(function(n){a[n].forEach(function(r){t=!0;var i=document.createElement("button");i.className="filter-chip",i.type="button",i.innerHTML=(g[n]||n)+": "+r+' <span class="chip-x">&times;</span>',i.addEventListener("click",function(){var e=a[n].indexOf(r);-1!==e&&a[n].splice(e,1);var t="filter-"+n,i=document.getElementById(t);i&&i.querySelectorAll(".catalog-filter-btn").forEach(function(e){e.getAttribute("data-value")===r&&e.classList.remove("active"),"All"===e.getAttribute("data-value")&&0===a[n].length&&e.classList.add("active")});h(),p()}),e.appendChild(i)})}),n){t=!0;var r=document.createElement("button");r.className="filter-chip",r.type="button",r.innerHTML='On Sale <span class="chip-x">&times;</span>',r.addEventListener("click",function(){n=!1;var e=document.querySelector("#filter-sale .catalog-filter-btn");e&&e.classList.remove("active"),h()}),e.appendChild(r)}if(t){var i=document.createElement("button");i.className="filter-chip filter-chip--clear",i.type="button",i.textContent="Clear all",i.addEventListener("click",function(){Object.keys(a).forEach(function(e){a[e]=[]}),n=!1,document.querySelectorAll(".catalog-filter-btn").forEach(function(e){"All"===e.getAttribute("data-value")?e.classList.add("active"):e.classList.remove("active")});var e=document.querySelector("#filter-sale .catalog-filter-btn");e&&e.classList.remove("active"),h(),p()}),e.appendChild(i)}e.classList.toggle("hidden",!t)}()}d&&showCatalogSkeletons(d,6),(r?function(){var e=function(){try{var e=localStorage.getItem(o),t=parseInt(localStorage.getItem(s),10)||0;if(e)return{data:JSON.parse(e),fresh:Date.now()-t<6e5}}catch(e){}return null}();if(e){var t=Promise.resolve(e.data);return e.fresh||l().then(c).catch(function(){}),t}return l().then(function(e){return c(e),e})}().catch(function(){return i()}):i()).then(function(a){a.forEach(function(t){t._item_type="kit","true"===(t.favorite||"").toLowerCase()&&(t._favRand=Math.random()),e.push(t)}),u("filter-type","type","Type:"),u("filter-brand","brand","Brand:"),u("filter-subcategory","subcategory","Style:"),u("filter-time","time","Production Time:"),u("filter-body","body","Body:"),u("filter-oak","oak","Oak:"),u("filter-sweetness","sweetness","Sweetness:"),function(){var t=e.some(function(e){return parseFloat(e.discount)>0}),a=document.getElementById("filter-sale");if(!a||!t)return void(a&&a.classList.add("hidden"));var r=document.createElement("span");r.className="catalog-filter-label",r.textContent="Sale:",a.appendChild(r);var i=document.createElement("button");i.className="catalog-filter-btn",i.type="button",i.textContent="On Sale",i.addEventListener("click",function(){n=!n,i.classList.toggle("active",n),h()}),a.appendChild(i)}(),h();var r=new URLSearchParams(window.location.search).get("sku");if(r){var i=0;setTimeout(function e(){var t=document.querySelector('[data-sku="'+r+'"]');t?(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight"),setTimeout(function(){t.classList.remove("highlight")},2e3)):i<10&&(i++,setTimeout(e,100))},50)}applyKitsFilters=h;var o,s=document.getElementById("catalog-search");s&&s.addEventListener("input",function(){clearTimeout(o),o=setTimeout(h,180)});var c=document.getElementById("catalog-sort");c&&c.addEventListener("change",function(){t=!0,h()});var l=document.getElementById("catalog-toggle"),d=document.getElementById("catalog-collapsible");l&&d&&l.addEventListener("click",function(){var e="true"===l.getAttribute("aria-expanded");l.setAttribute("aria-expanded",String(!e)),d.classList.toggle("open")})}).catch(function(){});var g={type:"Type",brand:"Brand",subcategory:"Style",time:"Time",body:"Body",oak:"Oak",sweetness:"Sweetness"};function E(e,a,n,r){if(0!==n.length){var i=document.createElement("div");i.className="catalog-section"+(r?" "+r:"");var o=document.createElement("div");o.className="catalog-section-header";var s=document.createElement("h2");if(s.className="catalog-section-title",s.textContent=a,o.appendChild(s),"catalog-section--order"===r){var c=document.createElement("p");c.className="process-note",c.textContent="Allow up to 2 weeks for items to be ordered in.",o.appendChild(c)}i.appendChild(o);var l={},d=[];n.forEach(function(e){l[e.type]||(l[e.type]=[],d.push(e.type)),l[e.type].push(e)}),d.sort(function(e,t){return l[t].length-l[e].length}),"table"===catalogViewMode?d.forEach(function(e){var a=document.createElement("div");a.className="product-group";var n=document.createElement("h3");n.className="product-group-title",n.textContent=e,a.appendChild(n);var r=document.createElement("table");r.className="catalog-table";var o=document.createElement("thead"),s=document.getElementById("catalog-sort"),c=s?s.value:"name-asc",d=l[e],u=[{label:"Name",sort:"name",field:"name"},{label:"Brand",sort:"brand",field:"brand"},{label:"Style",sort:"style",field:"subcategory"},{label:"Time",sort:"time",field:"time"},{label:"In-Store Price",sort:"price",field:"retail_instore"},{label:"Kit Price",sort:"price",field:"retail_kit"},{label:"",sort:"reserved",field:null}].filter(function(e){return!e.field||("name"===e.field||d.some(function(t){return""!==(t[e.field]||"").trim()}))}),m={};u.forEach(function(e){m[e.field||e.label]=!0});var p=document.createElement("tr");u.forEach(function(e){var a,n=document.createElement("th");if(n.textContent=e.label,e.sort){n.setAttribute("data-sort",e.sort);var r=document.createElement("span");r.className="sort-arrow",c.replace(/-asc$|-desc$/,"")===e.sort?(n.classList.add("sort-active"),r.textContent=-1!==c.indexOf("-desc")?"▼":"▲"):r.textContent="▲",n.appendChild(r),n.addEventListener("click",(a=e.sort,function(){var e=document.getElementById("catalog-sort");if(e){var n=e.value,r=n.replace(/-asc$|-desc$/,"");e.value=r===a?a+(-1!==n.indexOf("-asc")?"-desc":"-asc"):a+"-asc",t=!0,h()}}))}p.appendChild(n)}),o.appendChild(p),r.appendChild(o);var v=document.createElement("tbody");d.forEach(function(e){var t=document.createElement("tr"),a=getTintClass(e);a&&(t.className=a);var n=parseFloat(e.discount)||0,r="TRUE"===(e.pricing_from||"").trim().toUpperCase()?"+":"",i=document.createElement("td");i.setAttribute("data-label","Name");var o=document.createElement("span");if(o.className="table-name",o.textContent=e.name||"",i.appendChild(o),n>0){var s=document.createElement("span");s.className="discount-badge-sm",s.textContent=Math.round(n)+"% OFF",i.appendChild(s)}if(t.appendChild(i),m.brand){var c=document.createElement("td");c.setAttribute("data-label","Brand"),c.textContent=e.brand||"",t.appendChild(c)}if(m.subcategory){var l=document.createElement("td");l.setAttribute("data-label","Style"),l.textContent=e.subcategory||"",t.appendChild(l)}if(m.time){var d=document.createElement("td");d.setAttribute("data-label","Time"),d.textContent=e.time||"",t.appendChild(d)}if(m.retail_instore){var p=document.createElement("td");p.setAttribute("data-label","In-Store");var f=(e.retail_instore||"").trim();if(f)if(p.className="table-prices",n>0){var h=formatKitPrice((parseFloat(f.replace(/[^0-9.]/g,""))*(1-n/100)).toFixed(2));p.innerHTML='<span class="table-price-original">'+formatKitPrice(f)+'</span><span class="table-price-sale">$'+h+r+"</span>"}else p.textContent=formatKitPrice(f)+r;t.appendChild(p)}if(m.retail_kit){var g=document.createElement("td");g.setAttribute("data-label","Kit");var E=(e.retail_kit||"").trim();if(E)if(g.className="table-prices",n>0){var b=formatKitPrice((parseFloat(E.replace(/[^0-9.]/g,""))*(1-n/100)).toFixed(2));g.innerHTML='<span class="table-price-original">'+formatKitPrice(E)+'</span><span class="table-price-sale">$'+b+r+"</span>"}else g.textContent=formatKitPrice(E)+r;t.appendChild(g)}var C=document.createElement("td");C.setAttribute("data-label","");var y=e.name+"|"+e.brand;renderReserveControl(C,e,y),t.appendChild(C);var L=[];m.brand&&(e.brand||"").trim()&&L.push(e.brand.trim()),m.subcategory&&(e.subcategory||"").trim()&&L.push(e.subcategory.trim()),m.time&&(e.time||"").trim()&&L.push(e.time.trim());var S=document.createElement("td");S.className="table-mobile-meta",L.length&&(S.textContent=L.join(" · ")),t.appendChild(S);var k=[],x=(e.retail_instore||"").trim(),_=(e.retail_kit||"").trim();if(x){var N=parseFloat(x.replace(/[^0-9.]/g,""));if(n>0&&N){var w=formatKitPrice((N*(1-n/100)).toFixed(2));k.push('<span class="mp-label">In-store</span> <span class="table-price-original">'+formatKitPrice(x)+'</span> <span class="table-price-sale">$'+w+r+"</span>")}else k.push('<span class="mp-label">In-store</span> '+formatKitPrice(x)+r)}if(_){var I=parseFloat(_.replace(/[^0-9.]/g,""));if(n>0&&I){var F=formatKitPrice((I*(1-n/100)).toFixed(2));k.push('<span class="mp-label">Kit</span> <span class="table-price-original">'+formatKitPrice(_)+'</span> <span class="table-price-sale">$'+F+r+"</span>")}else k.push('<span class="mp-label">Kit</span> '+formatKitPrice(_)+r)}var T=document.createElement("td");T.className="table-mobile-prices",k.length&&(T.innerHTML=k.join(' <span class="mp-sep">·</span> ')),t.appendChild(T);var A=document.createElement("span");A.className="table-expand-chevron",A.innerHTML="&#9660;",i.insertBefore(A,i.firstChild);var M=document.createElement("tr");M.className="table-detail-row";var O=document.createElement("td");O.setAttribute("colspan",String(u.length)),O.className="table-detail-cell";var H=document.createElement("div");if(H.className="table-detail-content",e.sku){var R=document.createElement("div");R.className="table-detail-image";var B=document.createElement("img");B.src="images/products/"+e.sku+".png",B.alt=e.name||"Product image",B.loading="lazy",B.onerror=function(){this.parentElement.remove()},R.appendChild(B),H.appendChild(R)}var q=document.createElement("div");if(q.className="table-detail-text",e.tasting_notes){var P=document.createElement("p");P.className="table-detail-notes",P.textContent=e.tasting_notes,q.appendChild(P)}if(e.description&&!e.tasting_notes){var D=document.createElement("p");D.className="table-detail-notes",D.textContent=e.description,q.appendChild(D)}var V=(e.body||"").trim(),U=(e.oak||"").trim(),$=(e.sweetness||"").trim();if(V||U||$){var G=document.createElement("div");G.className="table-detail-traits";for(var K=[{label:"Body",value:V},{label:"Oak",value:U},{label:"Sweetness",value:$}],z=0;z<K.length;z++)if(K[z].value){var j=document.createElement("span");j.className="table-detail-trait",j.innerHTML="<strong>"+K[z].label+":</strong> "+escapeHTML(K[z].value),G.appendChild(j)}q.appendChild(G)}var W=[];e.abv&&W.push(e.abv+(-1===e.abv.toLowerCase().indexOf("abv")?" ABV":""));var Q,J,Y,Z=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(Z&&W.push(Z+"L batch"),W.length){var X=document.createElement("p");X.className="table-detail-meta",X.textContent=W.join(" · "),q.appendChild(X)}H.appendChild(q),O.appendChild(H),M.appendChild(O),H.children.length>0&&q.children.length>0?(v.appendChild(t),v.appendChild(M),J=M,Y=A,(Q=t).style.cursor="pointer",Q.addEventListener("click",function(t){if(!(t.target.closest(".qty-btn")||t.target.closest(".product-reserve-btn")||t.target.closest(".product-qty-controls"))){var a=J.classList.toggle("open");Y.classList.toggle("open",a),Q.classList.toggle("expanded",a),a&&trackEvent("detail",e.sku||"",e.name||"")}})):v.appendChild(t)}),r.appendChild(v),a.appendChild(r),i.appendChild(a)}):d.forEach(function(e){var t=document.createElement("div");t.className="product-group";var a=document.createElement("h3");a.className="product-group-title",a.textContent=e,t.appendChild(a);var n=document.createElement("div");n.className="product-grid",l[e].forEach(function(e){var t,a=(e.type||"").toLowerCase();t=-1!==a.indexOf("wine")?function(e){var t=getTintClass(e),a=document.createElement("div");a.className="label-wine"+(t?" "+t:""),e.sku&&a.setAttribute("data-sku",e.sku);var n=parseFloat(e.discount)||0;if(n>0){var r=document.createElement("span");r.className="discount-badge",r.textContent=Math.round(n)+"% OFF",a.appendChild(r)}var i=document.createElement("div");i.className="label-body";var o=document.createElement("div");o.className="brand",o.textContent=e.brand||"",i.appendChild(o);var s=document.createElement("div");s.className="ornament",i.appendChild(s);var c=document.createElement("div");if(c.className="wine-name",c.textContent=e.name||"",i.appendChild(c),e.subcategory){var l=document.createElement("div");l.className="subcategory",l.textContent=e.subcategory,i.appendChild(l)}var d=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(e.time||d){var u=document.createElement("div");u.className="time";var m=[];e.time&&m.push(e.time),d&&m.push(d+"L"),u.textContent=m.join(" · "),i.appendChild(u)}if(e.abv){var p=document.createElement("div");p.className="abv",p.textContent=e.abv+(-1===e.abv.toLowerCase().indexOf("abv")?" ABV":""),i.appendChild(p)}(e.tasting_notes||e.sku||e.body||e.oak||e.sweetness)&&i.appendChild(buildLabelNotesToggle(e));var v=document.createElement("div");v.className="notes-spacer",i.appendChild(v),a.appendChild(i);var f=(e.retail_instore||"").trim(),h=(e.retail_kit||"").trim();(f||h)&&a.appendChild(buildLabelPriceFooter(e));var g=document.createElement("div");return g.className="reserve-link",renderReserveControl(g,e,e.name+"|"+e.brand),a.appendChild(g),a}(e):-1!==a.indexOf("beer")?function(e){var t=getTintClass(e),a=document.createElement("div");a.className="label-beer"+(t?" "+t:""),e.sku&&a.setAttribute("data-sku",e.sku);var n=parseFloat(e.discount)||0;if(n>0){var r=document.createElement("span");r.className="discount-badge",r.textContent=Math.round(n)+"% OFF",a.appendChild(r)}var i=document.createElement("div");i.className="label-body";var o=document.createElement("div");o.className="sv-logo",o.innerHTML=SV_LOGO_SVG,i.appendChild(o);var s=document.createElement("div");s.className="brand",s.textContent=e.brand||"",i.appendChild(s);var c=document.createElement("div");c.className="gold-rule",i.appendChild(c);var l=document.createElement("div");if(l.className="beer-name",l.textContent=e.name||"",i.appendChild(l),e.subcategory){var d=document.createElement("div");d.className="subcategory",d.textContent=e.subcategory,i.appendChild(d)}var u=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(e.time||u){var m=document.createElement("div");m.className="time";var p=[];e.time&&p.push(e.time),u&&p.push(u+"L"),m.textContent=p.join(" · "),i.appendChild(m)}if(e.abv){var v=document.createElement("div");v.className="abv",v.textContent=e.abv+(-1===e.abv.toLowerCase().indexOf("abv")?" ABV":""),i.appendChild(v)}(e.tasting_notes||e.sku)&&i.appendChild(buildLabelNotesToggle(e));var f=document.createElement("div");f.className="notes-spacer",i.appendChild(f),a.appendChild(i);var h=(e.retail_instore||"").trim(),g=(e.retail_kit||"").trim();(h||g)&&a.appendChild(buildLabelPriceFooter(e));var E=document.createElement("div");return E.className="reserve-link",renderReserveControl(E,e,e.name+"|"+e.brand),a.appendChild(E),a}(e):function(e){var t=document.createElement("div");t.className="product-card",e.sku&&t.setAttribute("data-sku",e.sku);var a=document.createElement("div");a.className="product-card-header";var n=document.createElement("p");n.className="product-brand",n.textContent=e.brand,a.appendChild(n);var r=document.createElement("h4");r.textContent=e.name,a.appendChild(r),t.appendChild(a);var i,o,s,c=(e["batch_size_(l)"]||e.batch_size_liters||"").trim();if(e.subcategory||e.time||c){var l=document.createElement("div");l.className="product-detail-row";var d=[];e.subcategory&&d.push(e.subcategory),e.time&&d.push(e.time),c&&d.push(c+"L");for(var u=0;u<d.length;u++){if(u>0){var m=document.createElement("span");m.className="detail-sep",m.textContent="·",l.appendChild(m)}var p=document.createElement("span");p.textContent=d[u],l.appendChild(p)}t.appendChild(l)}if(e.tasting_notes){var v=document.createElement("div");v.className="product-notes";var f=document.createElement("button");f.type="button",f.className="product-notes-toggle",f.setAttribute("aria-expanded","false"),f.innerHTML='More Information <span class="product-notes-chevron">&#9660;</span>';var h=document.createElement("div");if(h.className="product-notes-body",e.sku){var g=document.createElement("div");g.className="product-notes-image";var E=document.createElement("img");E.src="images/products/"+e.sku+".png",E.alt=e.name||"Product image",E.loading="lazy",E.onerror=function(){this.parentElement.remove()},g.appendChild(E),h.appendChild(g)}var b=document.createElement("div");b.className="product-notes-text";var C=document.createElement("p");C.textContent=e.tasting_notes,b.appendChild(C),h.appendChild(b),f.addEventListener("click",(i=v,o=f,s=e,function(){var e=i.classList.toggle("open");o.setAttribute("aria-expanded",e?"true":"false"),e&&trackEvent("detail",s.sku||"",s.name||"")})),v.appendChild(f),v.appendChild(h),t.appendChild(v)}var y=parseFloat(e.discount)||0;if(y>0){var L=document.createElement("span");L.className="product-discount-badge",L.textContent=Math.round(y)+"% OFF",t.appendChild(L)}var S="TRUE"===(e.pricing_from||"").trim().toUpperCase()?"+":"",k=(e.retail_instore||"").trim(),x=(e.retail_kit||"").trim();if(k||x){var _=document.createElement("div");if(_.className="product-prices",k){var N=document.createElement("div");if(N.className="product-price-box",y>0){var w=formatKitPrice((parseFloat(k.replace(/[^0-9.]/g,""))*(1-y/100)).toFixed(2));N.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-original">'+formatKitPrice(k)+'</span><span class="product-price-value">$'+w+S+"</span>"}else N.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-value">'+formatKitPrice(k)+S+"</span>";_.appendChild(N)}if(x){var I=document.createElement("div");if(I.className="product-price-box",y>0){var F=formatKitPrice((parseFloat(x.replace(/[^0-9.]/g,""))*(1-y/100)).toFixed(2));I.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-original">'+formatKitPrice(x)+'</span><span class="product-price-value">$'+F+S+"</span>"}else I.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-value">'+formatKitPrice(x)+S+"</span>";_.appendChild(I)}t.appendChild(_)}var T=document.createElement("div");return T.className="product-reserve-wrap",renderReserveControl(T,e,e.name+"|"+e.brand),t.appendChild(T),t}(e),n.appendChild(t)}),t.appendChild(n),i.appendChild(t)}),e.appendChild(i)}}}function initProductTabs(){var e=document.getElementById("product-tabs");if(e){var t=!1,a=!1;e.addEventListener("click",function(n){var r=n.target.closest(".product-tab-btn");if(r){var i=r.getAttribute("data-product-tab");e.querySelectorAll(".product-tab-btn").forEach(function(e){e.classList.remove("active")}),r.classList.add("active");["catalog-controls-kits","catalog-controls-ingredients","catalog-controls-services"].forEach(function(e){var t=document.getElementById(e);t&&t.classList.add("hidden")});var o=document.getElementById("catalog-controls-"+i);o&&o.classList.remove("hidden"),syncToggleButtons(catalogViewMode=getCatalogViewMode(i));var s=document.getElementById("kits-batch-note");s&&s.classList.toggle("hidden","kits"!==i);var c=document.getElementById("kits-process-note");c&&c.classList.toggle("hidden","kits"!==i),updateReservationBar();var l=document.getElementById("product-catalog");if(l)l.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid").forEach(function(e){e.parentNode.removeChild(e)});"kits"===i?applyKitsFilters&&applyKitsFilters():"ingredients"===i?t?renderIngredients():(t=!0,loadIngredients(function(){})):"services"===i&&(a?renderServices():(a=!0,loadServices(function(){})))}});var n=document.getElementById("ingredient-toggle"),r=document.getElementById("ingredient-collapsible");n&&r&&n.addEventListener("click",function(){var e="true"===n.getAttribute("aria-expanded");n.setAttribute("aria-expanded",String(!e)),r.classList.toggle("open")})}}window.addEventListener("resize",function(){clearTimeout(_eqResizeTimer),_eqResizeTimer=setTimeout(equalizeCardHeights,150)});var _allIngredients=[],_ingredientFilters={unit:[]};function loadIngredients(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.MIDDLEWARE_URL?SHEETS_CONFIG.MIDDLEWARE_URL:"";function a(){var e="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_INGREDIENTS_CSV_URL?SHEETS_CONFIG.PUBLISHED_INGREDIENTS_CSV_URL:null,t="sv-ingredients-csv",a="sv-ingredients-csv-ts";function n(e){try{localStorage.setItem(t,e),localStorage.setItem(a,String(Date.now()))}catch(e){}}var r,i=function(){try{var e=localStorage.getItem(t),n=parseInt(localStorage.getItem(a),10)||0;if(e)return{csv:e,fresh:Date.now()-n<36e5}}catch(e){}return null}();i?(r=Promise.resolve(i.csv),i.fresh||fetchCSV(e||"content/ingredients.csv").then(n).catch(function(){})):(r=e?fetchCSV(e).catch(function(){return fetchCSV("content/ingredients.csv")}):fetchCSV("content/ingredients.csv")).then(n);return r.then(function(e){for(var t=e.trim().split("\n"),a=t[0].split(","),n=[],r=1;r<t.length;r++){var i=parseCSVLine(t[r]);if(!(i.length<a.length)){for(var o={},s=0;s<a.length;s++)o[a[s].trim()]=i[s].trim();(o.name||o.sku)&&(o.hide&&"true"===o.hide.toLowerCase()||n.push(o))}}return n})}var n="sv-ingredients-mw",r="sv-ingredients-mw-ts";function i(e){try{localStorage.setItem(n,JSON.stringify(e)),localStorage.setItem(r,String(Date.now()))}catch(e){}}function o(){return fetch(t+"/api/ingredients").then(function(e){if(!e.ok)throw new Error("Middleware returned "+e.status);return e.json()}).then(function(e){return(e.items||[]).map(function(e){var t={name:e.name||"",unit:e.unit||"",price_per_unit:null!=e.rate?String(e.rate):"",stock:null!=e.stock_on_hand?String(e.stock_on_hand):"0",description:e.description||"",sku:e.sku||"",low_amount:"",high_amount:"",step:""};return e.custom_fields&&e.custom_fields.length&&e.custom_fields.forEach(function(e){var a=(e.label||"").toLowerCase().replace(/\s+/g,"_");a&&void 0!==e.value&&null!==e.value&&(t[a]=String(e.value))}),t})})}(t?function(){var e=function(){try{var e=localStorage.getItem(n),t=parseInt(localStorage.getItem(r),10)||0;if(e)return{data:JSON.parse(e),fresh:Date.now()-t<6e5}}catch(e){}return null}();if(e){var t=Promise.resolve(e.data);return e.fresh||o().then(i).catch(function(){}),t}return o().then(function(e){return i(e),e})}().catch(function(){return a()}):a()).then(function(t){_allIngredients=t,buildIngredientFilters(),renderIngredients(),wireIngredientEvents(),e&&e()}).catch(function(){})}function buildIngredientFilters(){var e=document.getElementById("filter-unit");if(e&&!(e.children.length>0)){var t=document.createElement("span");t.className="catalog-filter-label",t.textContent="Unit:",e.appendChild(t);var a=[];_allIngredients.forEach(function(e){var t=(e.unit||"").trim();t&&-1===a.indexOf(t)&&a.push(t)}),a.sort();var n=document.createElement("button");n.className="catalog-filter-btn active",n.type="button",n.textContent="All",n.setAttribute("data-value","All"),n.addEventListener("click",function(){_ingredientFilters.unit=[],e.querySelectorAll(".catalog-filter-btn").forEach(function(e){e.classList.remove("active")}),n.classList.add("active"),renderIngredients()}),e.appendChild(n),a.forEach(function(t){var a=document.createElement("button");a.className="catalog-filter-btn",a.type="button",a.textContent=t,a.setAttribute("data-value",t),a.addEventListener("click",function(){var a=_ingredientFilters.unit.indexOf(t);-1!==a?_ingredientFilters.unit.splice(a,1):_ingredientFilters.unit.push(t);var n=e.querySelectorAll(".catalog-filter-btn");n.forEach(function(e){e.classList.remove("active")}),0===_ingredientFilters.unit.length?e.querySelector('[data-value="All"]').classList.add("active"):n.forEach(function(e){-1!==_ingredientFilters.unit.indexOf(e.getAttribute("data-value"))&&e.classList.add("active")}),renderIngredients()}),e.appendChild(a)})}}function wireIngredientEvents(){var e,t=document.getElementById("ingredient-search");t&&t.addEventListener("input",function(){clearTimeout(e),e=setTimeout(renderIngredients,180)});var a=document.getElementById("ingredient-sort");a&&a.addEventListener("change",function(){renderIngredients()})}function renderIngredients(){var e=document.getElementById("product-catalog");if(e){e.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid").forEach(function(e){e.parentNode.removeChild(e)});var t=document.getElementById("ingredient-search"),a=t?t.value.toLowerCase():"",n=_allIngredients.filter(function(e){if(_ingredientFilters.unit.length>0&&-1===_ingredientFilters.unit.indexOf(e.unit))return!1;if(!a)return!0;var t=(e.name||"").toLowerCase(),n=(e.description||"").toLowerCase();return-1!==t.indexOf(a)||-1!==n.indexOf(a)}),r=document.getElementById("ingredient-sort"),i=r?r.value:"name-asc";if(n.sort(function(e,t){switch(i){case"name-asc":return(e.name||"").localeCompare(t.name||"");case"name-desc":return(t.name||"").localeCompare(e.name||"");case"price-asc":return(parseFloat(e.price_per_unit)||0)-(parseFloat(t.price_per_unit)||0);case"price-desc":return(parseFloat(t.price_per_unit)||0)-(parseFloat(e.price_per_unit)||0);default:return 0}}),0===n.length){var o=document.createElement("p");return o.className="catalog-no-results",o.textContent="No ingredients or supplies found.",void e.appendChild(o)}renderIngredientSection(e,"In stock",n.filter(function(e){return(parseInt(e.stock,10)||0)>0})),equalizeCardHeights()}}function renderIngredientSection(e,t,a,n){if(0!==a.length){var r=document.createElement("div");r.className="catalog-section"+(n?" "+n:"");var i=document.createElement("div");i.className="catalog-section-header";var o=document.createElement("h2");if(o.className="catalog-section-title",o.textContent=t,i.appendChild(o),r.appendChild(i),"table"===catalogViewMode){var s=document.createElement("table");s.className="catalog-table";var c=document.createElement("thead"),l=document.getElementById("ingredient-sort"),d=l?l.value:"name-asc",u=document.createElement("tr");[{label:"Name",sort:"name"},{label:"Unit",sort:null},{label:"Price",sort:"price"},{label:"",sort:null}].forEach(function(e){var t,a=document.createElement("th");if(a.textContent=e.label,e.sort){a.setAttribute("data-sort",e.sort);var n=document.createElement("span");n.className="sort-arrow",d.replace(/-asc$|-desc$/,"")===e.sort?(a.classList.add("sort-active"),n.textContent=-1!==d.indexOf("-desc")?"▼":"▲"):n.textContent="▲",a.appendChild(n),a.addEventListener("click",(t=e.sort,function(){var e=document.getElementById("ingredient-sort");if(e){var a=e.value,n=a.replace(/-asc$|-desc$/,"");e.value=n===t?t+(-1!==a.indexOf("-asc")?"-desc":"-asc"):t+"-asc",renderIngredients()}}))}u.appendChild(a)}),c.appendChild(u),s.appendChild(c);var m=document.createElement("tbody");a.forEach(function(e){var t=document.createElement("tr"),a=document.createElement("td");a.setAttribute("data-label","Name"),a.className="table-name",a.textContent=e.name||"",t.appendChild(a);var n=document.createElement("td");n.setAttribute("data-label","Unit"),n.textContent=(e.unit||"").trim(),t.appendChild(n);var r=document.createElement("td");r.setAttribute("data-label","Price");var i=(e.price_per_unit||"").trim();i&&(r.textContent="$"===i.charAt(0)?i:"$"+i),t.appendChild(r);var o,s,c,l=document.createElement("td");if(l.setAttribute("data-label",""),(parseInt(e.stock,10)||0)>0){var d={name:e.name,brand:"",retail_instore:"",retail_kit:"",price_per_unit:e.price_per_unit||"",price:e.price_per_unit||"",discount:"",stock:e.stock,time:"",sku:e.sku||"",unit:e.unit||"",low_amount:e.low_amount||"",high_amount:e.high_amount||"",step:e.step||"",_item_type:"ingredient"},u=document.createElement("div");u.className="product-reserve-wrap";var p=e.name+"|";hasWeightConfig(e)?renderWeightControlCompact(u,d,p):renderReserveControl(u,d,p),l.appendChild(u)}if(t.appendChild(l),(e.description||"").trim()||e.sku){var v=document.createElement("span");v.className="table-expand-chevron",v.innerHTML="&#9660;",a.insertBefore(v,a.firstChild);var f=document.createElement("tr");f.className="table-detail-row";var h=document.createElement("td");h.setAttribute("colspan","4"),h.className="table-detail-cell";var g=document.createElement("div");if(g.className="table-detail-content",e.sku){var E=document.createElement("div");E.className="table-detail-image";var b=document.createElement("img");b.src="images/products/"+e.sku+".png",b.alt=e.name||"",b.loading="lazy",b.onerror=function(){this.parentElement.remove()},E.appendChild(b),g.appendChild(E)}if(e.description){var C=document.createElement("div");C.className="table-detail-text";var y=document.createElement("p");y.textContent=e.description,C.appendChild(y),g.appendChild(C)}h.appendChild(g),f.appendChild(h),m.appendChild(t),m.appendChild(f),s=f,c=v,(o=t).style.cursor="pointer",o.addEventListener("click",function(e){if(!(e.target.closest(".qty-btn")||e.target.closest(".product-reserve-btn")||e.target.closest(".product-qty-controls"))){var t=s.classList.toggle("open");c.classList.toggle("open",t),o.classList.toggle("expanded",t)}})}else m.appendChild(t)}),s.appendChild(m),r.appendChild(s)}else{var p=document.createElement("div");p.className="product-grid",a.forEach(function(e){var t=document.createElement("div");t.className="product-card";var a=document.createElement("div");a.className="product-card-header";var n=document.createElement("h4");n.textContent=e.name,a.appendChild(n),t.appendChild(a);var r,i,o=(e.unit||"").trim(),s=(e.price_per_unit||"").trim();if(o||s){var c=document.createElement("div");c.className="product-detail-row";var l=[];o&&l.push(o),s&&l.push("$"===s.charAt(0)?s:"$"+s);for(var d=0;d<l.length;d++){if(d>0){var u=document.createElement("span");u.className="detail-sep",u.textContent="·",c.appendChild(u)}var m=document.createElement("span");m.textContent=l[d],c.appendChild(m)}t.appendChild(c)}if(e.description){var v=document.createElement("div");v.className="product-notes";var f=document.createElement("button");f.type="button",f.className="product-notes-toggle",f.setAttribute("aria-expanded","false"),f.innerHTML='More Information <span class="product-notes-chevron">&#9660;</span>';var h=document.createElement("div");h.className="product-notes-body";var g=document.createElement("p");g.textContent=e.description,h.appendChild(g),f.addEventListener("click",(r=v,i=f,function(){var e=r.classList.toggle("open");i.setAttribute("aria-expanded",e?"true":"false")})),v.appendChild(f),v.appendChild(h),t.appendChild(v)}var E=parseInt(e.stock,10)||0,b=document.createElement("span");if(b.className="stock-badge",E>0?(b.classList.add("stock-badge--in"),b.textContent="In Stock"):(b.classList.add("stock-badge--out"),b.textContent="Out of Stock"),t.appendChild(b),E>0){var C={name:e.name,brand:"",retail_instore:"",retail_kit:"",price_per_unit:e.price_per_unit||"",price:e.price_per_unit||"",discount:"",stock:e.stock,time:"",sku:e.sku||"",unit:e.unit||"",low_amount:e.low_amount||"",high_amount:e.high_amount||"",step:e.step||"",_item_type:"ingredient"},y=document.createElement("div");y.className="product-reserve-wrap";var L=e.name+"|";hasWeightConfig(e)?renderWeightControl(y,C,L):renderReserveControl(y,C,L),t.appendChild(y)}p.appendChild(t)}),r.appendChild(p)}e.appendChild(r)}}var _allServices=[],_servicesSortVal="name-asc";function loadServices(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.MIDDLEWARE_URL?SHEETS_CONFIG.MIDDLEWARE_URL:"";function a(){var e="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SERVICES_CSV_URL?SHEETS_CONFIG.PUBLISHED_SERVICES_CSV_URL:null,t="sv-services-csv",a="sv-services-csv-ts";function n(e){try{localStorage.setItem(t,e),localStorage.setItem(a,String(Date.now()))}catch(e){}}var r,i=function(){try{var e=localStorage.getItem(t),n=parseInt(localStorage.getItem(a),10)||0;if(e)return{csv:e,fresh:Date.now()-n<36e5}}catch(e){}return null}();i?(r=Promise.resolve(i.csv),i.fresh||fetchCSV(e||"content/services.csv").then(n).catch(function(){})):(r=e?fetchCSV(e).catch(function(){return fetchCSV("content/services.csv")}):fetchCSV("content/services.csv")).then(n);return r.then(function(e){for(var t=e.trim().split("\n"),a=t[0].split(","),n=[],r=1;r<t.length;r++){var i=parseCSVLine(t[r]);if(!(i.length<a.length)){for(var o={},s=0;s<a.length;s++)o[a[s].trim()]=i[s].trim();(o.name||o.sku)&&(o.hide&&"true"===o.hide.toLowerCase()||n.push(o))}}return n})}var n="sv-services-mw",r="sv-services-mw-ts";function i(e){try{localStorage.setItem(n,JSON.stringify(e)),localStorage.setItem(r,String(Date.now()))}catch(e){}}function o(){return fetch(t+"/api/services").then(function(e){if(!e.ok)throw new Error("Middleware returned "+e.status);return e.json()}).then(function(e){return(e.items||[]).map(function(e){return{name:e.name||"",price:null!=e.rate?String(e.rate):"",description:e.description||"",sku:e.sku||"",stock:null!=e.stock_on_hand?String(e.stock_on_hand):"0",discount:null!=e.discount?String(e.discount):"0"}})})}(t?function(){var e=function(){try{var e=localStorage.getItem(n),t=parseInt(localStorage.getItem(r),10)||0;if(e)return{data:JSON.parse(e),fresh:Date.now()-t<6e5}}catch(e){}return null}();if(e){var t=Promise.resolve(e.data);return e.fresh||o().then(i).catch(function(){}),t}return o().then(function(e){return i(e),e})}().catch(function(){return a()}):a()).then(function(t){_allServices=t,renderServices(),wireServiceEvents(),e&&e()}).catch(function(){})}function wireServiceEvents(){var e,t=document.getElementById("service-search");t&&t.addEventListener("input",function(){clearTimeout(e),e=setTimeout(renderServices,180)})}function renderServices(){var e=document.getElementById("product-catalog");if(e){e.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid").forEach(function(e){e.parentNode.removeChild(e)});var t=document.getElementById("service-search"),a=t?t.value.toLowerCase():"",n=_allServices.filter(function(e){if(!a)return!0;var t=(e.name||"").toLowerCase(),n=(e.desription||e.description||"").toLowerCase();return-1!==t.indexOf(a)||-1!==n.indexOf(a)});if(n.sort(function(e,t){switch(_servicesSortVal){case"name-asc":return(e.name||"").localeCompare(t.name||"");case"name-desc":return(t.name||"").localeCompare(e.name||"");case"price-asc":return(parseFloat((e.price||"").replace(/[^0-9.]/g,""))||0)-(parseFloat((t.price||"").replace(/[^0-9.]/g,""))||0);case"price-desc":return(parseFloat((t.price||"").replace(/[^0-9.]/g,""))||0)-(parseFloat((e.price||"").replace(/[^0-9.]/g,""))||0);default:return 0}}),0===n.length){var r=document.createElement("p");return r.className="catalog-no-results",r.textContent="No services found.",void e.appendChild(r)}var i=document.createElement("div");i.className="catalog-section";var o=document.createElement("div");o.className="catalog-section-header";var s=document.createElement("h2");if(s.className="catalog-section-title",s.textContent="Our Services",o.appendChild(s),i.appendChild(o),"table"===catalogViewMode){var c=document.createElement("table");c.className="catalog-table";var l=document.createElement("thead"),d=document.createElement("tr");[{label:"Name",sort:"name"},{label:"Description",sort:null},{label:"Price",sort:"price"},{label:"",sort:null}].forEach(function(e){var t,a=document.createElement("th");if(a.textContent=e.label,e.sort){a.setAttribute("data-sort",e.sort);var n=document.createElement("span");n.className="sort-arrow",_servicesSortVal.replace(/-asc$|-desc$/,"")===e.sort?(a.classList.add("sort-active"),n.textContent=-1!==_servicesSortVal.indexOf("-desc")?"▼":"▲"):n.textContent="▲",a.appendChild(n),a.addEventListener("click",(t=e.sort,function(){var e=_servicesSortVal.replace(/-asc$|-desc$/,"");_servicesSortVal=e===t?t+(-1!==_servicesSortVal.indexOf("-asc")?"-desc":"-asc"):t+"-asc",renderServices()}))}d.appendChild(a)}),l.appendChild(d),c.appendChild(l);var u=document.createElement("tbody");n.forEach(function(e){var t=document.createElement("tr"),a=document.createElement("td");a.setAttribute("data-label","Name"),a.className="table-name",a.textContent=e.name||"";var n=parseFloat(e.discount)||0;if(n>0){var r=document.createElement("span");r.className="discount-badge-sm",r.textContent=Math.round(n)+"% OFF",a.appendChild(r)}t.appendChild(a);var i=document.createElement("td");i.setAttribute("data-label","Description"),i.textContent=(e.desription||e.description||"").trim(),t.appendChild(i);var o=document.createElement("td");o.setAttribute("data-label","Price");var s=(e.price||"").trim();if(s){o.className="table-prices";var c="$"===s.charAt(0)?s:"$"+s;if(n>0){var l=(parseFloat(s.replace(/[^0-9.]/g,""))*(1-n/100)).toFixed(2);o.innerHTML='<span class="table-price-original">'+c+'</span><span class="table-price-sale">$'+l+"</span>"}else o.textContent=c}t.appendChild(o);var d=document.createElement("td");if(d.setAttribute("data-label",""),(parseInt(e.stock,10)||0)>0||(e.price||"").trim()){var m={name:e.name,brand:"",retail_instore:"",retail_kit:"",price_per_unit:"",price:e.price||"",discount:e.discount||"",stock:e.stock||"999",time:"",sku:e.sku||"",_item_type:"service"},p=document.createElement("div");p.className="product-reserve-wrap",renderReserveControl(p,m,e.name+"|"),d.appendChild(p)}t.appendChild(d);var v,f,h,g=(e.desription||e.description||"").trim();if(g||e.sku){var E=document.createElement("span");E.className="table-expand-chevron",E.innerHTML="&#9660;",a.insertBefore(E,a.firstChild);var b=document.createElement("tr");b.className="table-detail-row";var C=document.createElement("td");C.setAttribute("colspan","4"),C.className="table-detail-cell";var y=document.createElement("div");if(y.className="table-detail-content",e.sku){var L=document.createElement("div");L.className="table-detail-image";var S=document.createElement("img");S.src="images/products/"+e.sku+".png",S.alt=e.name||"",S.loading="lazy",S.onerror=function(){this.parentElement.remove()},L.appendChild(S),y.appendChild(L)}if(g){var k=document.createElement("div");k.className="table-detail-text";var x=document.createElement("p");x.textContent=g,k.appendChild(x),y.appendChild(k)}C.appendChild(y),b.appendChild(C),u.appendChild(t),u.appendChild(b),f=b,h=E,(v=t).style.cursor="pointer",v.addEventListener("click",function(e){if(!(e.target.closest(".qty-btn")||e.target.closest(".product-reserve-btn")||e.target.closest(".product-qty-controls"))){var t=f.classList.toggle("open");h.classList.toggle("open",t),v.classList.toggle("expanded",t)}})}else u.appendChild(t)}),c.appendChild(u),i.appendChild(c)}else{var m=document.createElement("div");m.className="product-grid",n.forEach(function(e){var t=document.createElement("div");t.className="product-card";var a=document.createElement("div");a.className="product-card-header";var n=document.createElement("h4");n.textContent=e.name,a.appendChild(n),t.appendChild(a);var r=(e.desription||e.description||"").trim();if(r){var i=document.createElement("p");i.className="service-description",i.textContent=r,t.appendChild(i)}var o=(e.price||"").trim(),s=parseFloat(e.discount)||0;if(s>0){var c=document.createElement("span");c.className="product-discount-badge",c.textContent=Math.round(s)+"% OFF",t.appendChild(c)}if(o){var l=document.createElement("div");l.className="product-prices service-price";var d=document.createElement("div");if(d.className="product-price-box",s>0){var u=(parseFloat(o.replace(/[^0-9.]/g,""))*(1-s/100)).toFixed(2);d.innerHTML='<span class="product-price-label">Price</span><span class="product-price-original">'+("$"===o.charAt(0)?o:"$"+o)+'</span><span class="product-price-value">$'+u+"</span>"}else d.innerHTML='<span class="product-price-label">Price</span><span class="product-price-value">'+("$"===o.charAt(0)?o:"$"+o)+"</span>";l.appendChild(d),t.appendChild(l)}if((parseInt(e.stock,10)||0)>0||(e.price||"").trim()){var p={name:e.name,brand:"",retail_instore:"",retail_kit:"",price_per_unit:"",price:e.price||"",discount:e.discount||"",stock:e.stock||"999",time:"",sku:e.sku||"",_item_type:"service"},v=document.createElement("div");v.className="product-reserve-wrap",renderReserveControl(v,p,e.name+"|"),t.appendChild(v)}m.appendChild(t)}),i.appendChild(m)}e.appendChild(i),equalizeCardHeights()}}function parseCSVLine(e){for(var t=[],a="",n=!1,r=0;r<e.length;r++){var i=e[r];n?'"'===i?r+1<e.length&&'"'===e[r+1]?(a+='"',r++):n=!1:a+=i:'"'===i?n=!0:","===i?(t.push(a),a=""):a+=i}return t.push(a),t}var RESERVATION_KEY="sv-reservation";function getReservation(){try{return JSON.parse(localStorage.getItem(RESERVATION_KEY))||[]}catch(e){return[]}}function saveReservation(e){localStorage.setItem(RESERVATION_KEY,JSON.stringify(e))}function getReservedQty(e){for(var t=getReservation(),a=0;a<t.length;a++)if(t[a].name+"|"+t[a].brand===e)return t[a].qty||1;return 0}function isReserved(e){return getReservedQty(e)>0}function setReservationQty(e,t){for(var a=getReservation(),n=e.name+"|"+e.brand,r=-1,i=0;i<a.length;i++)if(a[i].name+"|"+a[i].brand===n){r=i;break}if(t<=0)-1!==r&&a.splice(r,1);else if(-1!==r)a[r].qty=t;else{var o=void 0!==e.available&&""!==e.available?parseInt(e.available,10)||0:parseInt(e.stock,10)||0;a.push({name:e.name,brand:e.brand||"",price:e.retail_instore||e.retail_kit||e.price_per_unit||e.price||"",discount:e.discount||"",stock:o,time:e.time||"",qty:t,item_type:e._item_type||"kit",sku:e.sku||"",unit:e.unit||"",tax_percentage:parseFloat(e.tax_percentage)||0})}saveReservation(a),updateReservationBar()}function renderReserveControl(e,t,a){e.innerHTML="";var n=getReservedQty(a);if(0===n){var r=document.createElement("button");r.type="button",r.className="product-reserve-btn",r.textContent="Add to Cart",r.addEventListener("click",function(){setReservationQty(t,1),trackEvent("add_to_cart",t.sku||"",t.name||""),renderReserveControl(e,t,a)}),e.appendChild(r)}else{var i=document.createElement("div");i.className="product-qty-controls";var o=document.createElement("button");o.type="button",o.className="qty-btn",o.textContent="−",o.addEventListener("click",function(){setReservationQty(t,n-1),renderReserveControl(e,t,a)});var s=document.createElement("span");s.className="qty-value",s.textContent=n;var c=document.createElement("button");c.type="button",c.className="qty-btn",c.textContent="+",c.addEventListener("click",function(){setReservationQty(t,n+1),renderReserveControl(e,t,a)}),i.appendChild(o),i.appendChild(s),i.appendChild(c),e.appendChild(i)}}function isWeightUnit(e){var t=(e||"").toLowerCase().trim();return"kg"===t||"g"===t||-1!==t.indexOf("kg")||-1!==t.indexOf(" g")||"gram"===t||"grams"===t}function hasWeightConfig(e){return isWeightUnit(e.unit)}function renderWeightControl(e,t,a){e.innerHTML="";var n=(t.unit||"").trim(),r=n.toLowerCase(),i="kg"===r||-1!==r.indexOf("kg"),o=parseFloat(t.low_amount)||(i?.1:50),s=parseFloat(t.high_amount)||(i?5:5e3),c=parseFloat(t.step)||(i?.1:50),l=i?1:0,d=parseFloat((t.price_per_unit||"0").replace(/[^0-9.]/g,""))||0,u=getReservedQty(a),m=u>0?u:o,p=document.createElement("div");p.className="weight-control";var v=document.createElement("div");v.className="weight-control-amount-badge",v.textContent=parseFloat(m).toFixed(l)+" "+n,p.appendChild(v);var f=document.createElement("div");f.className="weight-control-slider-row";var h=document.createElement("button");h.type="button",h.className="weight-control-step-btn",h.textContent="−",h.setAttribute("aria-label","Decrease amount");var g=document.createElement("input");g.type="range",g.className="weight-control-range",g.min=String(o),g.max=String(s),g.step=String(c),g.value=String(m),g.setAttribute("aria-label","Select amount in "+n);var E=document.createElement("button");E.type="button",E.className="weight-control-step-btn",E.textContent="+",E.setAttribute("aria-label","Increase amount"),f.appendChild(h),f.appendChild(g),f.appendChild(E),p.appendChild(f);var b=document.createElement("div");b.className="weight-control-range-labels";var C=document.createElement("span");C.textContent=parseFloat(o).toFixed(l)+" "+n;var y=document.createElement("span");y.textContent=parseFloat(s).toFixed(l)+" "+n,b.appendChild(C),b.appendChild(y),p.appendChild(b);var L=document.createElement("div");L.className="weight-control-input-row";var S=document.createElement("span");S.className="weight-control-input-label",S.textContent="Exact:";var k=document.createElement("input");k.type="number",k.className="weight-control-input",k.min=String(o),k.max=String(s),k.step=String(c),k.value=parseFloat(m).toFixed(l),k.setAttribute("aria-label","Type exact amount in "+n);var x=document.createElement("span");x.className="weight-control-unit-label",x.textContent=n,L.appendChild(S),L.appendChild(k),L.appendChild(x),p.appendChild(L);var _=document.createElement("div");_.className="weight-control-price",p.appendChild(_);var N=document.createElement("button");function w(e){var t=Math.round(e/c)*c;return t<o&&(t=o),t>s&&(t=s),parseFloat(t.toFixed(l+2))}function I(){var e,t=w(parseFloat(g.value)||o),a=t*d;v.textContent=parseFloat(t).toFixed(l)+" "+n,_.textContent=parseFloat(t).toFixed(l)+" "+n+" × $"+d.toFixed(2)+"/"+n+" = $"+a.toFixed(2),u>0?(N.textContent="Update Cart — $"+a.toFixed(2),N.className="weight-control-add weight-control-add--update"):(N.textContent="Add to Cart — $"+a.toFixed(2),N.className="weight-control-add"),g.style.setProperty("--fill",(e=t,(s===o?0:(e-o)/(s-o)*100)+"%"))}N.type="button",N.className="weight-control-add",p.appendChild(N),I(),g.addEventListener("input",function(){k.value=parseFloat(w(parseFloat(g.value))).toFixed(l),I()}),k.addEventListener("input",function(){var e=parseFloat(k.value);isNaN(e)||(e<o&&(e=o),e>s&&(e=s),g.value=String(e),I())}),k.addEventListener("blur",function(){var e=w(parseFloat(k.value)||o);k.value=parseFloat(e).toFixed(l),g.value=String(e),I()}),h.addEventListener("click",function(){var e=w((parseFloat(g.value)||o)-c);g.value=String(e),k.value=parseFloat(e).toFixed(l),I()}),E.addEventListener("click",function(){var e=w((parseFloat(g.value)||o)+c);g.value=String(e),k.value=parseFloat(e).toFixed(l),I()}),N.addEventListener("click",function(){var n=w(parseFloat(k.value)||o);setReservationQty(t,n),trackEvent("add_to_cart",t.sku||"",t.name||""),renderWeightControl(e,t,a)}),e.appendChild(p)}function renderWeightControlCompact(e,t,a){e.innerHTML="";var n=(t.unit||"").trim(),r=n.toLowerCase(),i="kg"===r||-1!==r.indexOf("kg"),o=parseFloat(t.low_amount)||(i?.1:50),s=parseFloat(t.high_amount)||(i?5:5e3),c=parseFloat(t.step)||(i?.1:50),l=i?1:0,d=parseFloat((t.price_per_unit||"0").replace(/[^0-9.]/g,""))||0,u=getReservedQty(a),m=u>0?u:o,p=document.createElement("div");p.className="weight-control-compact";var v=document.createElement("div");v.className="weight-control-compact-slider-row";var f=document.createElement("input");f.type="range",f.className="weight-control-range weight-control-range--compact",f.min=String(o),f.max=String(s),f.step=String(c),f.value=String(m),f.setAttribute("aria-label","Select amount in "+n);var h=document.createElement("span");h.className="weight-control-compact-amount",h.textContent=parseFloat(m).toFixed(l)+" "+n,v.appendChild(f),v.appendChild(h),p.appendChild(v);var g=document.createElement("div");g.className="weight-control-compact-action-row";var E=document.createElement("input");E.type="number",E.className="weight-control-input",E.min=String(o),E.max=String(s),E.step=String(c),E.value=parseFloat(m).toFixed(l);var b=document.createElement("span");b.className="weight-control-unit-label",b.textContent=n;var C=document.createElement("span");C.className="weight-control-compact-price",C.textContent="$"+(m*d).toFixed(2);var y=document.createElement("button");function L(e){var t=Math.round(e/c)*c;return t<o&&(t=o),t>s&&(t=s),parseFloat(t.toFixed(l+2))}function S(){var e,t=L(parseFloat(f.value)||o);h.textContent=parseFloat(t).toFixed(l)+" "+n,C.textContent="$"+(t*d).toFixed(2),f.style.setProperty("--fill",(e=t,(s===o?0:(e-o)/(s-o)*100)+"%"))}y.type="button",y.className="weight-control-add",y.textContent=u>0?"Update":"Add",g.appendChild(E),g.appendChild(b),g.appendChild(C),g.appendChild(y),p.appendChild(g),S(),f.addEventListener("input",function(){E.value=parseFloat(L(parseFloat(f.value))).toFixed(l),S()}),E.addEventListener("input",function(){var e=parseFloat(E.value);isNaN(e)||(e<o&&(e=o),e>s&&(e=s),f.value=String(e),S())}),E.addEventListener("blur",function(){var e=L(parseFloat(E.value)||o);E.value=parseFloat(e).toFixed(l),f.value=String(e),S()}),y.addEventListener("click",function(){var n=L(parseFloat(E.value)||o);setReservationQty(t,n),trackEvent("add_to_cart",t.sku||"",t.name||""),renderWeightControlCompact(e,t,a)}),e.appendChild(p)}function initReservationBar(){var e='<div class="container"><span class="reservation-bar-count"></span><span class="reservation-bar-actions"><button type="button" class="reservation-bar-clear">Clear Cart</button><a href="reservation.html" class="reservation-bar-link">Checkout &rarr;</a></span></div>',t=document.createElement("div");t.className="reservation-bar hidden",t.id="reservation-bar",t.innerHTML=e,document.body.appendChild(t);var a=document.getElementById("product-catalog");if(a){var n=document.createElement("div");n.className="reservation-bar reservation-bar-inline hidden",n.id="reservation-bar-inline",n.innerHTML=e,a.parentNode.insertBefore(n,a)}document.querySelectorAll(".reservation-bar-clear").forEach(function(e){e.addEventListener("click",function(){saveReservation([]),updateReservationBar()})});var r=document.getElementById("cart-sidebar-clear");r&&r.addEventListener("click",function(){saveReservation([]),updateReservationBar(),renderCartSidebar()}),updateReservationBar(),renderCartSidebar()}function updateReservationBar(){var e=document.querySelectorAll(".reservation-bar");if(0!==e.length){var t=getReservation(),a=0;t.forEach(function(e){a+=e.qty||1});for(var n=a+(1===a?" item in cart":" items in cart"),r=0;r<e.length;r++){var i=e[r].querySelector(".reservation-bar-count");a>0?(e[r].classList.remove("hidden"),i&&(i.textContent=n)):e[r].classList.add("hidden")}renderCartSidebar()}}function renderCartSidebar(){var e=document.getElementById("cart-sidebar-items"),t=document.getElementById("cart-sidebar-footer"),a=document.getElementById("cart-sidebar-total"),n=document.getElementById("cart-sidebar");if(e){var r=getReservation();if(e.innerHTML="",0===r.length){n&&n.classList.remove("cart-sidebar--active");var i=document.createElement("p");return i.className="cart-sidebar-empty",i.textContent="Your cart is empty.",e.appendChild(i),void(t&&t.classList.add("hidden"))}n&&n.classList.add("cart-sidebar--active"),t&&t.classList.remove("hidden");var o=0;r.forEach(function(t){var a=parseFloat((t.price||"0").replace(/[^0-9.]/g,""))||0,n=parseFloat(t.discount)||0;n>0&&(a*=1-n/100);var r=a*(t.qty||1);o+=r;var i=document.createElement("div");i.className="cart-sidebar-item";var s=document.createElement("div");s.className="cart-sidebar-item-info";var c=document.createElement("div");if(c.className="cart-sidebar-item-name",c.textContent=t.name,s.appendChild(c),t.brand){var l=document.createElement("div");l.className="cart-sidebar-item-brand",l.textContent=t.brand,s.appendChild(l)}var d=document.createElement("div");d.className="cart-sidebar-item-price",n>0?d.innerHTML='<span class="cart-price-original">$'+parseFloat((t.price||"0").replace(/[^0-9.]/g,"")).toFixed(2)+"</span> $"+a.toFixed(2):a>0&&(d.textContent="$"+a.toFixed(2)),s.appendChild(d),i.appendChild(s);var u,m=document.createElement("div");if(m.className="cart-sidebar-item-controls",isWeightUnit(t.unit)){var p=document.createElement("div");p.className="cart-sidebar-item-weight",p.textContent=(t.qty||0)+" "+t.unit,m.appendChild(p)}else{var v=document.createElement("div");v.className="product-qty-controls";var f=document.createElement("button");f.type="button",f.className="qty-btn",f.textContent="−",f.addEventListener("click",(u=t,function(){for(var e=getReservation(),t=0;t<e.length;t++)if(e[t].name+"|"+(e[t].brand||"")==u.name+"|"+(u.brand||"")){e[t].qty=(e[t].qty||1)-1,e[t].qty<=0&&e.splice(t,1);break}saveReservation(e),updateReservationBar(),renderCartSidebar()}));var h=document.createElement("span");h.className="qty-value",h.textContent=t.qty||1;var g=document.createElement("button");g.type="button",g.className="qty-btn",g.textContent="+",g.addEventListener("click",function(e){return function(){for(var t=getReservation(),a=0;a<t.length;a++)if(t[a].name+"|"+(t[a].brand||"")==e.name+"|"+(e.brand||"")){t[a].qty=(t[a].qty||1)+1;break}saveReservation(t),updateReservationBar(),renderCartSidebar()}}(t)),v.appendChild(f),v.appendChild(h),v.appendChild(g),m.appendChild(v)}var E=document.createElement("button");E.type="button",E.className="cart-sidebar-remove",E.textContent="×",E.title="Remove",E.addEventListener("click",function(e){return function(){saveReservation(getReservation().filter(function(t){return t.name+"|"+(t.brand||"")!=e.name+"|"+(e.brand||"")})),updateReservationBar(),renderCartSidebar()}}(t)),m.appendChild(E);var b=document.createElement("div");b.className="cart-sidebar-line-total",b.textContent="$"+r.toFixed(2),m.appendChild(b),i.appendChild(m),e.appendChild(i)}),a&&(a.textContent="$"+o.toFixed(2))}}function initReservationPage(){initCheckoutStepper(),renderReservationItems();var e=getReservation(),t=e.some(function(e){return"kit"===(e.item_type||"kit")});if(t)loadTimeslots();else{var a=document.getElementById("timeslot-picker");a&&a.classList.add("hidden");var n=document.querySelector('.stepper-step[data-step="2"]');n&&n.classList.add("hidden")}t||document.querySelectorAll(".catalog-batch-note").forEach(function(e){e.classList.add("hidden")});if(!t&&e.length>0){var r=document.querySelector('[data-content="page-title"]');r&&(r.textContent="Complete Your Order"),document.title="Order | Steins & Vines";var i=document.querySelector('[data-content="reserved-items-title"]');i&&(i.textContent="Your items");var o=document.querySelector('[data-content="submit-btn"]');o&&(o.textContent="Place Order");var s=document.querySelector('[data-content="form-note"]');s&&(s.textContent="A confirmation email will be sent to the address provided above. All orders are in-store pickup only.");var c=document.querySelector('[data-content="confirm-title"]');c&&(c.textContent="Order confirmed");var l=document.querySelector('[data-content="confirm-text"]');l&&(l.textContent="Thank you for your order! We will prepare your items for in-store pickup. You will receive a confirmation email shortly.");var d=document.querySelector(".confirm-next");d&&(d.innerHTML="<h3>What's Next</h3><ol><li>We'll send a confirmation email with your order details</li><li>We'll notify you when your order is ready for pickup</li><li>Visit us in-store to collect your items</li></ol>")}setupReservationForm()}function initCheckoutStepper(){var e=document.getElementById("checkout-stepper");if(e){var t=e.querySelectorAll(".stepper-step"),a={1:"reservation-list",2:"timeslot-picker",3:"reservation-form-section",4:"reservation-confirm"};if(t.forEach(function(e){e.addEventListener("click",function(){if(e.classList.contains("stepper-step--done")){var t=parseInt(e.getAttribute("data-step"),10),n=a[t],r=document.getElementById(n);r&&r.scrollIntoView({behavior:"smooth",block:"start"})}})}),"IntersectionObserver"in window){var n=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t=parseInt(e.target.getAttribute("data-checkout-step"),10);t&&updateStepper(t)}})},{threshold:.3,rootMargin:"-80px 0px 0px 0px"});document.querySelectorAll("[data-checkout-step]").forEach(function(e){n.observe(e)})}}}function updateStepper(e){document.querySelectorAll(".stepper-step").forEach(function(t){var a=parseInt(t.getAttribute("data-step"),10);t.classList.remove("stepper-step--active","stepper-step--done"),a<e?t.classList.add("stepper-step--done"):a===e&&t.classList.add("stepper-step--active")})}function refreshReservationDependents(){if(getReservation().some(function(e){return"kit"===(e.item_type||"kit")})){loadTimeslots();var e=document.querySelector('input[name="timeslot"]:checked');if(e)updateCompletionEstimate(e.value);else{var t=document.getElementById("completion-estimate");t&&t.classList.add("hidden")}}else{var a=document.getElementById("timeslot-picker");a&&a.classList.add("hidden")}}function renderReservationItems(){var e=document.getElementById("reservation-items"),t=document.getElementById("reservation-empty");if(e){var a=getReservation();if(e.innerHTML="",0===a.length){t&&t.classList.remove("hidden");var n=document.getElementById("timeslot-picker"),r=document.getElementById("reservation-form-section");return n&&n.classList.add("hidden"),void(r&&r.classList.add("hidden"))}t&&t.classList.add("hidden");n=document.getElementById("timeslot-picker"),r=document.getElementById("reservation-form-section");n&&n.classList.remove("hidden"),r&&r.classList.remove("hidden");var i=document.createElement("table");i.className="catalog-table reservation-table";var o=document.createElement("thead"),s=a.some(function(e){return""!==(e.time||"").trim()}),c=a.some(function(e){return""!==(e.brand||"").trim()}),l=document.createElement("tr");["Name","Type","Brand","Time","Price","Status","Qty",""].forEach(function(e){if(("Time"!==e||s)&&("Brand"!==e||c)){var t=document.createElement("th");t.textContent=e,l.appendChild(t)}}),o.appendChild(l),i.appendChild(o);var d=document.createElement("tbody");a.forEach(function(e){var t=document.createElement("tr"),a=document.createElement("td");a.setAttribute("data-label","Name");var n=document.createElement("span");if(n.className="table-name",n.textContent=e.name,a.appendChild(n),e.discount&&parseFloat(e.discount)>0){var r=document.createElement("span");r.className="discount-badge-sm",r.textContent=Math.round(parseFloat(e.discount))+"% OFF",a.appendChild(r)}t.appendChild(a);var i=document.createElement("td");i.setAttribute("data-label","Type");var o=(e.item_type||"kit").charAt(0).toUpperCase()+(e.item_type||"kit").slice(1);if(i.textContent=o,t.appendChild(i),c){var l=document.createElement("td");l.setAttribute("data-label","Brand"),l.textContent=e.brand||"",t.appendChild(l)}if(s){var u=document.createElement("td");u.setAttribute("data-label","Time"),u.textContent=e.time||"",t.appendChild(u)}var m=document.createElement("td");if(m.setAttribute("data-label","Price"),e.price){var p="$"===e.price.charAt(0)?e.price:"$"+e.price;if(e.discount&&parseFloat(e.discount)>0){var v=((parseFloat((e.price||"0").replace("$",""))||0)*(1-parseFloat(e.discount)/100)).toFixed(2);m.className="table-prices",m.innerHTML='<span class="table-price-original">'+p+'</span><span class="table-price-sale">$'+v+"</span>"}else m.textContent=p}t.appendChild(m);var f=document.createElement("td");f.setAttribute("data-label","Status");var h=parseInt(e.stock,10)||0,g=document.createElement("span");g.className="reservation-item-stock",h>0?(g.classList.add("reservation-item-stock--available"),g.textContent="In Stock"):(g.classList.add("reservation-item-stock--order"),g.textContent="Needs Ordering"),f.appendChild(g),t.appendChild(f);var E=document.createElement("td");E.setAttribute("data-label","Qty");var b=document.createElement("div");b.className="product-qty-controls";var C,y=document.createElement("button");y.type="button",y.className="qty-btn",y.textContent="−",y.addEventListener("click",(C=e,function(){for(var e=getReservation(),t=0;t<e.length;t++)if(e[t].name+"|"+e[t].brand==C.name+"|"+C.brand){e[t].qty=(e[t].qty||1)-1,e[t].qty<=0&&e.splice(t,1);break}saveReservation(e),renderReservationItems(),refreshReservationDependents()}));var L=document.createElement("span");L.className="qty-value",L.textContent=e.qty||1;var S=document.createElement("button");S.type="button",S.className="qty-btn",S.textContent="+",S.addEventListener("click",function(e){return function(){for(var t=getReservation(),a=0;a<t.length;a++)if(t[a].name+"|"+t[a].brand==e.name+"|"+e.brand){t[a].qty=(t[a].qty||1)+1;break}saveReservation(t),renderReservationItems(),refreshReservationDependents()}}(e)),b.appendChild(y),b.appendChild(L),b.appendChild(S),E.appendChild(b),t.appendChild(E);var k=document.createElement("td");k.setAttribute("data-label","");var x=document.createElement("button");x.type="button",x.className="reservation-item-remove",x.textContent="Remove",x.addEventListener("click",function(){saveReservation(getReservation().filter(function(t){return t.name+"|"+t.brand!=e.name+"|"+e.brand})),renderReservationItems(),refreshReservationDependents()}),k.appendChild(x),t.appendChild(k),d.appendChild(t)}),i.appendChild(d),e.appendChild(i);var u=0;if(a.forEach(function(e){var t=parseFloat((e.price||"0").replace("$",""))||0,a=parseFloat(e.discount)||0;a>0&&(t*=1-a/100),u+=t*(e.qty||1)}),!a.some(function(e){return"kit"===(e.item_type||"kit")})){var m=0;a.forEach(function(e){var t=parseFloat((e.price||"0").replace("$",""))||0,a=parseFloat(e.discount)||0;a>0&&(t*=1-a/100);var n=parseFloat(e.tax_percentage)||0;m+=t*(e.qty||1)*(n/100)});var p=u+m,v=document.createElement("div");v.className="order-summary-totals";var f=document.createElement("div");if(f.className="reservation-subtotal",f.innerHTML="<span>Subtotal</span><span>$"+u.toFixed(2)+"</span>",v.appendChild(f),m>0){var h=document.createElement("div");h.className="reservation-subtotal reservation-subtotal--detail",h.innerHTML="<span>Tax</span><span>$"+m.toFixed(2)+"</span>",v.appendChild(h)}var g=document.createElement("div");g.className="reservation-subtotal reservation-subtotal--total",g.innerHTML="<span>Total</span><span>$"+p.toFixed(2)+"</span>",v.appendChild(g);var E=document.createElement("div");E.className="reservation-pickup-note",E.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/></svg> In-store pickup only',v.appendChild(E),e.appendChild(v)}else{var b=document.createElement("div");b.className="reservation-subtotal",b.innerHTML='<span>Estimated Subtotal <span class="reservation-disclaimer">— Final pricing may vary.</span></span><span>$'+u.toFixed(2)+"</span>",e.appendChild(b)}var C=document.createElement("div");C.className="reservation-clear-wrap";var y=document.createElement("button");y.type="button",y.className="btn-secondary reservation-clear-btn",y.textContent="Clear Selected Items",y.addEventListener("click",function(){saveReservation([]),renderReservationItems(),refreshReservationDependents()}),C.appendChild(y),e.appendChild(C),window.dispatchEvent(new Event("reservation-changed"))}}function loadTimeslots(){var e=document.getElementById("timeslot-groups");if(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.MIDDLEWARE_URL?SHEETS_CONFIG.MIDDLEWARE_URL:"",a=getReservation(),n=a.some(function(e){return 0===(e.stock||0)}),r=null;if(n&&((r=new Date).setDate(r.getDate()+14),r.setHours(0,0,0,0)),e.innerHTML="",n){var i=document.createElement("p");i.className="timeslot-notice",i.textContent="Some of your selected items need to be ordered in. Timeslots within the next 2 weeks are not available.",e.appendChild(i)}if(document.body.classList.contains("kiosk-mode")&&!n&&a.length>0){var o=document.createElement("div");o.className="start-now-wrap";var s=document.createElement("button");s.type="button",s.className="btn start-now-btn",s.textContent="Start Now";var c=document.createElement("p");c.className="start-now-note",c.textContent="All your items are in stock — start your fermentation right away.";var l=document.createElement("input");l.type="radio",l.name="timeslot",l.value="Walk-in — Immediate",l.classList.add("hidden"),e.appendChild(l),s.addEventListener("click",function(){l.checked=!0,s.classList.add("start-now-selected"),e.querySelectorAll('input[name="timeslot"]:not([value="Walk-in — Immediate"])').forEach(function(e){e.checked=!1});var t=document.getElementById("completion-estimate");t&&t.classList.add("hidden")});var d=document.createElement("p");d.className="start-now-or",d.textContent="or choose a timeslot below",o.appendChild(c),o.appendChild(s),o.appendChild(d),e.appendChild(o)}var u=document.createElement("div");u.className="cal",e.appendChild(u);var m=document.createElement("div");m.className="cal-slots",e.appendChild(m);for(var p=null,v=0,f=new Date,h=[],g=0;g<4;g++){var E=new Date(f.getFullYear(),f.getMonth()+g,1);h.push(E.getFullYear()+"-"+String(E.getMonth()+1).padStart(2,"0"))}var b=0,C={};!function e(){u.innerHTML="";var a=h[b],n=parseInt(a.substring(0,4),10),i=parseInt(a.substring(5,7),10)-1,o=document.createElement("div");o.className="cal-header";var s=document.createElement("button");s.type="button",s.className="cal-nav",s.textContent="‹",s.disabled=0===b,s.addEventListener("click",function(){b>0&&(b--,e())});var c=document.createElement("span");c.className="cal-title",c.textContent=["January","February","March","April","May","June","July","August","September","October","November","December"][i]+" "+n;var l=document.createElement("button");l.type="button",l.className="cal-nav",l.textContent="›",l.disabled=b===h.length-1,l.addEventListener("click",function(){b<h.length-1&&(b++,e())}),o.appendChild(s),o.appendChild(c),o.appendChild(l),u.appendChild(o);var d=document.createElement("div");d.className="cal-grid",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(function(e){var t=document.createElement("div");t.className="cal-dow",t.textContent=e,d.appendChild(t)}),u.appendChild(d),function(e,a){if(C[e])a(C[e]);else{var n=e.split("-");fetch(t+"/api/bookings/availability?year="+n[0]+"&month="+n[1]).then(function(e){return e.json()}).then(function(t){var n=t.dates||[],r={};n.forEach(function(e){r[e.date]=!0}),C[e]=r,a(r)}).catch(function(){C[e]={},a({})})}}(a,function(t){var a=new Date(n,i,1).getDay(),o=new Date(n,i+1,0).getDate(),s=new Date;s.setHours(0,0,0,0);for(var c=s.getFullYear()+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0"),l=0;l<a;l++){var u=document.createElement("div");u.className="cal-day cal-day--disabled",d.appendChild(u)}for(var m=1;m<=o;m++){var v=n+"-"+String(i+1).padStart(2,"0")+"-"+String(m).padStart(2,"0"),f=document.createElement("button");f.type="button",f.className="cal-day",f.textContent=m,f.setAttribute("data-date",v);var h=new Date(v+"T00:00:00"),g=h<s,E=!!t[v],b=r&&h<r;v===c&&f.classList.add("cal-day--today"),v===p&&f.classList.add("cal-day--selected"),g||!E||b?(f.classList.add("cal-day--disabled"),f.disabled=!0):f.classList.add("cal-day--available"),function(t){f.addEventListener("click",function(){p=t,e(),y(t)})}(v),d.appendChild(f)}})}(),e.addEventListener("change",function(t){if("timeslot"===t.target.name){updateCompletionEstimate(t.target.value);var a=e.querySelector(".start-now-btn");a&&"Walk-in — Immediate"!==t.target.value&&a.classList.remove("start-now-selected")}})}function y(e){m.innerHTML='<p class="cal-slots-loading">Loading times...</p>',fetch(t+"/api/bookings/slots?date="+e).then(function(e){return e.json()}).then(function(t){m.innerHTML="";var a=t.slots||[];if(0!==a.length){var n=new Date(e+"T00:00:00"),r=document.createElement("h3");r.className="cal-slots-heading",r.textContent=n.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),m.appendChild(r);var i=document.createElement("div");i.className="cal-slots-grid",a.forEach(function(t){var a=t.time||t,n=document.createElement("div");n.className="timeslot-option";var r="timeslot-"+v;v++;var o=document.createElement("input");o.type="radio",o.name="timeslot",o.id=r,o.value=e+" "+a;var s=document.createElement("label");s.setAttribute("for",r),s.textContent=a,n.appendChild(o),n.appendChild(s),i.appendChild(n)}),m.appendChild(i)}else m.innerHTML="<p>No available times for this date.</p>"}).catch(function(){m.innerHTML="<p>Unable to load times for this date.</p>"})}}function updateCompletionEstimate(e){var t=document.getElementById("completion-estimate"),a=document.getElementById("completion-estimate-text");if(t&&a){var n=getReservation();if(0!==n.length){var r=0;if(n.forEach(function(e){var t=parseInt(e.time,10);!isNaN(t)&&t>r&&(r=t)}),0!==r){var i=e.split(" ")[0],o=new Date(i+"T00:00:00");if(isNaN(o.getTime()))t.classList.add("hidden");else{var s=new Date(o);s.setDate(s.getDate()+7*r);var c=new Date(s);c.setDate(c.getDate()+6);var l={month:"long",day:"numeric"},d=s.toLocaleDateString("en-US",l),u=s.getMonth()===c.getMonth()?{day:"numeric"}:l,m=c.toLocaleDateString("en-US",u),p=c.getFullYear();a.textContent="Estimated ready the week of "+d+"–"+m+", "+p+" (approximately "+r+" week"+(1!==r?"s":"")+" from your appointment). This is an estimate — actual times may vary.",t.classList.remove("hidden")}}else t.classList.add("hidden")}else t.classList.add("hidden")}}var BEER_WAITLIST_FORM_URL="https://docs.google.com/forms/d/e/YOUR_BEER_WAITLIST_FORM_ID/formResponse",BEER_WAITLIST_FIELDS={email:"entry.YOUR_EMAIL_ENTRY_ID"};function setupBeerWaitlistForm(){var e=document.getElementById("beer-waitlist-form");e&&e.addEventListener("submit",function(t){t.preventDefault();var a=document.getElementById("beer-waitlist-email").value.trim();if(a){var n=document.createElement("form");n.method="POST",n.action=BEER_WAITLIST_FORM_URL,n.target="beer-waitlist-iframe",n.style.display="none";var r=document.createElement("input");r.name=BEER_WAITLIST_FIELDS.email,r.value=a,n.appendChild(r),document.body.appendChild(n),n.submit(),document.body.removeChild(n),e.classList.add("hidden"),document.getElementById("beer-waitlist-confirm").classList.remove("hidden")}})}function setupReservationForm(){var e=document.getElementById("reservation-form");if(e){var t=document.getElementById("res-loaded-at");t&&(t.value=String(Date.now()));var a=document.getElementById("payment-section"),n=document.getElementById("payment-error"),r=document.getElementById("deposit-summary"),i=null,o=null,s=null,c=document.body.classList.contains("kiosk-mode"),l="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.MIDDLEWARE_URL?SHEETS_CONFIG.MIDDLEWARE_URL:"";!c&&a&&fetch(l+"/api/payment/config").then(function(e){return e.json()}).then(function(e){if(s=e,e.enabled&&e.accessToken){a.classList.remove("hidden");var t=document.getElementById("payment-heading"),r=document.getElementById("payment-note");!getReservation().some(function(e){return"kit"===(e.item_type||"kit")})?r&&(r.textContent="Your card will be charged the full amount. In-store pickup only."):(t&&(t.textContent="Payment — $"+Number(e.depositAmount).toFixed(2)+" deposit"),r&&(r.textContent="Your card will be charged a $"+Number(e.depositAmount).toFixed(2)+" deposit. The remaining balance is due at your appointment.")),"undefined"!=typeof GlobalPayments&&(GlobalPayments.configure({accessToken:e.accessToken,apiVersion:"2021-03-22",env:"production"===e.env?"production":"sandbox"}),(i=GlobalPayments.ui.form({fields:{"card-holder-name":{placeholder:"Jane Smith",target:"#credit-card-holder"},"card-number":{placeholder:"•••• •••• •••• ••••",target:"#credit-card-number"},"card-expiration":{placeholder:"MM / YYYY",target:"#credit-card-expiry"},"card-cvv":{placeholder:"•••",target:"#credit-card-cvv"},submit:{text:"Verify Card",target:"#credit-card-submit"}},styles:{"#secure-payment-field[type=button]":{background:"#722F37",border:"1px solid #722F37",color:"#ffffff",cursor:"pointer",padding:"12px 24px","font-size":"16px","border-radius":"4px",width:"100%","font-family":"Lato, sans-serif"},"#secure-payment-field[type=button]:hover":{background:"#5a2530"}}})).on("token-success",function(e){o=e.paymentReference,n&&(n.textContent="",n.classList.remove("visible"));var t=document.getElementById("credit-card-submit");t&&t.classList.add("card-verified")}),i.on("token-error",function(e){o=null,n&&(n.textContent=e.error&&e.error.message||"Card validation failed.",n.classList.add("visible"))}))}}).catch(function(e){console.error("[payment] Config fetch failed:",e.message)}),window.addEventListener("reservation-changed",p),window.addEventListener("storage",p),setTimeout(p,500);var d=document.getElementById("res-name"),u=document.getElementById("res-email"),m=document.getElementById("res-phone");d&&d.addEventListener("blur",function(){this.value.trim()?h(this):(g(this),v(this,"Name is required."))}),u&&u.addEventListener("blur",function(){var e=this.value.trim();return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?void h(this):(g(this),void v(this,"Please enter a valid email.")):(g(this),void v(this,"Email is required."))}),m&&m.addEventListener("blur",function(){var e=this.value.trim();return e?e.replace(/\D/g,"").length<10?(g(this),void v(this,"Please enter at least 10 digits.")):void h(this):(g(this),void v(this,"Phone number is required."))}),[d,u,m].forEach(function(e){e&&e.addEventListener("focus",function(){f(this),g(this)})}),e.addEventListener("submit",function(t){t.preventDefault();var a=document.getElementById("res-website");if(!a||!a.value){if(!document.body.classList.contains("kiosk-mode")){var n=parseInt(document.getElementById("res-loaded-at").value,10)||0;if(Date.now()-n<3e3)return}var r=getReservation();if(0!==r.length){var i=r.some(function(e){return"kit"===(e.item_type||"kit")}),d=document.querySelector('input[name="timeslot"]:checked');if(!i||d){var u=document.getElementById("res-name").value.trim(),m=document.getElementById("res-email").value.trim(),p=document.getElementById("res-phone").value.trim();if(u){if(!c){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m))return void showToast("Please enter a valid email address.","error");var v=p.replace(/\D/g,"");if(v.length<10||v.length>15)return void showToast("Please enter a valid phone number (at least 10 digits).","error")}var f=r.map(function(e){var t=e.qty||1;return e.name+(t>1?" x"+t:"")}).join(", "),h=d?d.value:i?"No timeslot — Pickup only":"In-store pickup",g=e.querySelector('button[type="submit"]');g&&(g.disabled=!0,g.setAttribute("data-original-text",g.textContent),g.textContent="Processing...",g.classList.add("btn-loading"));var E=l,b="Walk-in — Immediate"===h,C=!b&&!c&&s&&s.enabled,y=0;r.forEach(function(e){var t=String(e.price||"0").replace(/[^0-9.]/g,""),a=parseFloat(e.discount)||0,n=parseFloat(t)||0;a>0&&(n*=1-a/100),y+=n*(e.qty||1)});var L=!r.some(function(e){return"kit"===(e.item_type||"kit")}),S=0;L&&r.forEach(function(e){var t=String(e.price||"0").replace(/[^0-9.]/g,""),a=parseFloat(e.discount)||0,n=parseFloat(t)||0;a>0&&(n*=1-a/100);var r=parseFloat(e.tax_percentage)||0;S+=n*(e.qty||1)*(r/100)});var k,x=y+S,_=C?L?x:Math.min(s.depositAmount,y):0,N=h.split(" "),w=N[0],I=N.slice(1).join(" ");if(C&&_>0){if(!o)return showToast("Please enter your card details.","error"),void(g&&(g.disabled=!1,g.textContent=g.getAttribute("data-original-text")||"Submit Reservation",g.classList.remove("btn-loading")));k=fetch(E+"/api/payment/charge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o,amount:_,customer:{name:u,email:m}})}).then(function(e){return e.ok?e.json():e.json().then(function(e){throw new Error(e.error||"Payment failed")})})}else k=Promise.resolve({transaction_id:"",amount:0});k.then(function(e){var t=e.transaction_id||"",a=e.amount||0,n=m||(c?"walkin@steinsandvines.ca":"");return fetch(E+"/api/contacts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u,email:n,phone:p})}).then(function(e){if(!e.ok)throw new Error("Failed to create contact");return e.json()}).then(function(e){var t=e.contact_id;return b?{customerId:t,bookingId:null,timeslotLabel:"Walk-in — Immediate"}:fetch(E+"/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:w,time:I,customer:{name:u,email:m,phone:p},notes:f})}).then(function(e){if(!e.ok)throw new Error("Failed to create booking");return e.json()}).then(function(e){return{customerId:t,bookingId:e.booking_id,timeslotLabel:e.timeslot||h}})}).then(function(e){var n=r.map(function(e){var t={name:e.name+(e.brand?" — "+e.brand:""),quantity:e.qty||1,rate:parseFloat(String(e.price||"0").replace(/[^0-9.]/g,""))||0};e.zoho_item_id&&(t.item_id=e.zoho_item_id);var a=parseFloat(e.discount)||0;return a>0&&(t.discount=a),t}),i={customer_id:e.customerId,items:n,notes:(L?"Order":"Reservation")+" for "+u+" — "+h,appointment_id:e.bookingId||"",timeslot:e.timeslotLabel};return t&&(i.transaction_id=t,i.deposit_amount=a),fetch(E+"/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(function(e){if(!e.ok)throw new Error("Failed to create order");return e.json()})})}).then(function(e){var t=r.slice(),a=h;return(c&&E?fetch(E+"/api/pos/status").then(function(e){return e.json()}).then(function(a){return a.enabled?(showTerminalOverlay("Processing payment on terminal...","Please tap, insert, or swipe your card."),fetch(E+"/api/pos/sale",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:y,salesorder_number:e.salesorder_number||"",items:t.map(function(e){return{name:e.name,price:e.price,qty:e.qty||1}}),customer_name:u})}).then(function(e){return e.json()}).then(function(e){return hideTerminalOverlay(),e}).catch(function(e){return hideTerminalOverlay(),console.error("[kiosk] Terminal sale failed:",e.message),{error:e.message}})):null}).catch(function(){return null}):Promise.resolve(null)).then(function(n){localStorage.removeItem(RESERVATION_KEY),document.getElementById("reservation-list").classList.add("hidden"),document.getElementById("timeslot-picker").classList.add("hidden"),document.getElementById("reservation-form-section").classList.add("hidden"),updateStepper(4);var r=document.getElementById("reservation-confirm");if(r){r.classList.remove("hidden");var i=document.getElementById("confirm-order-number");i&&e&&e.salesorder_number&&(i.textContent="Order #"+e.salesorder_number);var o=document.getElementById("confirm-summary");if(o){var s="";t.forEach(function(e){var t=e.qty||1,a=parseFloat(String(e.price||"0").replace(/[^0-9.]/g,""))||0,n=parseFloat(e.discount)||0;n>0&&(a*=1-n/100),s+='<div class="confirm-summary-row"><span>'+escapeHTML(e.name)+(t>1?" x"+t:"")+"</span><span>$"+(a*t).toFixed(2)+"</span></div>"}),L?(s+='<div class="confirm-summary-row"><span>Pickup</span><span>In-store</span></div>',s+='<div class="confirm-summary-row"><span>Subtotal</span><span>$'+y.toFixed(2)+"</span></div>",S>0&&(s+='<div class="confirm-summary-row"><span>Tax</span><span>$'+S.toFixed(2)+"</span></div>"),s+='<div class="confirm-summary-row confirm-summary-row--total"><span>Total paid</span><span>$'+x.toFixed(2)+"</span></div>"):(s+='<div class="confirm-summary-row"><span>Timeslot</span><span>'+escapeHTML(a)+"</span></div>",n&&n.ok?s+='<div class="confirm-summary-row"><span>Paid via terminal</span><span>$'+Number(n.amount).toFixed(2)+"</span></div>":e&&e.deposit_amount>0?(s+='<div class="confirm-summary-row"><span>Deposit paid</span><span>$'+Number(e.deposit_amount).toFixed(2)+"</span></div>",e.balance_due>0&&(s+='<div class="confirm-summary-row confirm-summary-row--total"><span>Balance due</span><span>$'+Number(e.balance_due).toFixed(2)+"</span></div>")):s+='<div class="confirm-summary-row confirm-summary-row--total"><span>Total</span><span>$'+y.toFixed(2)+"</span></div>",n&&n.error&&(s+='<div class="confirm-summary-row" style="color:var(--color-brown);"><span>Please pay at the counter</span><span></span></div>')),o.innerHTML=s}r.scrollIntoView({behavior:"smooth",block:"start"})}})}).catch(function(e){showToast("Something went wrong: "+e.message+". Please try again.","error"),g&&(g.disabled=!1,g.textContent=g.getAttribute("data-original-text")||(L?"Place Order":"Submit Reservation"),g.classList.remove("btn-loading"))})}else showToast("Please enter your name.","error")}else showToast("Please select a timeslot.","error")}else showToast("Please add at least one product to your reservation.","error")}})}function p(){if(r&&s&&s.enabled&&!c){var e=getReservation(),t=0;if(e.forEach(function(e){var a=parseFloat(String(e.price||"0").replace(/[^0-9.]/g,""))||0,n=parseFloat(e.discount)||0;n>0&&(a*=1-n/100),t+=a*(e.qty||1)}),0===e.length||t<=0)r.classList.add("hidden");else if(!e.some(function(e){return"kit"===(e.item_type||"kit")})){var a=0;e.forEach(function(e){var t=parseFloat(String(e.price||"0").replace(/[^0-9.]/g,""))||0,n=parseFloat(e.discount)||0;n>0&&(t*=1-n/100);var r=parseFloat(e.tax_percentage)||0;a+=t*(e.qty||1)*(r/100)});var n=t+a,i='<div class="deposit-summary-row"><span>Subtotal</span><span>$'+t.toFixed(2)+"</span></div>";a>0&&(i+='<div class="deposit-summary-row"><span>Tax</span><span>$'+a.toFixed(2)+"</span></div>"),i+='<div class="deposit-summary-row deposit-summary-row--total"><span>Total</span><span>$'+n.toFixed(2)+"</span></div>",r.innerHTML=i,r.classList.remove("hidden");var o=document.getElementById("payment-heading");o&&(o.innerHTML='<svg class="payment-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg> Payment — $'+n.toFixed(2))}else{var l=Math.min(s.depositAmount,t),d=Math.max(0,t-l);r.innerHTML='<div class="deposit-summary-row"><span>Deposit</span><span id="deposit-summary-amount">$'+l.toFixed(2)+'</span></div><div class="deposit-summary-row"><span>Balance due at appointment</span><span id="deposit-summary-balance">$'+d.toFixed(2)+"</span></div>",r.classList.remove("hidden")}}}function v(e,t){e.classList.add("field-error");var a=e.parentElement.querySelector(".form-error-msg");a||((a=document.createElement("div")).className="form-error-msg",e.parentElement.appendChild(a)),a.textContent=t,a.classList.add("visible")}function f(e){e.classList.remove("field-error");var t=e.parentElement.querySelector(".form-error-msg");t&&t.classList.remove("visible")}function h(e){f(e),e.classList.add("field-valid")}function g(e){e.classList.remove("field-valid")}}function setupContactValidation(){var e=document.getElementById("name"),t=document.getElementById("email");function a(e,t){e.classList.add("field-error");var a=e.parentElement.querySelector(".form-error-msg");a||((a=document.createElement("div")).className="form-error-msg",e.parentElement.appendChild(a)),a.textContent=t,a.classList.add("visible")}function n(e){e.classList.remove("field-error");var t=e.parentElement.querySelector(".form-error-msg");t&&t.classList.remove("visible")}(e||t)&&(e&&(e.addEventListener("blur",function(){this.value.trim()?n(this):a(this,"Name is required.")}),e.addEventListener("focus",function(){n(this)})),t&&(t.addEventListener("blur",function(){var e=this.value.trim();e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?n(this):a(this,"Please enter a valid email."):a(this,"Email is required.")}),t.addEventListener("focus",function(){n(this)})))}