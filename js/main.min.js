var _eventQueue=[],_EVENT_FLUSH_THRESHOLD=5;function trackEvent(e,t,n){("undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.TRACK_EVENTS_URL?SHEETS_CONFIG.TRACK_EVENTS_URL:"")&&(_eventQueue.push({type:e,sku:t,name:n}),_eventQueue.length>=_EVENT_FLUSH_THRESHOLD&&flushEvents())}function flushEvents(){if(0!==_eventQueue.length){var e="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.TRACK_EVENTS_URL?SHEETS_CONFIG.TRACK_EVENTS_URL:"";if(e){var t=JSON.stringify({events:_eventQueue});_eventQueue=[],navigator.sendBeacon&&navigator.sendBeacon(e,new Blob([t],{type:"application/json"}))}}}function loadOpenHours(){var e=document.getElementById("open-hours");if(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL?SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL:null,a="content/timeslots.csv";(n?r(n):Promise.resolve(!1)).then(function(e){if(!e)return r(a)}).catch(function(){return r(a).catch(function(){})})}function r(n){return fetch(n).then(function(e){return e.text()}).then(function(n){return function(n){var a=n.trim().split("\n");if(a.length<2)return!1;for(var r=a[0].split(","),o=[],i=1;i<a.length;i++){var s=a[i].split(",");if(!(s.length<3)){for(var c={},l=0;l<r.length;l++)c[r[l].trim()]=s[l].trim();o.push(c)}}var d=new Date;if(d.setHours(0,0,0,0),0===(o=o.filter(function(e){return new Date(e.date+"T00:00:00")>=d})).length)return!1;var u={};function m(e){var t=Math.floor(e/60),n=e%60;return(t>12?t-12:0===t?12:t)+":"+(n<10?"0"+n:""+n)+" "+(t>=12?"PM":"AM")}o.forEach(function(e){var t=new Date(e.date+"T00:00:00").getDay(),n=e.time.match(/(\d+):(\d+)\s*(AM|PM)/i);if(n){var a=parseInt(n[1],10),r=parseInt(n[2],10),o=n[3].toUpperCase();"PM"===o&&12!==a&&(a+=12),"AM"===o&&12===a&&(a=0);var i=60*a+r;u[t]||(u[t]={min:i,max:i}),i<u[t].min&&(u[t].min=i),i>u[t].max&&(u[t].max=i)}});for(var p='<h2>Open Hours</h2><ul class="open-hours-list">',v=0;v<7;v++){var f=u[v];p+='<li class="open-hours-row'+(f?"":" closed")+'">',p+='<span class="open-hours-day">'+t[v]+"</span>",p+=f?'<span class="open-hours-time">'+m(f.min)+" &ndash; "+m(f.max+30)+"</span>":'<span class="open-hours-time">Closed</span>',p+="</li>"}return p+="</ul>",e.innerHTML=p,!0}(n)})}}function loadFAQ(){var e=document.getElementById("faq-list");if(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL?SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL:null;t&&fetch(t).then(function(e){return e.text()}).then(function(t){var n=t.trim().split("\n");if(!(n.length<2)){for(var a=[],r=1;r<n.length;r++){var o=n[r].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)||[];"faq"===((o=o.map(function(e){return e.replace(/^"|"$/g,"").replace(/""/g,'"').trim()}))[0]||"").toLowerCase()&&a.push({question:o[2]||"",answer:o[3]||""})}if(0!==a.length){var i="";a.forEach(function(e){i+='<div class="faq-item">',i+='<button type="button" class="faq-question">'+escapeHTML(e.question)+"</button>",i+='<div class="faq-answer"><p>'+escapeHTML(e.answer)+"</p></div>",i+="</div>"}),e.innerHTML=i,e.querySelectorAll(".faq-question").forEach(function(e){e.addEventListener("click",function(){this.parentElement.classList.toggle("open")})})}}}).catch(function(e){console.error("[FAQ] Error loading:",e)})}}function loadFooterHours(){var e=document.getElementById("footer-hours");if(e){var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL?SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL:null,a="content/timeslots.csv";(n?r(n):Promise.resolve(!1)).then(function(e){if(!e)return r(a)}).catch(function(){return r(a).catch(function(){})})}function r(n){return fetch(n).then(function(e){return e.text()}).then(function(n){return function(n){var a=n.trim().split("\n");if(a.length<2)return!1;for(var r=a[0].split(","),o=[],i=1;i<a.length;i++){var s=a[i].split(",");if(!(s.length<3)){for(var c={},l=0;l<r.length;l++)c[r[l].trim()]=s[l].trim();o.push(c)}}var d=new Date;if(d.setHours(0,0,0,0),0===(o=o.filter(function(e){return new Date(e.date+"T00:00:00")>=d})).length)return!1;var u={};function m(e){var t=Math.floor(e/60),n=e%60;return(t>12?t-12:0===t?12:t)+(n>0?":"+(n<10?"0"+n:n):"")+(t>=12?"PM":"AM")}o.forEach(function(e){var t=new Date(e.date+"T00:00:00").getDay(),n=e.time.match(/(\d+):(\d+)\s*(AM|PM)/i);if(n){var a=parseInt(n[1],10),r=parseInt(n[2],10),o=n[3].toUpperCase();"PM"===o&&12!==a&&(a+=12),"AM"===o&&12===a&&(a=0);var i=60*a+r;u[t]||(u[t]={min:i,max:i}),i<u[t].min&&(u[t].min=i),i>u[t].max&&(u[t].max=i)}});for(var p="",v=0;v<7;v++){var f=u[v];p+='<span class="footer-hours-day'+(f?"":" closed")+'">',p+='<span class="footer-hours-abbr">'+t[v]+"</span> ",p+=f?m(f.min)+"–"+m(f.max+30):"Closed",p+="</span>"}return e.innerHTML=p,!0}(n)})}}function loadSocialLinks(){var e=document.querySelector(".footer-social");if(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL?SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL:null;t&&fetch(t).then(function(e){return e.ok?e.text():""}).then(function(t){if(t.trim()){for(var a=t.trim().split("\n"),r={},o=1;o<a.length;o++){var i=n(a[o]);if("social"===(i[0]||"").toLowerCase().trim()){var s=(i[2]||"").toLowerCase().trim(),c=(i[4]||"").trim();s&&c&&(r[s]=c)}}if(Object.keys(r).length>0){var l=e.querySelector('a[aria-label*="Instagram"]'),d=e.querySelector('a[aria-label*="Facebook"]');l&&r.instagram&&(l.href=r.instagram),d&&r.facebook&&(d.href=r.facebook)}}}).catch(function(){})}function n(e){for(var t=[],n="",a=!1,r=0;r<e.length;r++){var o=e[r];'"'===o?a=!a:","!==o||a?n+=o:(t.push(n),n="")}return t.push(n),t}}function loadFeaturedProducts(){var e=document.getElementById("promo-section"),t=document.getElementById("promo-news-content"),n=document.getElementById("promo-featured-note"),a=document.getElementById("promo-featured-products");if(e){if(a){var r=document.createElement("div");r.className="promo-loading-skeleton",r.appendChild(createSkeletonCard()),a.innerHTML="",a.appendChild(r)}var o,i,s="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_CSV_URL?SHEETS_CONFIG.PUBLISHED_CSV_URL:null,c="content/products.csv",l="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL?SHEETS_CONFIG.PUBLISHED_HOMEPAGE_CSV_URL:null,d="sv-products-csv",u="sv-products-csv-ts",m="sv-homepage-csv",p="sv-homepage-csv-ts",v=h(d,u),f=h(m,p);if(f?(o=Promise.resolve(f.data),!f.fresh&&l&&fetch(l).then(function(e){return e.ok?e.text():""}).then(function(e){e&&g(m,p,e)})):o=l?fetch(l).then(function(e){return e.ok?e.text():""}).then(function(e){return e&&g(m,p,e),e}):fetch("content/home.json").then(function(e){return e.ok?e.json():{}}).then(function(e){return{isJson:!0,data:e}}),v){if(i=Promise.resolve(v.data),!v.fresh)fetch(s||c).then(function(e){return e.ok?e.text():""}).then(function(e){e&&g(d,u,e)})}else(i=s?fetch(s).then(function(e){return e.ok?e.text():""}).catch(function(){return fetch(c).then(function(e){return e.text()})}):fetch(c).then(function(e){return e.text()})).then(function(e){e&&g(d,u,e)});Promise.all([o,i]).then(function(r){var o,i,s=r[0],c=r[1],l={"promo-news":[],"promo-featured-note":"","promo-featured-skus":[]};if(s&&s.isJson)l=s.data;else if("string"==typeof s&&s.trim()){var d=s.trim().split("\n");if(d.length>1)for(var u=1;u<d.length;u++){var m=E(d[u]),p=(m[0]||"").toLowerCase().trim();if("news"===p)l["promo-news"].push({date:(m[1]||"").trim(),title:(m[2]||"").trim(),text:(m[3]||"").trim()});else if("note"===p)l["promo-featured-note"]=(m[3]||"").trim();else if("featured"===p){var v=(m[4]||"").trim();v&&l["promo-featured-skus"].push(v)}}}t&&l["promo-news"]&&l["promo-news"].length>0&&(o=l["promo-news"],i="",o.forEach(function(e){i+='<div class="promo-news-item">',i+='<span class="promo-news-date">'+C(e.date||"")+"</span>",i+="<h3>"+C(e.title||"")+"</h3>",i+="<p>"+C(e.text||"")+"</p>",i+="</div>"}),t.innerHTML=i),n&&l["promo-featured-note"]&&(n.innerHTML="<p>"+C(l["promo-featured-note"])+"</p>");var f=l["promo-featured-skus"]||[],h=c?function(e){var t=e.trim().split("\n");if(t.length<2)return[];for(var n=t[0].split(",").map(function(e){return e.trim().toLowerCase().replace(/\s+/g,"_")}),a=[],r=1;r<t.length;r++){var o=y(t[r]);if(!(o.length<2)){for(var i={},s=0;s<n.length;s++)i[n[s]]=(o[s]||"").trim();a.push(i)}}return a}(c):[];!function(t,n){var r=[];n&&n.length>0&&n.forEach(function(e){var n=t.find(function(t){return t.sku===e});n&&r.push(n)});0===r.length&&(r=t.filter(function(e){return"TRUE"===(e.featured||"").trim().toUpperCase()||"TRUE"===(e.favorite||"").trim().toUpperCase()}));0===r.length&&(r=t.filter(function(e){return parseFloat(e.discount)>0}).slice(0,3));0===r.length&&(r=t.slice(0,3));if(0===r.length)return void(e.style.display="none");a.innerHTML="";var o=0,i=!1;if(r.forEach(function(e,t){var n=function(e){var t=document.createElement("div");t.className="product-card",e.sku&&t.setAttribute("data-sku",e.sku);var n=document.createElement("div");n.className="product-card-header";var a=document.createElement("p");a.className="product-brand",a.textContent=e.brand||"",n.appendChild(a);var r=document.createElement("h4");r.textContent=e.name||"",n.appendChild(r),t.appendChild(n);var o=(e.batch_size_liters||"").trim();if(e.subcategory||e.time||o){var i=document.createElement("div");i.className="product-detail-row";var s=[];e.subcategory&&s.push(e.subcategory),e.time&&s.push(e.time),o&&s.push(o+"L");for(var c=0;c<s.length;c++){if(c>0){var l=document.createElement("span");l.className="detail-sep",l.textContent="·",i.appendChild(l)}var d=document.createElement("span");d.textContent=s[c],i.appendChild(d)}t.appendChild(i)}if(e.tasting_notes){var u=document.createElement("div");u.className="product-notes";var m=document.createElement("button");m.type="button",m.className="product-notes-toggle",m.setAttribute("aria-expanded","false"),m.innerHTML='More Information <span class="product-notes-chevron">&#9660;</span>';var p=document.createElement("div");if(p.className="product-notes-body",e.sku){var v=document.createElement("div");v.className="product-notes-image";var f=document.createElement("img");f.src="images/products/"+e.sku+".png",f.alt=e.name||"Product image",f.loading="lazy",f.onerror=function(){this.parentElement.remove()},v.appendChild(f),p.appendChild(v)}var h=document.createElement("div");h.className="product-notes-text";var g=document.createElement("p");g.textContent=e.tasting_notes,h.appendChild(g),p.appendChild(h),m.addEventListener("click",(E=u,C=m,function(){var e=E.classList.toggle("open");C.setAttribute("aria-expanded",e?"true":"false")})),u.appendChild(m),u.appendChild(p),t.appendChild(u)}var E,C;var y=parseFloat(e.discount)||0;if(y>0){var S=document.createElement("span");S.className="product-discount-badge",S.textContent=Math.round(y)+"% OFF",t.appendChild(S)}var b="TRUE"===(e.pricing_from||"").trim().toUpperCase(),L=b?"+":"",I=(e.retail_instore||"").trim(),_=(e.retail_kit||"").trim();if(I||_){var N=document.createElement("div");if(N.className="product-prices",I){var x=document.createElement("div");if(x.className="product-price-box",y>0){var k=(parseFloat(I.replace(/[^0-9.]/g,""))*(1-y/100)).toFixed(2);x.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-original">'+I+'</span><span class="product-price-value">$'+k+L+"</span>"}else x.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-value">'+I+L+"</span>";N.appendChild(x)}if(_){var T=document.createElement("div");if(T.className="product-price-box",y>0){var F=(parseFloat(_.replace(/[^0-9.]/g,""))*(1-y/100)).toFixed(2);T.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-original">'+_+'</span><span class="product-price-value">$'+F+L+"</span>"}else T.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-value">'+_+L+"</span>";N.appendChild(T)}t.appendChild(N)}var R=document.createElement("div");R.className="product-reserve-wrap";var O=e.name+"|"+e.brand;return function(e,t,n){var a=document.createElement("button");a.type="button",a.className="product-reserve-btn",a.textContent="Reserve",a.addEventListener("click",function(){isReserved(n)||setReservationQty(t,1),window.location.href="products.html?sku="+encodeURIComponent(t.sku)}),e.appendChild(a)}(R,e,O),t.appendChild(R),t}(e);n.dataset.carouselIndex=t,0===t&&n.classList.add("promo-slide-active"),a.appendChild(n)}),r.length>1){var s=document.getElementById("promo-carousel-nav"),c=document.getElementById("promo-carousel-dots");if(s&&(s.style.display="flex"),c){c.innerHTML="";for(var l=0;l<r.length;l++){var d=document.createElement("button");d.type="button",d.className="promo-carousel-dot"+(0===l?" active":""),d.dataset.index=l,d.setAttribute("aria-label","Go to product "+(l+1)),c.appendChild(d)}}function u(e){if(!i&&e!==o){i=!0;var t=a.querySelectorAll(".product-card"),n=c?c.querySelectorAll(".promo-carousel-dot"):[],r=t[o],s=t[e];r.classList.remove("promo-slide-active"),r.classList.add("promo-slide-exit"),s.classList.add("promo-slide-active"),n.forEach(function(t,n){t.classList.toggle("active",n===e)}),setTimeout(function(){r.classList.remove("promo-slide-exit"),o=e,i=!1},500)}}var m=document.querySelector(".promo-carousel-prev"),p=document.querySelector(".promo-carousel-next");m&&m.addEventListener("click",function(){u((o-1+r.length)%r.length)}),p&&p.addEventListener("click",function(){u((o+1)%r.length)}),c&&c.addEventListener("click",function(e){e.target.classList.contains("promo-carousel-dot")&&u(parseInt(e.target.dataset.index,10))}),setInterval(function(){a.querySelector(".product-notes.open")||u((o+1)%r.length)},12e3)}}(h,f)}).catch(function(){e.style.display="none"})}function h(e,t){try{var n=localStorage.getItem(e),a=parseInt(localStorage.getItem(t),10)||0;if(n)return{data:n,fresh:Date.now()-a<36e5}}catch(e){}return null}function g(e,t,n){try{localStorage.setItem(e,n),localStorage.setItem(t,String(Date.now()))}catch(e){}}function E(e){for(var t=[],n="",a=!1,r=0;r<e.length;r++){var o=e[r];'"'===o?a=!a:","!==o||a?n+=o:(t.push(n),n="")}return t.push(n),t}function C(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function y(e){for(var t=[],n="",a=!1,r=0;r<e.length;r++){var o=e[r];'"'===o?a=!a:","!==o||a?n+=o:(t.push(n),n="")}return t.push(n),t}}function fetchCSV(e){return fetch(e).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status);return e.text()})}function createSkeletonCard(){var e=document.createElement("div");return e.className="skeleton-card",e.innerHTML='<div class="skeleton-element skeleton-brand"></div><div class="skeleton-element skeleton-title"></div><div class="skeleton-element skeleton-detail"></div><div class="skeleton-badges"><div class="skeleton-element skeleton-badge"></div><div class="skeleton-element skeleton-badge"></div></div><div class="skeleton-prices"><div class="skeleton-element skeleton-price-box"></div><div class="skeleton-element skeleton-price-box"></div></div><div class="skeleton-element skeleton-notes"></div>',e}function showCatalogSkeletons(e,t){if(e){var n=document.createElement("div");n.className="catalog-skeleton-grid";for(var a=0;a<t;a++)n.appendChild(createSkeletonCard());e.appendChild(n)}}document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&flushEvents()}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".nav-toggle"),t=document.querySelector(".nav-list");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("open")}),t.querySelectorAll("a").forEach(function(e){e.addEventListener("click",function(){t.classList.remove("open")})}));document.addEventListener("click",function(e){e.target.closest&&e.target.closest(".product-notes-btn")||document.querySelectorAll(".product-notes-tooltip.show").forEach(function(e){e.classList.remove("show")})});var n=document.body.getAttribute("data-page");if(n){var a=fetch("content/shared.json").then(function(e){return e.ok?e.json():{}}).catch(function(){return{}}),r=fetch("content/"+n+".json").then(function(e){return e.ok?e.json():{}}).catch(function(){return{}});Promise.all([a,r]).then(function(e){var t,n=e[0],a=e[1],r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);for(t in a)a.hasOwnProperty(t)&&(r[t]=a[t]);document.querySelectorAll("[data-content]").forEach(function(e){var t=e.getAttribute("data-content");void 0!==r[t]&&(e.textContent=r[t])})}).catch(function(){})}var o=document.querySelector(".site-header");if(o){var i=function(){document.documentElement.style.setProperty("--header-height",o.offsetHeight+"px")};i(),window.addEventListener("resize",i)}"products"===n&&(loadProducts(),initReservationBar(),initProductTabs()),"reservation"===n&&initReservationPage(),"about"!==n&&"contact"!==n||loadOpenHours(),"about"===n&&loadFAQ(),"home"===n&&(loadFeaturedProducts(),initReservationBar(),setupBeerWaitlistForm()),loadFooterHours(),loadSocialLinks()});var applyKitsFilters=null;function loadProducts(){var e=[],t=!1,n={type:[],brand:[],subcategory:[],time:[]},a=!1,r="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_CSV_URL?SHEETS_CONFIG.PUBLISHED_CSV_URL:null,o="sv-products-csv",i="sv-products-csv-ts";function s(e){try{localStorage.setItem(o,e),localStorage.setItem(i,String(Date.now()))}catch(e){}}var c,l=function(){try{var e=localStorage.getItem(o),t=parseInt(localStorage.getItem(i),10)||0;if(e)return{csv:e,fresh:Date.now()-t<36e5}}catch(e){}return null}(),d=document.getElementById("product-catalog");(!l&&d&&showCatalogSkeletons(d,6),l)?(c=Promise.resolve(l.csv),l.fresh||fetchCSV(r||"content/products.csv").then(s).catch(function(){})):(c=r?fetchCSV(r).catch(function(){return fetchCSV("content/products.csv")}):fetchCSV("content/products.csv")).then(s);function u(t,n,a){var r=document.getElementById(t);if(r){var o=document.createElement("span");o.className="catalog-filter-label",o.textContent=a,r.appendChild(o);var i=[];if(e.forEach(function(e){var t=e[n]||"";t&&-1===i.indexOf(t)&&i.push(t)}),"time"===n)i.sort(function(e,t){return(parseFloat(e)||0)-(parseFloat(t)||0)});else if("subcategory"===n){var s=["red","white","rosé","rose","fruit","specialty"];i.sort(function(e,t){var n=s.indexOf(e.toLowerCase()),a=s.indexOf(t.toLowerCase());return-1===n&&(n=s.length),-1===a&&(a=s.length),n-a})}else i.sort();var c=m("All",t,n);c.classList.add("active"),r.appendChild(c),i.forEach(function(e){r.appendChild(m(e,t,n))})}}function m(t,a,r){var o=document.createElement("button");return o.className="catalog-filter-btn",o.type="button",o.textContent=t,o.setAttribute("data-field",r),o.setAttribute("data-value",t),o.addEventListener("click",function(){if("All"===t)n[r]=[];else{var o=n[r].indexOf(t);-1!==o?n[r].splice(o,1):n[r].push(t)}var i=document.getElementById(a),s=i.querySelectorAll(".catalog-filter-btn");s.forEach(function(e){e.classList.remove("active")}),0===n[r].length?i.querySelector('[data-value="All"]').classList.add("active"):s.forEach(function(e){-1!==n[r].indexOf(e.getAttribute("data-value"))&&e.classList.add("active")}),f(),["type","brand","subcategory","time"].forEach(function(t){var a="filter-"+("subcategory"===t?"subcategory":t),r=document.getElementById(a);r&&r.querySelectorAll(".catalog-filter-btn").forEach(function(a){var r=a.getAttribute("data-value");if("All"!==r){var o=e.some(function(e){return e[t]===r&&function(e,t){for(var a=["type","brand","subcategory","time"],r=0;r<a.length;r++){var o=a[r];if(o!==t&&n[o].length>0&&-1===n[o].indexOf(e[o]))return!1}return!0}(e,t)});if(o)a.classList.remove("disabled"),a.disabled=!1;else{a.classList.add("disabled"),a.disabled=!0,a.classList.remove("active");var i=n[t].indexOf(r);-1!==i&&n[t].splice(i,1)}}})})}),o}function p(e){var t=e.retail_instore||e.retail_kit||"0";return parseFloat(t.replace("$",""))||0}function v(e){var t=(e||"").match(/(\d+)/);return t?parseInt(t[1],10):0}function f(){var r=document.getElementById("catalog-search"),o=r?r.value.toLowerCase():"",i=e.filter(function(e){if(n.type.length>0&&-1===n.type.indexOf(e.type))return!1;if(n.brand.length>0&&-1===n.brand.indexOf(e.brand))return!1;if(n.subcategory.length>0&&-1===n.subcategory.indexOf(e.subcategory))return!1;if(n.time.length>0&&-1===n.time.indexOf(e.time))return!1;if(a&&!(parseFloat(e.discount)>0))return!1;if(!o)return!0;var t=(e.name||"").toLowerCase(),r=(e.subcategory||"").toLowerCase(),i=(e.tasting_notes||"").toLowerCase(),s=(e.brand||"").toLowerCase();return-1!==t.indexOf(o)||-1!==r.indexOf(o)||-1!==i.indexOf(o)||-1!==s.indexOf(o)}),s=document.getElementById("catalog-sort"),c=s?s.value:"name-asc";i.sort(function(e,n){if(!t){var a="true"===(e.favorite||"").toLowerCase()?0:1,r="true"===(n.favorite||"").toLowerCase()?0:1;if(a!==r)return a-r;if(0===a&&0===r)return(e._favRand||0)-(n._favRand||0)}switch(c){case"name-asc":return(e.name||"").localeCompare(n.name||"");case"name-desc":return(n.name||"").localeCompare(e.name||"");case"price-asc":return p(e)-p(n);case"price-desc":return p(n)-p(e);case"time-asc":return v(e.time)-v(n.time);case"time-desc":return v(n.time)-v(e.time);default:return 0}}),function(e){var t=document.getElementById("product-catalog");if(!t)return;var n=t.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid");if(n.forEach(function(e){e.parentNode.removeChild(e)}),0===e.length){var a=document.createElement("p");return a.className="catalog-no-results",a.textContent="No products found.",void t.appendChild(a)}function r(e){return void 0!==e.available&&""!==e.available?parseInt(e.available,10)||0:parseInt(e.stock,10)||0}var o=e.filter(function(e){return r(e)>0}),i=e.filter(function(e){return r(e)<=0});if(h(t,"Currently available",o),o.length>0&&i.length>0){var s=document.createElement("div");s.className="section-icon catalog-divider";var c=document.createElement("img");c.src="images/Icon_green.svg",c.alt="",c.setAttribute("aria-hidden","true"),s.appendChild(c),t.appendChild(s)}h(t,"Available to order",i,"catalog-section--order")}(i)}function h(e,t,n,a){if(0!==n.length){var r=document.createElement("div");r.className="catalog-section"+(a?" "+a:"");var o=document.createElement("div");o.className="catalog-section-header";var i=document.createElement("h2");if(i.className="catalog-section-title",i.textContent=t,o.appendChild(i),"catalog-section--order"===a){var s=document.createElement("p");s.className="process-note",s.textContent="Allow up to 2 weeks for items to be ordered in.",o.appendChild(s)}r.appendChild(o);var c={},l=[];n.forEach(function(e){c[e.type]||(c[e.type]=[],l.push(e.type)),c[e.type].push(e)}),l.forEach(function(e){var t=document.createElement("div");t.className="product-group";var n=document.createElement("h3");n.className="product-group-title",n.textContent=e,t.appendChild(n);var a=document.createElement("div");a.className="product-grid",c[e].forEach(function(e){var t=document.createElement("div");t.className="product-card",e.sku&&t.setAttribute("data-sku",e.sku);var n=document.createElement("div");n.className="product-card-header";var r=document.createElement("p");r.className="product-brand",r.textContent=e.brand,n.appendChild(r);var o=document.createElement("h4");o.textContent=e.name,n.appendChild(o),t.appendChild(n);var i,s,c,l=(e.batch_size_liters||"").trim();if(e.subcategory||e.time||l){var d=document.createElement("div");d.className="product-detail-row";var u=[];e.subcategory&&u.push(e.subcategory),e.time&&u.push(e.time),l&&u.push(l+"L");for(var m=0;m<u.length;m++){if(m>0){var p=document.createElement("span");p.className="detail-sep",p.textContent="·",d.appendChild(p)}var v=document.createElement("span");v.textContent=u[m],d.appendChild(v)}t.appendChild(d)}if(e.tasting_notes){var f=document.createElement("div");f.className="product-notes";var h=document.createElement("button");h.type="button",h.className="product-notes-toggle",h.setAttribute("aria-expanded","false"),h.innerHTML='More Information <span class="product-notes-chevron">&#9660;</span>';var g=document.createElement("div");if(g.className="product-notes-body",e.sku){var E=document.createElement("div");E.className="product-notes-image";var C=document.createElement("img");C.src="images/products/"+e.sku+".png",C.alt=e.name||"Product image",C.loading="lazy",C.onerror=function(){this.parentElement.remove()},E.appendChild(C),g.appendChild(E)}var y=document.createElement("div");y.className="product-notes-text";var S=document.createElement("p");S.textContent=e.tasting_notes,y.appendChild(S),g.appendChild(y),h.addEventListener("click",(i=f,s=h,c=e,function(){var e=i.classList.toggle("open");s.setAttribute("aria-expanded",e?"true":"false"),e&&trackEvent("detail",c.sku||"",c.name||"")})),f.appendChild(h),f.appendChild(g),t.appendChild(f)}var b=parseFloat(e.discount)||0;if(b>0){var L=document.createElement("span");L.className="product-discount-badge",L.textContent=Math.round(b)+"% OFF",t.appendChild(L)}var I="TRUE"===(e.pricing_from||"").trim().toUpperCase()?"+":"",_=(e.retail_instore||"").trim(),N=(e.retail_kit||"").trim();if(_||N){var x=document.createElement("div");if(x.className="product-prices",_){var k=document.createElement("div");if(k.className="product-price-box",b>0){var T=(parseFloat(_.replace(/[^0-9.]/g,""))*(1-b/100)).toFixed(2);k.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-original">'+_+'</span><span class="product-price-value">$'+T+I+"</span>"}else k.innerHTML='<span class="product-price-label">Ferment in store</span><span class="product-price-value">'+_+I+"</span>";x.appendChild(k)}if(N){var F=document.createElement("div");if(F.className="product-price-box",b>0){var R=(parseFloat(N.replace(/[^0-9.]/g,""))*(1-b/100)).toFixed(2);F.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-original">'+N+'</span><span class="product-price-value">$'+R+I+"</span>"}else F.innerHTML='<span class="product-price-label">Kit only</span><span class="product-price-value">'+N+I+"</span>";x.appendChild(F)}t.appendChild(x)}var O=document.createElement("div");O.className="product-reserve-wrap",renderReserveControl(O,e,e.name+"|"+e.brand),t.appendChild(O),a.appendChild(t)}),t.appendChild(a),r.appendChild(t)}),e.appendChild(r)}}c.then(function(n){for(var r=n.trim().split("\n"),o=r[0].split(","),i=1;i<r.length;i++){var s=parseCSVLine(r[i]);if(!(s.length<o.length)){for(var c={},l=0;l<o.length;l++)c[o[l].trim()]=s[l].trim();(c.name||c.sku)&&(c.hide&&"true"===c.hide.toLowerCase()||("true"===(c.favorite||"").toLowerCase()&&(c._favRand=Math.random()),e.push(c)))}}u("filter-type","type","Type:"),u("filter-brand","brand","Brand:"),u("filter-subcategory","subcategory","Style:"),u("filter-time","time","Brew Time:"),function(){var t=e.some(function(e){return parseFloat(e.discount)>0}),n=document.getElementById("filter-sale");if(!n||!t)return void(n&&(n.style.display="none"));var r=document.createElement("span");r.className="catalog-filter-label",r.textContent="Sale:",n.appendChild(r);var o=document.createElement("button");o.className="catalog-filter-btn",o.type="button",o.textContent="On Sale",o.addEventListener("click",function(){a=!a,o.classList.toggle("active",a),f()}),n.appendChild(o)}(),f();var d=new URLSearchParams(window.location.search).get("sku");if(d){var m=0;setTimeout(function e(){var t=document.querySelector('.product-card[data-sku="'+d+'"]');t?(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight"),setTimeout(function(){t.classList.remove("highlight")},2e3)):m<10&&(m++,setTimeout(e,100))},50)}applyKitsFilters=f;var p,v=document.getElementById("catalog-search");v&&v.addEventListener("input",function(){clearTimeout(p),p=setTimeout(f,180)});var h=document.getElementById("catalog-sort");h&&h.addEventListener("change",function(){t=!0,f()});var g=document.getElementById("catalog-toggle"),E=document.getElementById("catalog-collapsible");g&&E&&g.addEventListener("click",function(){var e="true"===g.getAttribute("aria-expanded");g.setAttribute("aria-expanded",String(!e)),E.classList.toggle("open")})}).catch(function(){})}function initProductTabs(){var e=document.getElementById("product-tabs");if(e){var t=!1,n=!1;e.addEventListener("click",function(a){var r=a.target.closest(".product-tab-btn");if(r){var o=r.getAttribute("data-product-tab");e.querySelectorAll(".product-tab-btn").forEach(function(e){e.classList.remove("active")}),r.classList.add("active");["catalog-controls-kits","catalog-controls-ingredients","catalog-controls-services"].forEach(function(e){var t=document.getElementById(e);t&&t.classList.add("hidden")});var i=document.getElementById("catalog-controls-"+o);i&&i.classList.remove("hidden");var s=document.getElementById("kits-process-note");s&&(s.style.display="kits"===o?"":"none"),document.querySelectorAll(".reservation-bar").forEach(function(e){"kits"===o?updateReservationBar():e.classList.add("hidden")});var c=document.getElementById("product-catalog");if(c)c.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid").forEach(function(e){e.parentNode.removeChild(e)});"kits"===o?applyKitsFilters&&applyKitsFilters():"ingredients"===o?t?renderIngredients():(t=!0,loadIngredients(function(){})):"services"===o&&(n?renderServices():(n=!0,loadServices(function(){})))}});var a=document.getElementById("ingredient-toggle"),r=document.getElementById("ingredient-collapsible");a&&r&&a.addEventListener("click",function(){var e="true"===a.getAttribute("aria-expanded");a.setAttribute("aria-expanded",String(!e)),r.classList.toggle("open")})}}var _allIngredients=[],_ingredientFilters={unit:[]};function loadIngredients(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_INGREDIENTS_CSV_URL?SHEETS_CONFIG.PUBLISHED_INGREDIENTS_CSV_URL:null,n="sv-ingredients-csv",a="sv-ingredients-csv-ts";function r(e){try{localStorage.setItem(n,e),localStorage.setItem(a,String(Date.now()))}catch(e){}}var o,i=function(){try{var e=localStorage.getItem(n),t=parseInt(localStorage.getItem(a),10)||0;if(e)return{csv:e,fresh:Date.now()-t<36e5}}catch(e){}return null}();i?(o=Promise.resolve(i.csv),i.fresh||fetchCSV(t||"content/ingredients.csv").then(r).catch(function(){})):(o=t?fetchCSV(t).catch(function(){return fetchCSV("content/ingredients.csv")}):fetchCSV("content/ingredients.csv")).then(r);o.then(function(t){var n=t.trim().split("\n"),a=n[0].split(",");_allIngredients=[];for(var r=1;r<n.length;r++){var o=parseCSVLine(n[r]);if(!(o.length<a.length)){for(var i={},s=0;s<a.length;s++)i[a[s].trim()]=o[s].trim();(i.name||i.sku)&&(i.hide&&"true"===i.hide.toLowerCase()||_allIngredients.push(i))}}buildIngredientFilters(),renderIngredients(),wireIngredientEvents(),e&&e()}).catch(function(){})}function buildIngredientFilters(){var e=document.getElementById("filter-unit");if(e&&!(e.children.length>0)){var t=document.createElement("span");t.className="catalog-filter-label",t.textContent="Unit:",e.appendChild(t);var n=[];_allIngredients.forEach(function(e){var t=(e.unit||"").trim();t&&-1===n.indexOf(t)&&n.push(t)}),n.sort();var a=document.createElement("button");a.className="catalog-filter-btn active",a.type="button",a.textContent="All",a.setAttribute("data-value","All"),a.addEventListener("click",function(){_ingredientFilters.unit=[],e.querySelectorAll(".catalog-filter-btn").forEach(function(e){e.classList.remove("active")}),a.classList.add("active"),renderIngredients()}),e.appendChild(a),n.forEach(function(t){var n=document.createElement("button");n.className="catalog-filter-btn",n.type="button",n.textContent=t,n.setAttribute("data-value",t),n.addEventListener("click",function(){var n=_ingredientFilters.unit.indexOf(t);-1!==n?_ingredientFilters.unit.splice(n,1):_ingredientFilters.unit.push(t);var a=e.querySelectorAll(".catalog-filter-btn");a.forEach(function(e){e.classList.remove("active")}),0===_ingredientFilters.unit.length?e.querySelector('[data-value="All"]').classList.add("active"):a.forEach(function(e){-1!==_ingredientFilters.unit.indexOf(e.getAttribute("data-value"))&&e.classList.add("active")}),renderIngredients()}),e.appendChild(n)})}}function wireIngredientEvents(){var e,t=document.getElementById("ingredient-search");t&&t.addEventListener("input",function(){clearTimeout(e),e=setTimeout(renderIngredients,180)});var n=document.getElementById("ingredient-sort");n&&n.addEventListener("change",function(){renderIngredients()})}function renderIngredients(){var e=document.getElementById("product-catalog");if(e){e.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid").forEach(function(e){e.parentNode.removeChild(e)});var t=document.getElementById("ingredient-search"),n=t?t.value.toLowerCase():"",a=_allIngredients.filter(function(e){if(_ingredientFilters.unit.length>0&&-1===_ingredientFilters.unit.indexOf(e.unit))return!1;if(!n)return!0;var t=(e.name||"").toLowerCase(),a=(e.description||"").toLowerCase();return-1!==t.indexOf(n)||-1!==a.indexOf(n)}),r=document.getElementById("ingredient-sort"),o=r?r.value:"name-asc";if(a.sort(function(e,t){switch(o){case"name-asc":return(e.name||"").localeCompare(t.name||"");case"name-desc":return(t.name||"").localeCompare(e.name||"");case"price-asc":return(parseFloat(e.price_per_unit)||0)-(parseFloat(t.price_per_unit)||0);case"price-desc":return(parseFloat(t.price_per_unit)||0)-(parseFloat(e.price_per_unit)||0);default:return 0}}),0===a.length){var i=document.createElement("p");return i.className="catalog-no-results",i.textContent="No ingredients or supplies found.",void e.appendChild(i)}var s=a.filter(function(e){return(parseInt(e.stock,10)||0)>0}),c=a.filter(function(e){return(parseInt(e.stock,10)||0)<=0});if(renderIngredientSection(e,"In stock",s),s.length>0&&c.length>0){var l=document.createElement("div");l.className="section-icon catalog-divider";var d=document.createElement("img");d.src="images/Icon_green.svg",d.alt="",d.setAttribute("aria-hidden","true"),l.appendChild(d),e.appendChild(l)}renderIngredientSection(e,"Out of stock",c,"catalog-section--order")}}function renderIngredientSection(e,t,n,a){if(0!==n.length){var r=document.createElement("div");r.className="catalog-section"+(a?" "+a:"");var o=document.createElement("div");o.className="catalog-section-header";var i=document.createElement("h2");i.className="catalog-section-title",i.textContent=t,o.appendChild(i),r.appendChild(o);var s=document.createElement("div");s.className="product-grid",n.forEach(function(e){var t=document.createElement("div");t.className="product-card";var n=document.createElement("div");n.className="product-card-header";var a=document.createElement("h4");a.textContent=e.name,n.appendChild(a),t.appendChild(n);var r,o,i=(e.unit||"").trim(),c=(e.price_per_unit||"").trim();if(i||c){var l=document.createElement("div");l.className="product-detail-row";var d=[];i&&d.push(i),c&&d.push("$"===c.charAt(0)?c:"$"+c);for(var u=0;u<d.length;u++){if(u>0){var m=document.createElement("span");m.className="detail-sep",m.textContent="·",l.appendChild(m)}var p=document.createElement("span");p.textContent=d[u],l.appendChild(p)}t.appendChild(l)}if(e.description){var v=document.createElement("div");v.className="product-notes";var f=document.createElement("button");f.type="button",f.className="product-notes-toggle",f.setAttribute("aria-expanded","false"),f.innerHTML='More Information <span class="product-notes-chevron">&#9660;</span>';var h=document.createElement("div");h.className="product-notes-body";var g=document.createElement("p");g.textContent=e.description,h.appendChild(g),f.addEventListener("click",(r=v,o=f,function(){var e=r.classList.toggle("open");o.setAttribute("aria-expanded",e?"true":"false")})),v.appendChild(f),v.appendChild(h),t.appendChild(v)}var E=parseInt(e.stock,10)||0,C=document.createElement("span");C.className="stock-badge",E>0?(C.classList.add("stock-badge--in"),C.textContent="In Stock"):(C.classList.add("stock-badge--out"),C.textContent="Out of Stock"),t.appendChild(C),s.appendChild(t)}),r.appendChild(s),e.appendChild(r)}}var _allServices=[];function loadServices(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SERVICES_CSV_URL?SHEETS_CONFIG.PUBLISHED_SERVICES_CSV_URL:null,n="sv-services-csv",a="sv-services-csv-ts";function r(e){try{localStorage.setItem(n,e),localStorage.setItem(a,String(Date.now()))}catch(e){}}var o,i=function(){try{var e=localStorage.getItem(n),t=parseInt(localStorage.getItem(a),10)||0;if(e)return{csv:e,fresh:Date.now()-t<36e5}}catch(e){}return null}();i?(o=Promise.resolve(i.csv),i.fresh||fetchCSV(t||"content/services.csv").then(r).catch(function(){})):(o=t?fetchCSV(t).catch(function(){return fetchCSV("content/services.csv")}):fetchCSV("content/services.csv")).then(r);o.then(function(t){var n=t.trim().split("\n"),a=n[0].split(",");_allServices=[];for(var r=1;r<n.length;r++){var o=parseCSVLine(n[r]);if(!(o.length<a.length)){for(var i={},s=0;s<a.length;s++)i[a[s].trim()]=o[s].trim();(i.name||i.sku)&&(i.hide&&"true"===i.hide.toLowerCase()||_allServices.push(i))}}renderServices(),wireServiceEvents(),e&&e()}).catch(function(){})}function wireServiceEvents(){var e,t=document.getElementById("service-search");t&&t.addEventListener("input",function(){clearTimeout(e),e=setTimeout(renderServices,180)})}function renderServices(){var e=document.getElementById("product-catalog");if(e){e.querySelectorAll(".catalog-section, .catalog-no-results, .catalog-divider, .catalog-skeleton-grid").forEach(function(e){e.parentNode.removeChild(e)});var t=document.getElementById("service-search"),n=t?t.value.toLowerCase():"",a=_allServices.filter(function(e){if(!n)return!0;var t=(e.name||"").toLowerCase(),a=(e.desription||e.description||"").toLowerCase();return-1!==t.indexOf(n)||-1!==a.indexOf(n)});if(0===a.length){var r=document.createElement("p");return r.className="catalog-no-results",r.textContent="No services found.",void e.appendChild(r)}var o=document.createElement("div");o.className="catalog-section";var i=document.createElement("div");i.className="catalog-section-header";var s=document.createElement("h2");s.className="catalog-section-title",s.textContent="Our Services",i.appendChild(s),o.appendChild(i);var c=document.createElement("div");c.className="product-grid",a.forEach(function(e){var t=document.createElement("div");t.className="product-card";var n=document.createElement("div");n.className="product-card-header";var a=document.createElement("h4");a.textContent=e.name,n.appendChild(a),t.appendChild(n);var r=(e.desription||e.description||"").trim();if(r){var o=document.createElement("p");o.className="service-description",o.textContent=r,t.appendChild(o)}var i=(e.price||"").trim(),s=parseFloat(e.discount)||0;if(s>0){var l=document.createElement("span");l.className="product-discount-badge",l.textContent=Math.round(s)+"% OFF",t.appendChild(l)}if(i){var d=document.createElement("div");d.className="product-prices service-price";var u=document.createElement("div");if(u.className="product-price-box",s>0){var m=(parseFloat(i.replace(/[^0-9.]/g,""))*(1-s/100)).toFixed(2);u.innerHTML='<span class="product-price-label">Price</span><span class="product-price-original">'+("$"===i.charAt(0)?i:"$"+i)+'</span><span class="product-price-value">$'+m+"</span>"}else u.innerHTML='<span class="product-price-label">Price</span><span class="product-price-value">'+("$"===i.charAt(0)?i:"$"+i)+"</span>";d.appendChild(u),t.appendChild(d)}c.appendChild(t)}),o.appendChild(c),e.appendChild(o)}}function parseCSVLine(e){for(var t=[],n="",a=!1,r=0;r<e.length;r++){var o=e[r];a?'"'===o?r+1<e.length&&'"'===e[r+1]?(n+='"',r++):a=!1:n+=o:'"'===o?a=!0:","===o?(t.push(n),n=""):n+=o}return t.push(n),t}var RESERVATION_KEY="sv-reservation";function getReservation(){try{return JSON.parse(localStorage.getItem(RESERVATION_KEY))||[]}catch(e){return[]}}function saveReservation(e){localStorage.setItem(RESERVATION_KEY,JSON.stringify(e))}function getReservedQty(e){for(var t=getReservation(),n=0;n<t.length;n++)if(t[n].name+"|"+t[n].brand===e)return t[n].qty||1;return 0}function isReserved(e){return getReservedQty(e)>0}function setReservationQty(e,t){for(var n=getReservation(),a=e.name+"|"+e.brand,r=-1,o=0;o<n.length;o++)if(n[o].name+"|"+n[o].brand===a){r=o;break}if(t<=0)-1!==r&&n.splice(r,1);else if(-1!==r)n[r].qty=t;else{var i=void 0!==e.available&&""!==e.available?parseInt(e.available,10)||0:parseInt(e.stock,10)||0;n.push({name:e.name,brand:e.brand,price:e.retail_instore||e.retail_kit||"",discount:e.discount||"",stock:i,time:e.time||"",qty:t})}saveReservation(n),updateReservationBar()}function renderReserveControl(e,t,n){e.innerHTML="";var a=getReservedQty(n);if(0===a){var r=document.createElement("button");r.type="button",r.className="product-reserve-btn",r.textContent="Reserve",r.addEventListener("click",function(){setReservationQty(t,1),trackEvent("reserve",t.sku||"",t.name||""),renderReserveControl(e,t,n)}),e.appendChild(r)}else{var o=document.createElement("div");o.className="product-qty-controls";var i=document.createElement("button");i.type="button",i.className="qty-btn",i.textContent="−",i.addEventListener("click",function(){setReservationQty(t,a-1),renderReserveControl(e,t,n)});var s=document.createElement("span");s.className="qty-value",s.textContent=a;var c=document.createElement("button");c.type="button",c.className="qty-btn",c.textContent="+",c.addEventListener("click",function(){setReservationQty(t,a+1),renderReserveControl(e,t,n)}),o.appendChild(i),o.appendChild(s),o.appendChild(c),e.appendChild(o)}}function initReservationBar(){var e='<div class="container"><span class="reservation-bar-count"></span><a href="reservation.html" class="reservation-bar-link">Confirm Reservation &rarr;</a></div>',t=document.createElement("div");t.className="reservation-bar hidden",t.id="reservation-bar",t.innerHTML=e,document.body.appendChild(t);var n=document.getElementById("product-catalog");if(n){var a=document.createElement("div");a.className="reservation-bar reservation-bar-inline hidden",a.id="reservation-bar-inline",a.innerHTML=e,n.parentNode.insertBefore(a,n)}updateReservationBar()}function updateReservationBar(){var e=document.querySelectorAll(".reservation-bar");if(0!==e.length){var t=getReservation(),n=0;t.forEach(function(e){n+=e.qty||1});for(var a=n+(1===n?" kit selected":" kits selected"),r=0;r<e.length;r++){var o=e[r].querySelector(".reservation-bar-count");n>0?(e[r].classList.remove("hidden"),o&&(o.textContent=a)):e[r].classList.add("hidden")}}}function initReservationPage(){renderReservationItems(),loadTimeslots(),setupReservationForm()}function refreshReservationDependents(){loadTimeslots();var e=document.querySelector('input[name="timeslot"]:checked');if(e)updateCompletionEstimate(e.value);else{var t=document.getElementById("completion-estimate");t&&(t.style.display="none")}}function renderReservationItems(){var e=document.getElementById("reservation-items"),t=document.getElementById("reservation-empty");if(e){var n=getReservation();if(e.innerHTML="",0!==n.length){t&&(t.style.display="none"),n.forEach(function(t){var n=document.createElement("div");n.className="reservation-item";var a=document.createElement("div");a.className="reservation-item-info";var r=document.createElement("span");r.className="reservation-item-name",r.textContent=t.name,a.appendChild(r);var o=document.createElement("span");if(o.className="reservation-item-brand",o.textContent=t.brand,a.appendChild(o),t.time){var i=document.createElement("span");i.className="reservation-item-time",i.textContent=t.time,a.appendChild(i)}if(t.price){var s=document.createElement("span");s.className="reservation-item-price";var c=t.price;if(t.discount&&parseFloat(t.discount)>0)c="$"+((parseFloat((t.price||"0").replace("$",""))||0)*(1-parseFloat(t.discount)/100)).toFixed(2);s.textContent=c,a.appendChild(s)}if(t.discount&&parseFloat(t.discount)>0){var l=document.createElement("span");l.className="reservation-item-discount",l.textContent=Math.round(parseFloat(t.discount))+"% OFF",a.appendChild(l)}var d=parseInt(t.stock,10)||0,u=document.createElement("span");u.className="reservation-item-stock",d>0?(u.classList.add("reservation-item-stock--available"),u.textContent="In Stock"):(u.classList.add("reservation-item-stock--order"),u.textContent="Needs Ordering"),a.appendChild(u),n.appendChild(a);var m=document.createElement("div");m.className="reservation-item-actions";var p=document.createElement("div");p.className="product-qty-controls";var v,f=document.createElement("button");f.type="button",f.className="qty-btn",f.textContent="−",f.addEventListener("click",(v=t,function(){for(var e=getReservation(),t=0;t<e.length;t++)if(e[t].name+"|"+e[t].brand==v.name+"|"+v.brand){e[t].qty=(e[t].qty||1)-1,e[t].qty<=0&&e.splice(t,1);break}saveReservation(e),renderReservationItems(),refreshReservationDependents()}));var h=document.createElement("span");h.className="qty-value",h.textContent=t.qty||1;var g=document.createElement("button");g.type="button",g.className="qty-btn",g.textContent="+",g.addEventListener("click",function(e){return function(){for(var t=getReservation(),n=0;n<t.length;n++)if(t[n].name+"|"+t[n].brand==e.name+"|"+e.brand){t[n].qty=(t[n].qty||1)+1;break}saveReservation(t),renderReservationItems(),refreshReservationDependents()}}(t)),p.appendChild(f),p.appendChild(h),p.appendChild(g),m.appendChild(p);var E=document.createElement("button");E.type="button",E.className="reservation-item-remove",E.textContent="Remove",E.addEventListener("click",function(){saveReservation(getReservation().filter(function(e){return e.name+"|"+e.brand!=t.name+"|"+t.brand})),renderReservationItems(),refreshReservationDependents()}),m.appendChild(E),n.appendChild(m),e.appendChild(n)});var a=0;n.forEach(function(e){var t=parseFloat((e.price||"0").replace("$",""))||0,n=parseFloat(e.discount)||0;n>0&&(t*=1-n/100),a+=t*(e.qty||1)});var r=document.createElement("div");r.className="reservation-subtotal",r.innerHTML='<span>Estimated Subtotal <span class="reservation-disclaimer">— Final pricing may vary.</span></span><span>$'+a.toFixed(2)+"</span>",e.appendChild(r);var o=document.createElement("div");o.className="reservation-clear-wrap";var i=document.createElement("button");i.type="button",i.className="btn-secondary reservation-clear-btn",i.textContent="Clear Selected Items",i.addEventListener("click",function(){saveReservation([]),renderReservationItems(),refreshReservationDependents()}),o.appendChild(i),e.appendChild(o)}else t&&(t.style.display="")}}function loadTimeslots(){var e=document.getElementById("timeslot-groups");if(e){var t="undefined"!=typeof SHEETS_CONFIG&&SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL?SHEETS_CONFIG.PUBLISHED_SCHEDULE_CSV_URL:"content/timeslots.csv";fetch(t).then(function(e){return e.text()}).then(function(t){var n=t.trim().split("\n");if(!(n.length<2)){for(var a=n[0].split(","),r=[],o=1;o<n.length;o++){var i=n[o].split(",");if(!(i.length<3)){for(var s={},c=0;c<a.length;c++)s[a[c].trim()]=i[c].trim();r.push(s)}}r=r.filter(function(e){return!e.status||"available"===e.status});var l=getReservation().some(function(e){return 0===(e.stock||0)}),d=null;l&&((d=new Date).setDate(d.getDate()+14),d.setHours(0,0,0,0));var u={};r.forEach(function(e){u[e.date]||(u[e.date]=[]),u[e.date].push(e)});var m=Object.keys(u).sort();if(0!==m.length){new Date(m[0]+"T00:00:00"),new Date(m[m.length-1]+"T00:00:00");var p=[];m.forEach(function(e){var t=e.substring(0,7);-1===p.indexOf(t)&&p.push(t)}),p.sort();for(var v=(new Date).getFullYear()+"-"+String((new Date).getMonth()+1).padStart(2,"0"),f=0,h=0;h<p.length;h++){if(p[h]>=v){f=h;break}f=h}if(e.innerHTML="",l){var g=document.createElement("p");g.className="timeslot-notice",g.textContent="Some of your selected items need to be ordered in. Timeslots within the next 2 weeks are not available.",e.appendChild(g)}var E=document.createElement("div");E.className="cal",e.appendChild(E);var C=document.createElement("div");C.className="cal-slots",e.appendChild(C);var y=null,S=0;!function e(){E.innerHTML="";var t=p[f],n=parseInt(t.substring(0,4),10),a=parseInt(t.substring(5,7),10)-1,r=document.createElement("div");r.className="cal-header";var o=document.createElement("button");o.type="button",o.className="cal-nav",o.textContent="‹",o.disabled=0===f,o.addEventListener("click",function(){f>0&&(f--,e())});var i=document.createElement("span");i.className="cal-title",i.textContent=["January","February","March","April","May","June","July","August","September","October","November","December"][a]+" "+n;var s=document.createElement("button");s.type="button",s.className="cal-nav",s.textContent="›",s.disabled=f===p.length-1,s.addEventListener("click",function(){f<p.length-1&&(f++,e())}),r.appendChild(o),r.appendChild(i),r.appendChild(s),E.appendChild(r);var c=document.createElement("div");c.className="cal-grid",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(function(e){var t=document.createElement("div");t.className="cal-dow",t.textContent=e,c.appendChild(t)});var l=new Date(n,a,1).getDay(),m=new Date(n,a+1,0).getDate(),v=new Date;v.setHours(0,0,0,0);for(var h=v.getFullYear()+"-"+String(v.getMonth()+1).padStart(2,"0")+"-"+String(v.getDate()).padStart(2,"0"),g=0;g<l;g++){var C=document.createElement("div");C.className="cal-day cal-day--disabled",c.appendChild(C)}for(var S=1;S<=m;S++){var L=n+"-"+String(a+1).padStart(2,"0")+"-"+String(S).padStart(2,"0"),I=document.createElement("button");I.type="button",I.className="cal-day",I.textContent=S,I.setAttribute("data-date",L);var _=new Date(L+"T00:00:00"),N=_<v,x=!!u[L],k=x&&u[L].some(function(e){return"available"===e.status}),T=d&&_<d;if(L===h&&I.classList.add("cal-day--today"),L===y&&I.classList.add("cal-day--selected"),N||!x||T){if(I.classList.add("cal-day--disabled"),I.disabled=!0,!N&&!x&&!T){I.classList.add("cal-day--closed");var F=document.createElement("span");F.className="cal-day-closed",F.textContent="Closed",I.appendChild(F)}}else k?I.classList.add("cal-day--available"):I.classList.add("cal-day--full");(function(t){I.addEventListener("click",function(){y=t,e(),b(t)})})(L),c.appendChild(I)}E.appendChild(c)}(),e.addEventListener("change",function(e){"timeslot"===e.target.name&&updateCompletionEstimate(e.target.value)})}}function b(e){C.innerHTML="";var t=u[e];if(t){var n=new Date(e+"T00:00:00"),a=document.createElement("h3");a.className="cal-slots-heading",a.textContent=n.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),C.appendChild(a);var r=document.createElement("div");r.className="cal-slots-grid",t.forEach(function(t){var n=document.createElement("div");n.className="timeslot-option";var a="booked"===t.status;a&&n.classList.add("booked");var o="timeslot-"+S;S++;var i=document.createElement("input");i.type="radio",i.name="timeslot",i.id=o,i.value=e+" "+t.time,a&&(i.disabled=!0);var s=document.createElement("label");s.setAttribute("for",o),s.textContent=t.time,n.appendChild(i),n.appendChild(s),r.appendChild(n)}),C.appendChild(r)}}}).catch(function(){e.innerHTML="<p>Unable to load timeslots.</p>"})}}function updateCompletionEstimate(e){var t=document.getElementById("completion-estimate"),n=document.getElementById("completion-estimate-text");if(t&&n){var a=getReservation();if(0!==a.length){var r=0;if(a.forEach(function(e){var t=parseInt(e.time,10);!isNaN(t)&&t>r&&(r=t)}),0!==r){var o=e.split(" ")[0],i=new Date(o+"T00:00:00");if(isNaN(i.getTime()))t.style.display="none";else{var s=new Date(i);s.setDate(s.getDate()+7*r);var c=new Date(s);c.setDate(c.getDate()+6);var l={month:"long",day:"numeric"},d=s.toLocaleDateString("en-US",l),u=s.getMonth()===c.getMonth()?{day:"numeric"}:l,m=c.toLocaleDateString("en-US",u),p=c.getFullYear();n.textContent="Estimated ready the week of "+d+"–"+m+", "+p+" (approximately "+r+" week"+(1!==r?"s":"")+" from your appointment). This is an estimate — actual times may vary.",t.style.display=""}}else t.style.display="none"}else t.style.display="none"}}var GOOGLE_FORM_URL="https://docs.google.com/forms/d/e/1FAIpQLSc-m7i0zWKTkT11nF1an6PXdR6JejpJNvDJOYPBkxz4wOYO9A/formResponse",GOOGLE_FORM_FIELDS={name:"entry.1466333029",email:"entry.763864451",phone:"entry.304343590",products:"entry.1291378806",timeslot:"entry.286083838"},BEER_WAITLIST_FORM_URL="https://docs.google.com/forms/d/e/YOUR_BEER_WAITLIST_FORM_ID/formResponse",BEER_WAITLIST_FIELDS={email:"entry.YOUR_EMAIL_ENTRY_ID"};function setupBeerWaitlistForm(){var e=document.getElementById("beer-waitlist-form");e&&e.addEventListener("submit",function(t){t.preventDefault();var n=document.getElementById("beer-waitlist-email").value.trim();if(n){var a=document.createElement("form");a.method="POST",a.action=BEER_WAITLIST_FORM_URL,a.target="beer-waitlist-iframe",a.style.display="none";var r=document.createElement("input");r.name=BEER_WAITLIST_FIELDS.email,r.value=n,a.appendChild(r),document.body.appendChild(a),a.submit(),document.body.removeChild(a),e.style.display="none",document.getElementById("beer-waitlist-confirm").style.display=""}})}function setupReservationForm(){var e=document.getElementById("reservation-form");if(e){var t=document.getElementById("res-loaded-at");t&&(t.value=String(Date.now())),e.addEventListener("submit",function(t){t.preventDefault();var n=document.getElementById("res-website");if(!n||!n.value){var a=parseInt(document.getElementById("res-loaded-at").value,10)||0;if(!(Date.now()-a<3e3)){var r=getReservation();if(0!==r.length){var o=document.querySelector('input[name="timeslot"]:checked');if(o){var i=document.getElementById("res-name").value.trim(),s=document.getElementById("res-email").value.trim(),c=document.getElementById("res-phone").value.trim();if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)){var l=c.replace(/\D/g,"");if(l.length<10||l.length>15)alert("Please enter a valid phone number (at least 10 digits).");else{var d=r.map(function(e){var t=e.qty||1;return e.name+(t>1?" x"+t:"")}).join(", "),u=o.value,m=e.querySelector('button[type="submit"]');m&&(m.disabled=!0,m.setAttribute("data-original-text",m.textContent),m.textContent="Processing...",m.classList.add("btn-loading"));var p=document.createElement("form");p.method="POST",p.action=GOOGLE_FORM_URL,p.target="reservation-iframe",p.style.display="none",[{name:GOOGLE_FORM_FIELDS.name,value:i},{name:GOOGLE_FORM_FIELDS.email,value:s},{name:GOOGLE_FORM_FIELDS.phone,value:c},{name:GOOGLE_FORM_FIELDS.products,value:d},{name:GOOGLE_FORM_FIELDS.timeslot,value:u}].forEach(function(e){var t=document.createElement("input");t.type="hidden",t.name=e.name,t.value=e.value,p.appendChild(t)}),document.body.appendChild(p),p.submit(),document.body.removeChild(p),localStorage.removeItem(RESERVATION_KEY),document.getElementById("reservation-list").style.display="none",document.getElementById("timeslot-picker").style.display="none",document.getElementById("reservation-form-section").style.display="none",document.getElementById("reservation-confirm").style.display=""}}else alert("Please enter a valid email address.")}else alert("Please select a timeslot.")}else alert("Please add at least one product to your reservation.")}}})}}