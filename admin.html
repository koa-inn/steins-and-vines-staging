<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin | Steins &amp; Vines</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body data-page="admin">

  <header class="site-header">
    <div class="container">
      <a href="index.html" class="logo"><img src="images/SV_Logo_Wordmark_green.svg" alt="Steins &amp; Vines — Squamish Brewing and Supply"></a>
      <nav class="main-nav">
        <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
        <ul class="nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="products.html">Products</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="page-header">
      <div class="container">
        <h1>
          <img src="images/Icon_offwhite.svg" alt="" aria-hidden="true" class="title-icon">
          <span data-content="page-title">Admin Dashboard</span>
          <img src="images/Icon_offwhite.svg" alt="" aria-hidden="true" class="title-icon">
        </h1>
      </div>
    </section>

    <section class="content">
      <div class="container">

        <!-- Sign-in gate -->
        <div id="admin-signin" class="admin-signin">
          <h2 data-content="sign-in-heading">Staff Sign-In Required</h2>
          <p data-content="sign-in-text">Sign in with your authorized Google account to access the inventory management dashboard.</p>
          <div id="google-signin-btn"></div>
        </div>

        <!-- Not authorized message -->
        <div id="admin-denied" class="admin-denied" style="display:none;">
          <h2 data-content="not-authorized-heading">Not Authorized</h2>
          <p data-content="not-authorized-text">Your Google account is not authorized to access this dashboard. Contact the site administrator.</p>
          <button type="button" class="btn-secondary" id="admin-signout-denied">Sign out</button>
        </div>

        <!-- Dashboard (hidden until authenticated) -->
        <div id="admin-dashboard" style="display:none;">
          <div class="admin-user-bar">
            <span id="admin-user-email"></span>
            <button type="button" class="btn-secondary admin-signout-btn" id="admin-signout">Sign out</button>
          </div>

          <!-- Tab navigation -->
          <div class="admin-tabs">
            <button type="button" class="admin-tab-btn active" data-tab="reservations">Reservations &amp; Holds</button>
            <button type="button" class="admin-tab-btn" data-tab="kits">Kit Inventory</button>
            <button type="button" class="admin-tab-btn" data-tab="ingredients">Ingredients</button>
            <button type="button" class="admin-tab-btn" data-tab="orders">Supplier Orders</button>
            <button type="button" class="admin-tab-btn" data-tab="scheduling">Scheduling</button>
            <button type="button" class="admin-tab-btn" data-tab="homepage">Homepage</button>
            <button type="button" class="admin-tab-btn" data-tab="export">Export / Sync</button>
          </div>

          <!-- Tab 1: Reservations & Holds -->
          <div class="admin-tab-panel active" id="tab-reservations">
            <div class="admin-panel-header">
              <h2>Reservations &amp; Holds</h2>
              <div class="admin-filter-row">
                <label for="res-status-filter">Status:</label>
                <select id="res-status-filter" class="admin-select">
                  <option value="all">All</option>
                  <option value="pending" selected>Pending</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>
            </div>
            <div class="admin-table-wrap">
              <table class="admin-table" id="reservations-table">
                <thead>
                  <tr>
                    <th></th>
                    <th>Reservation ID</th>
                    <th>Customer</th>
                    <th>Products</th>
                    <th>Timeslot</th>
                    <th>Status</th>
                    <th>Submitted</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="reservations-tbody"></tbody>
              </table>
            </div>
            <p class="admin-empty" id="reservations-empty" style="display:none;">No reservations found.</p>
          </div>

          <!-- Tab 2: Kit Inventory -->
          <div class="admin-tab-panel" id="tab-kits">
            <div class="admin-panel-header">
              <h2>Kit Inventory</h2>
              <div class="admin-panel-actions">
                <input type="text" id="kit-search" class="catalog-search" placeholder="Search kits...">
                <div class="admin-filter-row">
                  <label for="kit-brand-filter">Brand:</label>
                  <select id="kit-brand-filter" class="admin-select">
                    <option value="all">All</option>
                  </select>
                  <label for="kit-stock-filter">Stock:</label>
                  <select id="kit-stock-filter" class="admin-select">
                    <option value="all">All</option>
                    <option value="in">In Stock</option>
                    <option value="low">Low Stock</option>
                    <option value="out">Out of Stock</option>
                  </select>
                </div>
                <button type="button" class="btn" id="add-kit-btn">Add Kit</button>
              </div>
            </div>
            <div class="admin-table-wrap">
              <table class="admin-table" id="kits-table">
                <thead>
                  <tr>
                    <th>SKU</th>
                    <th>Brand</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Stock</th>
                    <th>On Hold</th>
                    <th>On Order</th>
                    <th>Available</th>
                    <th>In-Store</th>
                    <th>Kit</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="kits-tbody"></tbody>
              </table>
            </div>
            <p class="admin-empty" id="kits-empty" style="display:none;">No kits found.</p>
          </div>

          <!-- Tab 3: Ingredients -->
          <div class="admin-tab-panel" id="tab-ingredients">
            <div class="admin-panel-header">
              <h2>Ingredients</h2>
              <div class="admin-panel-actions">
                <div class="admin-filter-row">
                  <label for="ing-type-filter">Type:</label>
                  <select id="ing-type-filter" class="admin-select">
                    <option value="all">All</option>
                    <option value="Hops">Hops</option>
                    <option value="Yeast">Yeast</option>
                    <option value="Additives">Additives</option>
                    <option value="Finings">Finings</option>
                    <option value="Sugar">Sugar</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <button type="button" class="btn" id="add-ingredient-btn">Add Ingredient</button>
              </div>
            </div>
            <div class="admin-table-wrap">
              <table class="admin-table" id="ingredients-table">
                <thead>
                  <tr>
                    <th>SKU</th>
                    <th>Type</th>
                    <th>Name</th>
                    <th>Supplier</th>
                    <th>Cost</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ingredients-tbody"></tbody>
              </table>
            </div>
            <p class="admin-empty" id="ingredients-empty" style="display:none;">No ingredients found.</p>
          </div>

          <!-- Tab: Supplier Orders -->
          <div class="admin-tab-panel" id="tab-orders">
            <div class="admin-panel-header">
              <h2>Supplier Order</h2>
              <div class="admin-panel-actions">
                <input type="text" id="order-search" class="catalog-search" placeholder="Search order...">
                <div class="admin-filter-row">
                  <label for="order-brand-filter">Brand:</label>
                  <select id="order-brand-filter" class="admin-select">
                    <option value="all">All</option>
                  </select>
                </div>
                <button type="button" class="btn" id="order-copy-btn">Copy Order List</button>
                <button type="button" class="btn" id="order-import-btn">Import CSV</button>
                <input type="file" id="order-import-file" accept=".csv" style="display:none;">
                <button type="button" class="btn" id="order-accept-btn">Accept Delivery</button>
                <button type="button" class="btn-secondary admin-btn-danger" id="order-clear-btn">Clear Order</button>
              </div>
            </div>
            <p class="admin-order-info">Build an order over time — items persist across sessions. When the delivery arrives, click <strong>Accept Delivery</strong> to add all quantities to stock.</p>

            <div class="admin-order-add">
              <h3>Add to Order</h3>
              <div class="admin-order-add-row">
                <div class="admin-kit-search-wrap" id="order-kit-search-wrap">
                  <input type="text" id="order-kit-search" class="admin-kit-search-input" placeholder="Type to search kits..." autocomplete="off">
                  <div class="admin-kit-search-dropdown" id="order-kit-dropdown" style="display:none;"></div>
                  <input type="hidden" id="order-kit-select" value="">
                </div>
                <input type="number" id="order-kit-qty" class="admin-inline-input" value="1" min="1" style="width:70px;">
                <button type="button" class="btn admin-btn-sm" id="order-add-btn">Add</button>
              </div>
            </div>

            <div class="admin-table-wrap">
              <table class="admin-table" id="order-table">
                <thead>
                  <tr>
                    <th><input type="checkbox" id="order-select-all" checked></th>
                    <th>SKU</th>
                    <th>Brand</th>
                    <th>Name</th>
                    <th>Qty</th>
                    <th>Cost</th>
                    <th>Line Total</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="order-tbody"></tbody>
              </table>
            </div>
            <p class="admin-empty" id="order-empty" style="display:none;">No items in order.</p>
          </div>

          <!-- Tab: Scheduling -->
          <div class="admin-tab-panel" id="tab-scheduling">
            <div class="admin-panel-header">
              <h2>Scheduling</h2>
            </div>

            <div class="schedule-defaults">
              <h3>Default Weekly Schedule</h3>
              <table class="admin-table" id="schedule-defaults-table">
                <thead>
                  <tr>
                    <th>Day</th>
                    <th>Start</th>
                    <th>End</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="schedule-defaults-tbody"></tbody>
              </table>
              <button type="button" class="btn admin-btn-sm" id="schedule-save-defaults-btn">Save Defaults</button>
            </div>

            <div class="schedule-calendar">
              <h3>Appointment Slots</h3>
              <div id="schedule-cal"></div>
              <div id="schedule-day-slots"></div>
            </div>
          </div>

          <!-- Tab: Homepage Promo -->
          <div class="admin-tab-panel" id="tab-homepage">
            <div class="admin-panel-header">
              <h2>Homepage Promotions</h2>
            </div>
            <p class="admin-order-info">Manage the news announcements and featured products shown on the homepage. Changes are saved to <code>content/home.json</code>.</p>

            <div class="admin-export-section">
              <h3>News &amp; Announcements</h3>
              <p>Add news items to display on the homepage (newest first).</p>
              <div id="homepage-news-list"></div>
              <button type="button" class="btn admin-btn-sm" id="homepage-add-news">Add News Item</button>
            </div>

            <div class="admin-export-section">
              <h3>Featured Products Note</h3>
              <p>Write a short note about the featured products (e.g., "Our staff pick this week...").</p>
              <textarea id="homepage-featured-note" class="admin-textarea" rows="3" placeholder="Our staff pick this week..."></textarea>
            </div>

            <div class="admin-export-section">
              <h3>Featured Products</h3>
              <p>Select products to feature on the homepage. Search and add by name or SKU.</p>
              <div class="admin-order-add-row">
                <div class="admin-kit-search-wrap" id="homepage-kit-search-wrap">
                  <input type="text" id="homepage-kit-search" class="admin-kit-search-input" placeholder="Type to search products..." autocomplete="off">
                  <div class="admin-kit-search-dropdown" id="homepage-kit-dropdown" style="display:none;"></div>
                </div>
                <button type="button" class="btn admin-btn-sm" id="homepage-add-product">Add</button>
              </div>
              <div id="homepage-featured-list" class="homepage-featured-list"></div>
            </div>

            <div class="admin-export-section">
              <button type="button" class="btn" id="homepage-save-btn">Save Homepage Settings</button>
              <button type="button" class="btn" id="homepage-download-btn">Download home.json</button>
            </div>
          </div>

          <!-- Tab 4: Export / Sync -->
          <div class="admin-tab-panel" id="tab-export">
            <h2>Export / Sync</h2>

            <div class="admin-export-section">
              <h3>Export Kits CSV</h3>
              <p>Download a WineScheduler-compatible CSV of all kits.</p>
              <button type="button" class="btn" id="export-kits-btn">Export Kits CSV</button>
            </div>

            <div class="admin-export-section">
              <h3>Export Ingredients CSV</h3>
              <p>Download all ingredients as a CSV file.</p>
              <button type="button" class="btn" id="export-ingredients-btn">Export Ingredients CSV</button>
            </div>

            <div class="admin-export-section">
              <h3>Import CSV</h3>
              <p>Upload a CSV file to update the Kits sheet. Changes will be previewed before applying.</p>
              <input type="file" id="import-csv-input" accept=".csv" class="admin-file-input">
              <div id="import-preview" style="display:none;">
                <h4>Preview Changes</h4>
                <div class="admin-table-wrap">
                  <table class="admin-table" id="import-preview-table">
                    <thead id="import-preview-head"></thead>
                    <tbody id="import-preview-body"></tbody>
                  </table>
                </div>
                <div class="admin-import-actions">
                  <button type="button" class="btn" id="import-apply-btn">Apply Changes</button>
                  <button type="button" class="btn-secondary" id="import-cancel-btn">Cancel</button>
                </div>
              </div>
            </div>

            <div class="admin-export-section">
              <h3>Wine Scheduler Export</h3>
              <p>Download a CSV of all kits and ingredients formatted for Wine Scheduler import. The columns match Wine Scheduler's import fields exactly.</p>
              <button type="button" class="btn" id="export-ws-btn">Export for Wine Scheduler</button>
              <h4 style="margin-top: 1rem;">How to import:</h4>
              <ol>
                <li>Click "Export for Wine Scheduler" above</li>
                <li>Open Wine Scheduler → Import Products</li>
                <li>Upload the exported CSV file</li>
                <li>Map each column: Stock Code/SKU → Column A, Name → Column B, etc.</li>
              </ol>
            </div>
          </div>

        </div><!-- /admin-dashboard -->

      </div>
    </section>
  </main>

  <!-- Admin modal (for add/edit forms) -->
  <div class="admin-modal" id="admin-modal" style="display:none;">
    <div class="admin-modal-overlay" id="admin-modal-overlay"></div>
    <div class="admin-modal-content">
      <div class="admin-modal-header">
        <h3 id="admin-modal-title">Add Item</h3>
        <button type="button" class="admin-modal-close" id="admin-modal-close">&times;</button>
      </div>
      <div class="admin-modal-body" id="admin-modal-body"></div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      <img src="images/SV_Logo_PrimaryCircle_offwhite.svg" alt="Steins &amp; Vines" class="footer-logo">
      <p data-content="footer-copy">&copy; 2026 Steins &amp; Vines. All rights reserved.</p>
    </div>
  </footer>

  <!-- Save changes bar (fixed to bottom) -->
  <div class="admin-save-bar" id="admin-save-bar" style="display:none;">
    <div class="container">
      <span id="admin-save-count">0 unsaved changes</span>
      <div class="admin-save-actions">
        <button type="button" class="btn" id="admin-save-btn">Save All Changes</button>
        <button type="button" class="btn-secondary admin-discard-btn" id="admin-discard-btn">Discard</button>
      </div>
    </div>
  </div>

  <script src="js/sheets-config.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="js/admin.js"></script>
</body>
</html>
